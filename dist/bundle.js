/*! For license information please see bundle.js.LICENSE.txt */
(()=>{"use strict";var t={444:(t,e,n)=>{n.d(e,{BH:()=>o,LL:()=>w,ZR:()=>y,Sg:()=>a,vZ:()=>b,m9:()=>T,z$:()=>c,ru:()=>h,d:()=>d,w1:()=>f,hl:()=>p,uI:()=>u,b$:()=>l,G6:()=>g,Mn:()=>m});const s=function(t){const e=[];let n=0;for(let s=0;s<t.length;s++){let r=t.charCodeAt(s);r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296==(64512&r)&&s+1<t.length&&56320==(64512&t.charCodeAt(s+1))?(r=65536+((1023&r)<<10)+(1023&t.charCodeAt(++s)),e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128)}return e},r={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,s=[];for(let e=0;e<t.length;e+=3){const r=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=r>>2,h=(3&r)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,i||(l=64)),s.push(n[u],n[h],n[l],n[d])}return s.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,s=0;for(;n<t.length;){const r=t[n++];if(r<128)e[s++]=String.fromCharCode(r);else if(r>191&&r<224){const i=t[n++];e[s++]=String.fromCharCode((31&r)<<6|63&i)}else if(r>239&&r<365){const i=((7&r)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[s++]=String.fromCharCode(55296+(i>>10)),e[s++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[s++]=String.fromCharCode((15&r)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,s=[];for(let e=0;e<t.length;){const r=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0;++e;const o=e<t.length?n[t.charAt(e)]:64;++e;const a=e<t.length?n[t.charAt(e)]:64;if(++e,null==r||null==i||null==o||null==a)throw Error();const c=r<<2|i>>4;if(s.push(c),64!==o){const t=i<<4&240|o>>2;if(s.push(t),64!==a){const t=o<<6&192|a;s.push(t)}}}return s},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},i=function(t){return function(t){const e=s(t);return r.encodeByteArray(e,!0)}(t).replace(/\./g,"")};class o{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function a(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",s=t.iat||0,r=t.sub||t.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}function c(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function u(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(c())}function h(){const t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function l(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function d(){return c().indexOf("Electron/")>=0}function f(){const t=c();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function m(){return c().indexOf("MSAppHost/")>=0}function g(){return!function(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function p(){return"object"==typeof indexedDB}class y extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,y.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,w.prototype.create)}}class w{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],i=r?function(t,e){return t.replace(v,((t,n)=>{const s=e[n];return null!=s?String(s):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${i} (${s}).`;return new y(s,o,n)}}const v=/\{\$([^}]+)}/g;function b(t,e){if(t===e)return!0;const n=Object.keys(t),s=Object.keys(e);for(const r of n){if(!s.includes(r))return!1;const n=t[r],i=e[r];if(I(n)&&I(i)){if(!b(n,i))return!1}else if(n!==i)return!1}for(const t of s)if(!n.includes(t))return!1;return!0}function I(t){return null!==t&&"object"==typeof t}function T(t){return t&&t._delegate?t._delegate:t}},503:(t,e,n)=>{n.r(e),n.d(e,{FirebaseError:()=>s.ZR,SDK_VERSION:()=>s.Jn,_DEFAULT_ENTRY_NAME:()=>s.l4,_addComponent:()=>s.H9,_addOrOverwriteComponent:()=>s.Vr,_apps:()=>s.Af,_clearComponents:()=>s.Z8,_components:()=>s.lz,_getProvider:()=>s.qX,_registerComponent:()=>s.Xd,_removeServiceInstance:()=>s.wN,deleteApp:()=>s.P2,getApp:()=>s.Mq,getApps:()=>s.C6,initializeApp:()=>s.ZF,onLog:()=>s.TP,registerVersion:()=>s.KN,setLogLevel:()=>s.Ub});var s=n(238);(0,s.KN)("firebase","9.6.7","app")},591:(t,e,n)=>{n.r(e),n.d(e,{AbstractUserDataWriter:()=>Zf,Bytes:()=>Qd,CACHE_SIZE_UNLIMITED:()=>Dd,CollectionReference:()=>bd,DocumentReference:()=>wd,DocumentSnapshot:()=>Cf,FieldPath:()=>zd,FieldValue:()=>Wd,Firestore:()=>xd,FirestoreError:()=>Rs,GeoPoint:()=>Yd,LoadBundleTask:()=>Cd,Query:()=>vd,QueryConstraint:()=>Lf,QueryDocumentSnapshot:()=>Df,QuerySnapshot:()=>xf,SnapshotMetadata:()=>Nf,Timestamp:()=>Ys,Transaction:()=>vm,WriteBatch:()=>nm,_DatabaseId:()=>pr,_DocumentKey:()=>br,_EmptyAppCheckTokenProvider:()=>Ks,_EmptyAuthCredentialsProvider:()=>Ps,_FieldPath:()=>rr,_cast:()=>fd,_debugAssert:()=>xs,_isBase64Available:()=>or,_logWarn:()=>_s,_setIndexConfiguration:()=>Nm,_validateIsNotUsedTogether:()=>ud,addDoc:()=>mm,arrayRemove:()=>Sm,arrayUnion:()=>Em,clearIndexedDbPersistence:()=>Vd,collection:()=>Id,collectionGroup:()=>Td,connectFirestoreEmulator:()=>yd,deleteDoc:()=>fm,deleteField:()=>Im,disableNetwork:()=>Bd,doc:()=>Ed,documentId:()=>Hd,enableIndexedDbPersistence:()=>Md,enableMultiTabIndexedDbPersistence:()=>Pd,enableNetwork:()=>qd,endAt:()=>Qf,endBefore:()=>Hf,ensureFirestoreConfigured:()=>Rd,executeWrite:()=>ym,getDoc:()=>rm,getDocFromCache:()=>om,getDocFromServer:()=>am,getDocs:()=>cm,getDocsFromCache:()=>um,getDocsFromServer:()=>hm,getFirestore:()=>Od,increment:()=>Am,initializeFirestore:()=>kd,limit:()=>Bf,limitToLast:()=>jf,loadBundle:()=>Kd,namedQuery:()=>$d,onSnapshot:()=>gm,onSnapshotsInSync:()=>pm,orderBy:()=>Uf,query:()=>Mf,queryEqual:()=>Ad,refEqual:()=>Sd,runTransaction:()=>bm,serverTimestamp:()=>Tm,setDoc:()=>lm,setLogLevel:()=>Es,snapshotEqual:()=>Of,startAfter:()=>Gf,startAt:()=>$f,terminate:()=>jd,updateDoc:()=>dm,waitForPendingWrites:()=>Ud,where:()=>Ff,writeBatch:()=>_m});var s,r=n(238),i=n(463),o=n(333),a=n(444),c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{},u={},h=h||{},l=c||self;function d(){}function f(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function m(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var g="closure_uid_"+(1e9*Math.random()>>>0),p=0;function y(t,e,n){return t.call.apply(t.bind,arguments)}function w(t,e,n){if(!t)throw Error();if(2<arguments.length){var s=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,s),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function v(t,e,n){return(v=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?y:w).apply(null,arguments)}function b(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function I(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,s){for(var r=Array(arguments.length-2),i=2;i<arguments.length;i++)r[i-2]=arguments[i];return e.prototype[n].apply(t,r)}}function T(){this.s=this.s,this.o=this.o}var E={};T.prototype.s=!1,T.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,g)&&t[g]||(t[g]=++p)}(this);delete E[t]}},T.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const S=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},A=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){const s=t.length,r="string"==typeof t?t.split(""):t;for(let i=0;i<s;i++)i in r&&e.call(n,r[i],i,t)};function _(t){return Array.prototype.concat.apply([],arguments)}function N(t){const e=t.length;if(0<e){const n=Array(e);for(let s=0;s<e;s++)n[s]=t[s];return n}return[]}function C(t){return/^[\s\xa0]*$/.test(t)}var D,x=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function k(t,e){return-1!=t.indexOf(e)}function O(t,e){return t<e?-1:t>e?1:0}t:{var R=l.navigator;if(R){var L=R.userAgent;if(L){D=L;break t}}D=""}function M(t,e,n){for(const s in t)e.call(n,t[s],s,t)}function P(t){const e={};for(const n in t)e[n]=t[n];return e}var F="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function V(t,e){let n,s;for(let e=1;e<arguments.length;e++){for(n in s=arguments[e],s)t[n]=s[n];for(let e=0;e<F.length;e++)n=F[e],Object.prototype.hasOwnProperty.call(s,n)&&(t[n]=s[n])}}function U(t){return U[" "](t),t}U[" "]=d;var q,B,j=k(D,"Opera"),K=k(D,"Trident")||k(D,"MSIE"),$=k(D,"Edge"),G=$||K,z=k(D,"Gecko")&&!(k(D.toLowerCase(),"webkit")&&!k(D,"Edge"))&&!(k(D,"Trident")||k(D,"MSIE"))&&!k(D,"Edge"),H=k(D.toLowerCase(),"webkit")&&!k(D,"Edge");function Q(){var t=l.document;return t?t.documentMode:void 0}t:{var W="",Y=(B=D,z?/rv:([^\);]+)(\)|;)/.exec(B):$?/Edge\/([\d\.]+)/.exec(B):K?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(B):H?/WebKit\/(\S+)/.exec(B):j?/(?:Version)[ \/]?(\S+)/.exec(B):void 0);if(Y&&(W=Y?Y[1]:""),K){var X=Q();if(null!=X&&X>parseFloat(W)){q=String(X);break t}}q=W}var J,Z={};function tt(){return t=Z,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){let t=0;const e=x(String(q)).split("."),n=x("9").split("."),s=Math.max(e.length,n.length);for(let o=0;0==t&&o<s;o++){var r=e[o]||"",i=n[o]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],0==r[0].length&&0==i[0].length)break;t=O(0==r[1].length?0:parseInt(r[1],10),0==i[1].length?0:parseInt(i[1],10))||O(0==r[2].length,0==i[2].length)||O(r[2],i[2]),r=r[3],i=i[3]}while(0==t)}return 0<=t}();var t}l.document&&K?J=Q()||parseInt(q,10)||void 0:J=void 0;var et=J,nt=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{l.addEventListener("test",d,e),l.removeEventListener("test",d,e)}catch(t){}return t}();function st(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function rt(t,e){if(st.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,s=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(z){t:{try{U(e.nodeName);var r=!0;break t}catch(t){}r=!1}r||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,s?(this.clientX=void 0!==s.clientX?s.clientX:s.pageX,this.clientY=void 0!==s.clientY?s.clientY:s.pageY,this.screenX=s.screenX||0,this.screenY=s.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:it[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&rt.Z.h.call(this)}}st.prototype.h=function(){this.defaultPrevented=!0},I(rt,st);var it={2:"touch",3:"pen",4:"mouse"};rt.prototype.h=function(){rt.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var ot="closure_listenable_"+(1e6*Math.random()|0),at=0;function ct(t,e,n,s,r){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!s,this.ia=r,this.key=++at,this.ca=this.fa=!1}function ut(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function ht(t){this.src=t,this.g={},this.h=0}function lt(t,e){var n=e.type;if(n in t.g){var s,r=t.g[n],i=S(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ut(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function dt(t,e,n,s){for(var r=0;r<t.length;++r){var i=t[r];if(!i.ca&&i.listener==e&&i.capture==!!n&&i.ia==s)return r}return-1}ht.prototype.add=function(t,e,n,s,r){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=dt(t,e,s,r);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new ct(e,this.src,i,!!s,r)).fa=n,t.push(e)),e};var ft="closure_lm_"+(1e6*Math.random()|0),mt={};function gt(t,e,n,s,r){if(s&&s.once)return yt(t,e,n,s,r);if(Array.isArray(e)){for(var i=0;i<e.length;i++)gt(t,e[i],n,s,r);return null}return n=St(n),t&&t[ot]?t.N(e,n,m(s)?!!s.capture:!!s,r):pt(t,e,n,!1,s,r)}function pt(t,e,n,s,r,i){if(!e)throw Error("Invalid event type");var o=m(r)?!!r.capture:!!r,a=Tt(t);if(a||(t[ft]=a=new ht(t)),(n=a.add(e,n,s,o,i)).proxy)return n;if(s=function(){var t=It;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=s,s.src=t,s.listener=n,t.addEventListener)nt||(r=o),void 0===r&&(r=!1),t.addEventListener(e.toString(),s,r);else if(t.attachEvent)t.attachEvent(bt(e.toString()),s);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(s)}return n}function yt(t,e,n,s,r){if(Array.isArray(e)){for(var i=0;i<e.length;i++)yt(t,e[i],n,s,r);return null}return n=St(n),t&&t[ot]?t.O(e,n,m(s)?!!s.capture:!!s,r):pt(t,e,n,!0,s,r)}function wt(t,e,n,s,r){if(Array.isArray(e))for(var i=0;i<e.length;i++)wt(t,e[i],n,s,r);else s=m(s)?!!s.capture:!!s,n=St(n),t&&t[ot]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=dt(i=t.g[e],n,s,r))&&(ut(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=Tt(t))&&(e=t.g[e.toString()],t=-1,e&&(t=dt(e,n,s,r)),(n=-1<t?e[t]:null)&&vt(n))}function vt(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[ot])lt(e.i,t);else{var n=t.type,s=t.proxy;e.removeEventListener?e.removeEventListener(n,s,t.capture):e.detachEvent?e.detachEvent(bt(n),s):e.addListener&&e.removeListener&&e.removeListener(s),(n=Tt(e))?(lt(n,t),0==n.h&&(n.src=null,e[ft]=null)):ut(t)}}}function bt(t){return t in mt?mt[t]:mt[t]="on"+t}function It(t,e){if(t.ca)t=!0;else{e=new rt(e,this);var n=t.listener,s=t.ia||t.src;t.fa&&vt(t),t=n.call(s,e)}return t}function Tt(t){return(t=t[ft])instanceof ht?t:null}var Et="__closure_events_fn_"+(1e9*Math.random()>>>0);function St(t){return"function"==typeof t?t:(t[Et]||(t[Et]=function(e){return t.handleEvent(e)}),t[Et])}function At(){T.call(this),this.i=new ht(this),this.P=this,this.I=null}function _t(t,e){var n,s=t.I;if(s)for(n=[];s;s=s.I)n.push(s);if(t=t.P,s=e.type||e,"string"==typeof e)e=new st(e,t);else if(e instanceof st)e.target=e.target||t;else{var r=e;V(e=new st(s,t),r)}if(r=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];r=Nt(o,s,!0,e)&&r}if(r=Nt(o=e.g=t,s,!0,e)&&r,r=Nt(o,s,!1,e)&&r,n)for(i=0;i<n.length;i++)r=Nt(o=e.g=n[i],s,!1,e)&&r}function Nt(t,e,n,s){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.ca&&o.capture==n){var a=o.listener,c=o.ia||o.src;o.fa&&lt(t.i,o),r=!1!==a.call(c,s)&&r}}return r&&!s.defaultPrevented}I(At,T),At.prototype[ot]=!0,At.prototype.removeEventListener=function(t,e,n,s){wt(this,t,e,n,s)},At.prototype.M=function(){if(At.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],s=0;s<n.length;s++)ut(n[s]);delete e.g[t],e.h--}}this.I=null},At.prototype.N=function(t,e,n,s){return this.i.add(String(t),e,!1,n,s)},At.prototype.O=function(t,e,n,s){return this.i.add(String(t),e,!0,n,s)};var Ct=l.JSON.stringify;function Dt(){var t=Pt;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var xt,kt=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Ot),(t=>t.reset()));class Ot{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Rt(t){l.setTimeout((()=>{throw t}),0)}function Lt(t,e){xt||function(){var t=l.Promise.resolve(void 0);xt=function(){t.then(Ft)}}(),Mt||(xt(),Mt=!0),Pt.add(t,e)}var Mt=!1,Pt=new class{constructor(){this.h=this.g=null}add(t,e){const n=kt.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}};function Ft(){for(var t;t=Dt();){try{t.h.call(t.g)}catch(t){Rt(t)}var e=kt;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Mt=!1}function Vt(t,e){At.call(this),this.h=t||1,this.g=e||l,this.j=v(this.kb,this),this.l=Date.now()}function Ut(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function qt(t,e,n){if("function"==typeof t)n&&(t=v(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=v(t.handleEvent,t)}return 2147483647<Number(e)?-1:l.setTimeout(t,e||0)}function Bt(t){t.g=qt((()=>{t.g=null,t.i&&(t.i=!1,Bt(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}I(Vt,At),(s=Vt.prototype).da=!1,s.S=null,s.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),_t(this,"tick"),this.da&&(Ut(this),this.start()))}},s.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},s.M=function(){Vt.Z.M.call(this),Ut(this),delete this.g};class jt extends T{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:Bt(this)}M(){super.M(),this.g&&(l.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Kt(t){T.call(this),this.h=t,this.g={}}I(Kt,T);var $t=[];function Gt(t,e,n,s){Array.isArray(n)||(n&&($t[0]=n.toString()),n=$t);for(var r=0;r<n.length;r++){var i=gt(e,n[r],s||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function zt(t){M(t.g,(function(t,e){this.g.hasOwnProperty(e)&&vt(t)}),t),t.g={}}function Ht(){this.g=!0}function Qt(t,e,n,s){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var s=n[t];if(!(2>s.length)){var r=s[1];if(Array.isArray(r)&&!(1>r.length)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<r.length;o++)r[o]=""}}}return Ct(n)}catch(t){return e}}(t,n)+(s?" "+s:"")}))}Kt.prototype.M=function(){Kt.Z.M.call(this),zt(this)},Kt.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ht.prototype.Aa=function(){this.g=!1},Ht.prototype.info=function(){};var Wt={},Yt=null;function Xt(){return Yt=Yt||new At}function Jt(t){st.call(this,Wt.Ma,t)}function Zt(t){const e=Xt();_t(e,new Jt(e,t))}function te(t,e){st.call(this,Wt.STAT_EVENT,t),this.stat=e}function ee(t){const e=Xt();_t(e,new te(e,t))}function ne(t,e){st.call(this,Wt.Na,t),this.size=e}function se(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return l.setTimeout((function(){t()}),e)}Wt.Ma="serverreachability",I(Jt,st),Wt.STAT_EVENT="statevent",I(te,st),Wt.Na="timingevent",I(ne,st);var re={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},ie={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function oe(){}function ae(t){return t.h||(t.h=t.i())}function ce(){}oe.prototype.h=null;var ue,he={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function le(){st.call(this,"d")}function de(){st.call(this,"c")}function fe(){}function me(t,e,n,s){this.l=t,this.j=e,this.m=n,this.X=s||1,this.V=new Kt(this),this.P=pe,t=G?125:void 0,this.W=new Vt(t),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new ge}function ge(){this.i=null,this.g="",this.h=!1}I(le,st),I(de,st),I(fe,oe),fe.prototype.g=function(){return new XMLHttpRequest},fe.prototype.i=function(){return{}},ue=new fe;var pe=45e3,ye={},we={};function ve(t,e,n){t.K=1,t.v=je(Pe(e)),t.s=n,t.U=!0,be(t,null)}function be(t,e){t.F=Date.now(),Se(t),t.A=Pe(t.v);var n=t.A,s=t.X;Array.isArray(s)||(s=[String(s)]),en(n.h,"t",s),t.C=0,n=t.l.H,t.h=new ge,t.g=ns(t.l,n?e:null,!t.s),0<t.O&&(t.L=new jt(v(t.Ia,t,t.g),t.O)),Gt(t.V,t.g,"readystatechange",t.gb),e=t.H?P(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Zt(1),function(t,e,n,s,r,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+s+") [attempt "+r+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ie(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Te(t,e,n){let s,r=!0;for(;!t.I&&t.C<n.length;){if(s=Ee(t,n),s==we){4==e&&(t.o=4,ee(14),r=!1),Qt(t.j,t.m,null,"[Incomplete Response]");break}if(s==ye){t.o=4,ee(15),Qt(t.j,t.m,n,"[Invalid Chunk]"),r=!1;break}Qt(t.j,t.m,s,null),De(t,s)}Ie(t)&&s!=we&&s!=ye&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ee(16),r=!1),t.i=t.i&&r,r?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),Qn(e),e.L=!0,ee(11))):(Qt(t.j,t.m,n,"[Invalid Chunked Response]"),Ce(t),Ne(t))}function Ee(t,e){var n=t.C,s=e.indexOf("\n",n);return-1==s?we:(n=Number(e.substring(n,s)),isNaN(n)?ye:(s+=1)+n>e.length?we:(e=e.substr(s,n),t.C=s+n,e))}function Se(t){t.Y=Date.now()+t.P,Ae(t,t.P)}function Ae(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=se(v(t.eb,t),e)}function _e(t){t.B&&(l.clearTimeout(t.B),t.B=null)}function Ne(t){0==t.l.G||t.I||Xn(t.l,t)}function Ce(t){_e(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,Ut(t.W),zt(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function De(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||cn(n.i,t)))if(n.I=t.N,!t.J&&cn(n.i,t)&&3==n.G){try{var s=n.Ca.g.parse(e)}catch(t){s=null}if(Array.isArray(s)&&3==s.length){var r=s;if(0==r[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;Yn(n),Un(n)}Hn(n),ee(18)}}else n.ta=r[1],0<n.ta-n.U&&37500>r[2]&&n.N&&0==n.A&&!n.v&&(n.v=se(v(n.ab,n),6e3));if(1>=an(n.i)&&n.ka){try{n.ka()}catch(t){}n.ka=void 0}}else Zn(n,11)}else if((t.J||n.g==t)&&Yn(n),!C(e))for(r=n.Ca.g.parse(e),e=0;e<r.length;e++){let u=r[e];if(n.U=u[0],u=u[1],2==n.G)if("c"==u[0]){n.J=u[1],n.la=u[2];const e=u[3];null!=e&&(n.ma=e,n.h.info("VER="+n.ma));const r=u[4];null!=r&&(n.za=r,n.h.info("SVER="+n.za));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(s=1.5*h,n.K=s,n.h.info("backChannelRequestTimeoutMs_="+s)),s=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=s.i;!i.g&&(k(t,"spdy")||k(t,"quic")||k(t,"h2"))&&(i.j=i.l,i.g=new Set,i.h&&(un(i,i.h),i.h=null))}if(s.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(s.sa=t,Be(s.F,s.D,t))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var o=t;if((s=n).oa=es(s,s.H?s.la:null,s.W),o.J){hn(s.i,o);var a=o,c=s.K;c&&a.setTimeout(c),a.B&&(_e(a),Se(a)),s.g=o}else zn(s);0<n.l.length&&jn(n)}else"stop"!=u[0]&&"close"!=u[0]||Zn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Zn(n,7):Vn(n):"noop"!=u[0]&&n.j&&n.j.wa(u),n.A=0)}Zt(4)}catch(t){}}function xe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(f(t)||"string"==typeof t)A(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(f(t)||"string"==typeof t){n=[];for(var s=t.length,r=0;r<s;r++)n.push(r)}else for(r in n=[],s=0,t)n[s++]=r;s=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(f(t)){for(var e=[],n=t.length,s=0;s<n;s++)e.push(t[s]);return e}for(s in e=[],n=0,t)e[n++]=t[s];return e}(t),r=s.length;for(var i=0;i<r;i++)e.call(void 0,s[i],n&&n[i],t)}}function ke(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var s=0;s<n;s+=2)this.set(arguments[s],arguments[s+1])}else if(t)if(t instanceof ke)for(n=t.T(),s=0;s<n.length;s++)this.set(n[s],t.get(n[s]));else for(s in t)this.set(s,t[s])}function Oe(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var s=t.g[e];Re(t.h,s)&&(t.g[n++]=s),e++}t.g.length=n}if(t.i!=t.g.length){var r={};for(n=e=0;e<t.g.length;)Re(r,s=t.g[e])||(t.g[n++]=s,r[s]=1),e++;t.g.length=n}}function Re(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(s=me.prototype).setTimeout=function(t){this.P=t},s.gb=function(t){t=t.target;const e=this.L;e&&3==Rn(t)?e.l():this.Ia(t)},s.Ia=function(t){try{if(t==this.g)t:{const h=Rn(this.g);var e=this.g.Da();const d=this.g.ba();if(!(3>h)&&(3!=h||G||this.g&&(this.h.h||this.g.ga()||Ln(this.g)))){this.I||4!=h||7==e||Zt(8==e||0>=d?3:2),_e(this);var n=this.g.ba();this.N=n;e:if(Ie(this)){var s=Ln(this.g);t="";var r=s.length,i=4==Rn(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Ce(this),Ne(this);var o="";break e}this.h.i=new l.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,t+=this.h.i.decode(s[e],{stream:i&&e==r-1});s.splice(0,r),this.h.g+=t,this.C=0,o=this.h.g}else o=this.g.ga();if(this.i=200==n,function(t,e,n,s,r,i,o){t.info((function(){return"XMLHTTP RESP ("+s+") [ attempt "+r+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.X,h,n),this.i){if(this.$&&!this.J){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!C(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.o=3,ee(12),Ce(this),Ne(this);break t}Qt(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,De(this,n)}this.U?(Te(this,h,o),G&&this.i&&3==h&&(Gt(this.V,this.W,"tick",this.fb),this.W.start())):(Qt(this.j,this.m,o,null),De(this,o)),4==h&&Ce(this),this.i&&!this.I&&(4==h?Xn(this.l,this):(this.i=!1,Se(this)))}else 400==n&&0<o.indexOf("Unknown SID")?(this.o=3,ee(12)):(this.o=0,ee(13)),Ce(this),Ne(this)}}}catch(t){}},s.fb=function(){if(this.g){var t=Rn(this.g),e=this.g.ga();this.C<e.length&&(_e(this),Te(this,t,e),this.i&&4!=t&&Se(this))}},s.cancel=function(){this.I=!0,Ce(this)},s.eb=function(){this.B=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.A),2!=this.K&&(Zt(3),ee(17)),Ce(this),this.o=2,Ne(this)):Ae(this,this.Y-t)},(s=ke.prototype).R=function(){Oe(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},s.T=function(){return Oe(this),this.g.concat()},s.get=function(t,e){return Re(this.h,t)?this.h[t]:e},s.set=function(t,e){Re(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},s.forEach=function(t,e){for(var n=this.T(),s=0;s<n.length;s++){var r=n[s],i=this.get(r);t.call(e,i,r,this)}};var Le=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Me(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof Me){this.g=void 0!==e?e:t.g,Fe(this,t.j),this.s=t.s,Ve(this,t.i),Ue(this,t.m),this.l=t.l,e=t.h;var n=new Xe;n.i=e.i,e.g&&(n.g=new ke(e.g),n.h=e.h),qe(this,n),this.o=t.o}else t&&(n=String(t).match(Le))?(this.g=!!e,Fe(this,n[1]||"",!0),this.s=Ke(n[2]||""),Ve(this,n[3]||"",!0),Ue(this,n[4]),this.l=Ke(n[5]||"",!0),qe(this,n[6]||"",!0),this.o=Ke(n[7]||"")):(this.g=!!e,this.h=new Xe(null,this.g))}function Pe(t){return new Me(t)}function Fe(t,e,n){t.j=n?Ke(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Ve(t,e,n){t.i=n?Ke(e,!0):e}function Ue(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function qe(t,e,n){e instanceof Xe?(t.h=e,function(t,e){e&&!t.j&&(Je(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Ze(this,e),en(this,n,t))}),t)),t.j=e}(t.h,t.g)):(n||(e=$e(e,We)),t.h=new Xe(e,t.g))}function Be(t,e,n){t.h.set(e,n)}function je(t){return Be(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Ke(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function $e(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ge),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ge(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Me.prototype.toString=function(){var t=[],e=this.j;e&&t.push($e(e,ze,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push($e(e,ze,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push($e(n,"/"==n.charAt(0)?Qe:He,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",$e(n,Ye)),t.join("")};var ze=/[#\/\?@]/g,He=/[#\?:]/g,Qe=/[#\?]/g,We=/[#\?@]/g,Ye=/#/g;function Xe(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Je(t){t.g||(t.g=new ke,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var s=t[n].indexOf("="),r=null;if(0<=s){var i=t[n].substring(0,s);r=t[n].substring(s+1)}else i=t[n];e(i,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Ze(t,e){Je(t),e=nn(t,e),Re(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,Re((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&Oe(t)))}function tn(t,e){return Je(t),e=nn(t,e),Re(t.g.h,e)}function en(t,e,n){Ze(t,e),0<n.length&&(t.i=null,t.g.set(nn(t,e),N(n)),t.h+=n.length)}function nn(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function sn(t){this.l=t||rn,t=l.PerformanceNavigationTiming?0<(t=l.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(l.g&&l.g.Ea&&l.g.Ea()&&l.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(s=Xe.prototype).add=function(t,e){Je(this),this.i=null,t=nn(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},s.forEach=function(t,e){Je(this),this.g.forEach((function(n,s){A(n,(function(n){t.call(e,n,s,this)}),this)}),this)},s.T=function(){Je(this);for(var t=this.g.R(),e=this.g.T(),n=[],s=0;s<e.length;s++)for(var r=t[s],i=0;i<r.length;i++)n.push(e[s]);return n},s.R=function(t){Je(this);var e=[];if("string"==typeof t)tn(this,t)&&(e=_(e,this.g.get(nn(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=_(e,t[n])}return e},s.set=function(t,e){return Je(this),this.i=null,tn(this,t=nn(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},s.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},s.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var s=e[n],r=encodeURIComponent(String(s));s=this.R(s);for(var i=0;i<s.length;i++){var o=r;""!==s[i]&&(o+="="+encodeURIComponent(String(s[i]))),t.push(o)}}return this.i=t.join("&")};var rn=10;function on(t){return!!t.h||!!t.g&&t.g.size>=t.j}function an(t){return t.h?1:t.g?t.g.size:0}function cn(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function un(t,e){t.g?t.g.add(e):t.h=e}function hn(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ln(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return N(t.i)}function dn(){}function fn(){this.g=new dn}function mn(t,e,n){const s=n||"";try{xe(t,(function(t,n){let r=t;m(t)&&(r=Ct(t)),e.push(s+n+"="+encodeURIComponent(r))}))}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}function gn(t,e,n,s,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(s)}catch(t){}}function pn(t){this.l=t.$b||null,this.j=t.ib||!1}function yn(t,e){At.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=wn,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}sn.prototype.cancel=function(){if(this.i=ln(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}},dn.prototype.stringify=function(t){return l.JSON.stringify(t,void 0)},dn.prototype.parse=function(t){return l.JSON.parse(t,void 0)},I(pn,oe),pn.prototype.g=function(){return new yn(this.l,this.j)},pn.prototype.i=function(t){return function(){return t}}({}),I(yn,At);var wn=0;function vn(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function bn(t){t.readyState=4,t.l=null,t.j=null,t.A=null,In(t)}function In(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(s=yn.prototype).open=function(t,e){if(this.readyState!=wn)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,In(this)},s.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||l).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},s.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,bn(this)),this.readyState=wn},s.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,In(this)),this.g&&(this.readyState=3,In(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==l.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;vn(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},s.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?bn(this):In(this),3==this.readyState&&vn(this)}},s.Ua=function(t){this.g&&(this.response=this.responseText=t,bn(this))},s.Ta=function(t){this.g&&(this.response=t,bn(this))},s.ha=function(){this.g&&bn(this)},s.setRequestHeader=function(t,e){this.v.append(t,e)},s.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},s.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(yn.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Tn=l.JSON.parse;function En(t){At.call(this),this.headers=new ke,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Sn,this.K=this.L=!1}I(En,At);var Sn="",An=/^https?$/i,_n=["POST","PUT"];function Nn(t){return"content-type"==t.toLowerCase()}function Cn(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Dn(t),kn(t)}function Dn(t){t.D||(t.D=!0,_t(t,"complete"),_t(t,"error"))}function xn(t){if(t.h&&void 0!==h&&(!t.C[1]||4!=Rn(t)||2!=t.ba()))if(t.v&&4==Rn(t))qt(t.Fa,0,t);else if(_t(t,"readystatechange"),4==Rn(t)){t.h=!1;try{const a=t.ba();t:switch(a){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===a){var r=String(t.H).match(Le)[1]||null;if(!r&&l.self&&l.self.location){var i=l.self.location.protocol;r=i.substr(0,i.length-1)}s=!An.test(r?r.toLowerCase():"")}n=s}if(n)_t(t,"complete"),_t(t,"success");else{t.m=6;try{var o=2<Rn(t)?t.g.statusText:""}catch(t){o=""}t.j=o+" ["+t.ba()+"]",Dn(t)}}finally{kn(t)}}}function kn(t,e){if(t.g){On(t);const n=t.g,s=t.C[0]?d:null;t.g=null,t.C=null,e||_t(t,"ready");try{n.onreadystatechange=s}catch(t){}}}function On(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(l.clearTimeout(t.A),t.A=null)}function Rn(t){return t.g?t.g.readyState:0}function Ln(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Sn:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Mn(t,e,n){t:{for(s in n){var s=!1;break t}s=!0}s||(n=function(t){let e="";return M(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Be(t,e,n))}function Pn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Fn(t){this.za=0,this.l=[],this.h=new Ht,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=Pn("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=Pn("baseRetryDelayMs",5e3,t),this.$a=Pn("retryDelaySeedMs",1e4,t),this.Ya=Pn("forwardChannelMaxRetries",2,t),this.ra=Pn("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new sn(t&&t.concurrentRequestLimit),this.Ca=new fn,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function Vn(t){if(qn(t),3==t.G){var e=t.V++,n=Pe(t.F);Be(n,"SID",t.J),Be(n,"RID",e),Be(n,"TYPE","terminate"),$n(t,n),(e=new me(t,t.h,e,void 0)).K=2,e.v=je(Pe(n)),n=!1,l.navigator&&l.navigator.sendBeacon&&(n=l.navigator.sendBeacon(e.v.toString(),"")),!n&&l.Image&&((new Image).src=e.v,n=!0),n||(e.g=ns(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Se(e)}ts(t)}function Un(t){t.g&&(Qn(t),t.g.cancel(),t.g=null)}function qn(t){Un(t),t.u&&(l.clearTimeout(t.u),t.u=null),Yn(t),t.i.cancel(),t.m&&("number"==typeof t.m&&l.clearTimeout(t.m),t.m=null)}function Bn(t,e){t.l.push(new class{constructor(t,e){this.h=t,this.g=e}}(t.Za++,e)),3==t.G&&jn(t)}function jn(t){on(t.i)||t.m||(t.m=!0,Lt(t.Ha,t),t.C=0)}function Kn(t,e){var n;n=e?e.m:t.V++;const s=Pe(t.F);Be(s,"SID",t.J),Be(s,"RID",n),Be(s,"AID",t.U),$n(t,s),t.o&&t.s&&Mn(s,t.o,t.s),n=new me(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=Gn(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),un(t.i,n),ve(n,s,e)}function $n(t,e){t.j&&xe({},(function(t,n){Be(e,n,t)}))}function Gn(t,e,n){n=Math.min(t.l.length,n);var s=t.j?v(t.j.Oa,t.j,t):null;t:{var r=t.l;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=r[0].h,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=r[o].h;const a=r[o].g;if(n-=e,0>n)e=Math.max(0,r[o].h-100),i=!1;else try{mn(a,t,"req"+n+"_")}catch(t){s&&s(a)}}if(i){s=t.join("&");break t}}}return t=t.l.splice(0,n),e.D=t,s}function zn(t){t.g||t.u||(t.Y=1,Lt(t.Ga,t),t.A=0)}function Hn(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=se(v(t.Ga,t),Jn(t,t.A)),t.A++,0))}function Qn(t){null!=t.B&&(l.clearTimeout(t.B),t.B=null)}function Wn(t){t.g=new me(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=Pe(t.oa);Be(e,"RID","rpc"),Be(e,"SID",t.J),Be(e,"CI",t.N?"0":"1"),Be(e,"AID",t.U),$n(t,e),Be(e,"TYPE","xmlhttp"),t.o&&t.s&&Mn(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=je(Pe(e)),n.s=null,n.U=!0,be(n,t)}function Yn(t){null!=t.v&&(l.clearTimeout(t.v),t.v=null)}function Xn(t,e){var n=null;if(t.g==e){Yn(t),Qn(t),t.g=null;var s=2}else{if(!cn(t.i,e))return;n=e.D,hn(t.i,e),s=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==s){n=e.s?e.s.length:0,e=Date.now()-e.F;var r=t.C;_t(s=Xt(),new ne(s,n,e,r)),jn(t)}else zn(t);else if(3==(r=e.o)||0==r&&0<t.I||!(1==s&&function(t,e){return!(an(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=se(v(t.Ha,t,e),Jn(t,t.C)),t.C++,0)))}(t,e)||2==s&&Hn(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),r){case 1:Zn(t,5);break;case 4:Zn(t,10);break;case 3:Zn(t,6);break;default:Zn(t,2)}}function Jn(t,e){let n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Zn(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var s=v(t.jb,t);n||(n=new Me("//www.google.com/images/cleardot.gif"),l.location&&"http"==l.location.protocol||Fe(n,"https"),je(n)),function(t,e){const n=new Ht;if(l.Image){const s=new Image;s.onload=b(gn,n,s,"TestLoadImage: loaded",!0,e),s.onerror=b(gn,n,s,"TestLoadImage: error",!1,e),s.onabort=b(gn,n,s,"TestLoadImage: abort",!1,e),s.ontimeout=b(gn,n,s,"TestLoadImage: timeout",!1,e),l.setTimeout((function(){s.ontimeout&&s.ontimeout()}),1e4),s.src=t}else e(!1)}(n.toString(),s)}else ee(2);t.G=0,t.j&&t.j.va(e),ts(t),qn(t)}function ts(t){t.G=0,t.I=-1,t.j&&(0==ln(t.i).length&&0==t.l.length||(t.i.i.length=0,N(t.l),t.l.length=0),t.j.ua())}function es(t,e,n){let s=function(t){return t instanceof Me?Pe(t):new Me(t,void 0)}(n);if(""!=s.i)e&&Ve(s,e+"."+s.i),Ue(s,s.m);else{const t=l.location;s=function(t,e,n,s){var r=new Me(null,void 0);return t&&Fe(r,t),e&&Ve(r,e),n&&Ue(r,n),s&&(r.l=s),r}(t.protocol,e?e+"."+t.hostname:t.hostname,+t.port,n)}return t.aa&&M(t.aa,(function(t,e){Be(s,e,t)})),e=t.D,n=t.sa,e&&n&&Be(s,e,n),Be(s,"VER",t.ma),$n(t,s),s}function ns(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=n&&t.Ba&&!t.qa?new En(new pn({ib:!0})):new En(t.qa)).L=t.H,e}function ss(){}function rs(){if(K&&!(10<=Number(et)))throw Error("Environmental error: no available transport.")}function is(t,e){At.call(this),this.g=new Fn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!C(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!C(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new cs(this)}function os(t){le.call(this);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function as(){de.call(this),this.status=1}function cs(t){this.g=t}(s=En.prototype).ea=function(t,e,n,s){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ue.g(),this.C=this.u?ae(this.u):ae(ue),this.g.onreadystatechange=v(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(t){return void Cn(this,t)}t=n||"";const r=new ke(this.headers);s&&xe(s,(function(t,e){r.set(e,t)})),s=function(t){t:{var e=Nn;const n=t.length,s="string"==typeof t?t.split(""):t;for(let r=0;r<n;r++)if(r in s&&e.call(void 0,s[r],r,t)){e=r;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(r.T()),n=l.FormData&&t instanceof l.FormData,!(0<=S(_n,e))||s||n||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.forEach((function(t,e){this.g.setRequestHeader(e,t)}),this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{On(this),0<this.B&&((this.K=function(t){return K&&tt()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=v(this.pa,this)):this.A=qt(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Cn(this,t)}},s.pa=function(){void 0!==h&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,_t(this,"timeout"),this.abort(8))},s.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,_t(this,"complete"),_t(this,"abort"),kn(this))},s.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),kn(this,!0)),En.Z.M.call(this)},s.Fa=function(){this.s||(this.F||this.v||this.l?xn(this):this.cb())},s.cb=function(){xn(this)},s.ba=function(){try{return 2<Rn(this)?this.g.status:-1}catch(t){return-1}},s.ga=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},s.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Tn(e)}},s.Da=function(){return this.m},s.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(s=Fn.prototype).ma=8,s.G=1,s.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(t){}},s.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;const r=new me(this,this.h,t,void 0);let i=this.s;if(this.P&&(i?(i=P(i),V(i,this.P)):i=this.P),null===this.o&&(r.H=i),this.ja)t:{for(var e=0,n=0;n<this.l.length;n++){var s=this.l[n];if(void 0===(s="__data__"in s.g&&"string"==typeof(s=s.g.__data__)?s.length:void 0))break;if(4096<(e+=s)){e=n;break t}if(4096===e||n===this.l.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=Gn(this,r,e),Be(n=Pe(this.F),"RID",t),Be(n,"CVER",22),this.D&&Be(n,"X-HTTP-Session-Id",this.D),$n(this,n),this.o&&i&&Mn(n,this.o,i),un(this.i,r),this.Ra&&Be(n,"TYPE","init"),this.ja?(Be(n,"$req",e),Be(n,"SID","null"),r.$=!0,ve(r,n,null)):ve(r,n,e),this.G=2}}else 3==this.G&&(t?Kn(this,t):0==this.l.length||on(this.i)||Kn(this))},s.Ga=function(){if(this.u=null,Wn(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=se(v(this.bb,this),t)}},s.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ee(10),Un(this),Wn(this))},s.ab=function(){null!=this.v&&(this.v=null,Un(this),Hn(this),ee(19))},s.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ee(2)):(this.h.info("Failed to ping google.com"),ee(1))},(s=ss.prototype).xa=function(){},s.wa=function(){},s.va=function(){},s.ua=function(){},s.Oa=function(){},rs.prototype.g=function(t,e){return new is(t,e)},I(is,At),is.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),Lt(v(t.hb,t,e))),ee(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=es(t,null,t.W),jn(t)},is.prototype.close=function(){Vn(this.g)},is.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,Bn(this.g,e)}else this.v?((e={}).__data__=Ct(t),Bn(this.g,e)):Bn(this.g,t)},is.prototype.M=function(){this.g.j=null,delete this.j,Vn(this.g),delete this.g,is.Z.M.call(this)},I(os,le),I(as,de),I(cs,ss),cs.prototype.xa=function(){_t(this.g,"a")},cs.prototype.wa=function(t){_t(this.g,new os(t))},cs.prototype.va=function(t){_t(this.g,new as(t))},cs.prototype.ua=function(){_t(this.g,"b")},rs.prototype.createWebChannel=rs.prototype.g,is.prototype.send=is.prototype.u,is.prototype.open=is.prototype.m,is.prototype.close=is.prototype.close,re.NO_ERROR=0,re.TIMEOUT=8,re.HTTP_ERROR=6,ie.COMPLETE="complete",ce.EventType=he,he.OPEN="a",he.CLOSE="b",he.ERROR="c",he.MESSAGE="d",At.prototype.listen=At.prototype.N,En.prototype.listenOnce=En.prototype.O,En.prototype.getLastError=En.prototype.La,En.prototype.getLastErrorCode=En.prototype.Da,En.prototype.getStatus=En.prototype.ba,En.prototype.getResponseJson=En.prototype.Qa,En.prototype.getResponseText=En.prototype.ga,En.prototype.send=En.prototype.ea;var us=u.createWebChannelTransport=function(){return new rs},hs=u.getStatEventTarget=function(){return Xt()},ls=u.ErrorCode=re,ds=u.EventType=ie,fs=u.Event=Wt,ms=u.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},gs=u.FetchXmlHttpFactory=pn,ps=u.WebChannel=ce,ys=u.XhrIo=En;const ws="@firebase/firestore";class vs{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}vs.UNAUTHENTICATED=new vs(null),vs.GOOGLE_CREDENTIALS=new vs("google-credentials-uid"),vs.FIRST_PARTY=new vs("first-party-uid"),vs.MOCK_USER=new vs("mock-user");let bs="9.6.7";const Is=new o.Yd("@firebase/firestore");function Ts(){return Is.logLevel}function Es(t){Is.setLogLevel(t)}function Ss(t,...e){if(Is.logLevel<=o.in.DEBUG){const n=e.map(Ns);Is.debug(`Firestore (${bs}): ${t}`,...n)}}function As(t,...e){if(Is.logLevel<=o.in.ERROR){const n=e.map(Ns);Is.error(`Firestore (${bs}): ${t}`,...n)}}function _s(t,...e){if(Is.logLevel<=o.in.WARN){const n=e.map(Ns);Is.warn(`Firestore (${bs}): ${t}`,...n)}}function Ns(t){if("string"==typeof t)return t;try{return e=t,JSON.stringify(e)}catch(e){return t}var e}function Cs(t="Unexpected state"){const e=`FIRESTORE (${bs}) INTERNAL ASSERTION FAILED: `+t;throw As(e),new Error(e)}function Ds(t,e){t||Cs()}function xs(t,e){t||Cs()}function ks(t,e){return t}const Os={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Rs extends a.ZR{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ls{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Ms{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Ps{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(vs.UNAUTHENTICATED)))}shutdown(){}}class Fs{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Vs{constructor(t){this.t=t,this.currentUser=vs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const s=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let r=new Ls;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new Ls,t.enqueueRetryable((()=>s(this.currentUser)))};const i=()=>{const e=r;t.enqueueRetryable((async()=>{await e.promise,await s(this.currentUser)}))},o=t=>{Ss("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(Ss("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new Ls)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(Ss("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Ds("string"==typeof e.accessToken),new Ms(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Ds(null===t||"string"==typeof t),new vs(t)}}class Us{constructor(t,e,n){this.type="FirstParty",this.user=vs.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",e);const s=t.auth.getAuthHeaderValueForFirstParty([]);s&&this.headers.set("Authorization",s),n&&this.headers.set("X-Goog-Iam-Authorization-Token",n)}}class qs{constructor(t,e,n){this.h=t,this.l=e,this.m=n}getToken(){return Promise.resolve(new Us(this.h,this.l,this.m))}start(t,e){t.enqueueRetryable((()=>e(vs.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Bs{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class js{constructor(t){this.g=t,this.forceRefresh=!1,this.appCheck=null,this.p=null}start(t,e){const n=t=>{null!=t.error&&Ss("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.p;return this.p=t.token,Ss("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const s=t=>{Ss("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.g.onInit((t=>s(t))),setTimeout((()=>{if(!this.appCheck){const t=this.g.getImmediate({optional:!0});t?s(t):Ss("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Ds("string"==typeof t.token),this.p=t.token,new Bs(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}class Ks{getToken(){return Promise.resolve(new Bs(""))}invalidateToken(){}start(t,e){}shutdown(){}}class $s{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.I(t),this.T=t=>e.writeSequenceNumber(t))}I(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.T&&this.T(t),t}}function Gs(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}$s.A=-1;class zs{static R(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length;let n="";for(;n.length<20;){const s=Gs(40);for(let r=0;r<s.length;++r)n.length<20&&s[r]<e&&(n+=t.charAt(s[r]%t.length))}return n}}function Hs(t,e){return t<e?-1:t>e?1:0}function Qs(t,e,n){return t.length===e.length&&t.every(((t,s)=>n(t,e[s])))}function Ws(t){return t+"\0"}class Ys{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Rs(Os.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Rs(Os.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Rs(Os.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Rs(Os.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return Ys.fromMillis(Date.now())}static fromDate(t){return Ys.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new Ys(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?Hs(this.nanoseconds,t.nanoseconds):Hs(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Xs{constructor(t){this.timestamp=t}static fromTimestamp(t){return new Xs(t)}static min(){return new Xs(new Ys(0,0))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function Js(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Zs(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function tr(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class er{constructor(t,e,n){void 0===e?e=0:e>t.length&&Cs(),void 0===n?n=t.length-e:n>t.length-e&&Cs(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===er.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof er?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let s=0;s<n;s++){const n=t.get(s),r=e.get(s);if(n<r)return-1;if(n>r)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class nr extends er{construct(t,e,n){return new nr(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Rs(Os.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new nr(e)}static emptyPath(){return new nr([])}}const sr=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class rr extends er{construct(t,e,n){return new rr(t,e,n)}static isValidIdentifier(t){return sr.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),rr.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new rr(["__name__"])}static fromServerFormat(t){const e=[];let n="",s=0;const r=()=>{if(0===n.length)throw new Rs(Os.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;s<t.length;){const e=t[s];if("\\"===e){if(s+1===t.length)throw new Rs(Os.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[s+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Rs(Os.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,s+=2}else"`"===e?(i=!i,s++):"."!==e||i?(n+=e,s++):(r(),s++)}if(r(),i)throw new Rs(Os.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new rr(e)}static emptyPath(){return new rr([])}}class ir{constructor(t){this.fields=t,t.sort(rr.comparator)}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Qs(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}function or(){return"undefined"!=typeof atob}class ar{constructor(t){this.binaryString=t}static fromBase64String(t){const e=atob(t);return new ar(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new ar(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Hs(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}ar.EMPTY_BYTE_STRING=new ar("");const cr=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ur(t){if(Ds(!!t),"string"==typeof t){let e=0;const n=cr.exec(t);if(Ds(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const s=new Date(t);return{seconds:Math.floor(s.getTime()/1e3),nanos:e}}return{seconds:hr(t.seconds),nanos:hr(t.nanos)}}function hr(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function lr(t){return"string"==typeof t?ar.fromBase64String(t):ar.fromUint8Array(t)}function dr(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function fr(t){const e=t.mapValue.fields.__previous_value__;return dr(e)?fr(e):e}function mr(t){const e=ur(t.mapValue.fields.__local_write_time__.timestampValue);return new Ys(e.seconds,e.nanos)}class gr{constructor(t,e,n,s,r,i,o,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=s,this.ssl=r,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.useFetchStreams=a}}class pr{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new pr("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof pr&&t.projectId===this.projectId&&t.database===this.database}}function yr(t){return null==t}function wr(t){return 0===t&&1/t==-1/0}function vr(t){return"number"==typeof t&&Number.isInteger(t)&&!wr(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}class br{constructor(t){this.path=t}static fromPath(t){return new br(nr.fromString(t))}static fromName(t){return new br(nr.fromString(t).popFirst(5))}static empty(){return new br(nr.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===nr.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return nr.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new br(new nr(t.slice()))}}const Ir={mapValue:{fields:{__type__:{stringValue:"__max___"}}}};function Tr(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?dr(t)?4:10:Cs()}function Er(t,e){if(t===e)return!0;const n=Tr(t);if(n!==Tr(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return mr(t).isEqual(mr(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=ur(t.timestampValue),s=ur(e.timestampValue);return n.seconds===s.seconds&&n.nanos===s.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return lr(t.bytesValue).isEqual(lr(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return hr(t.geoPointValue.latitude)===hr(e.geoPointValue.latitude)&&hr(t.geoPointValue.longitude)===hr(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return hr(t.integerValue)===hr(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=hr(t.doubleValue),s=hr(e.doubleValue);return n===s?wr(n)===wr(s):isNaN(n)&&isNaN(s)}return!1}(t,e);case 9:return Qs(t.arrayValue.values||[],e.arrayValue.values||[],Er);case 10:return function(t,e){const n=t.mapValue.fields||{},s=e.mapValue.fields||{};if(Js(n)!==Js(s))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===s[t]||!Er(n[t],s[t])))return!1;return!0}(t,e);default:return Cs()}}function Sr(t,e){return void 0!==(t.values||[]).find((t=>Er(t,e)))}function Ar(t,e){if(t===e)return 0;const n=Tr(t),s=Tr(e);if(n!==s)return Hs(n,s);switch(n){case 0:return 0;case 1:return Hs(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=hr(t.integerValue||t.doubleValue),s=hr(e.integerValue||e.doubleValue);return n<s?-1:n>s?1:n===s?0:isNaN(n)?isNaN(s)?0:-1:1}(t,e);case 3:return _r(t.timestampValue,e.timestampValue);case 4:return _r(mr(t),mr(e));case 5:return Hs(t.stringValue,e.stringValue);case 6:return function(t,e){const n=lr(t),s=lr(e);return n.compareTo(s)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),s=e.split("/");for(let t=0;t<n.length&&t<s.length;t++){const e=Hs(n[t],s[t]);if(0!==e)return e}return Hs(n.length,s.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Hs(hr(t.latitude),hr(e.latitude));return 0!==n?n:Hs(hr(t.longitude),hr(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],s=e.values||[];for(let t=0;t<n.length&&t<s.length;++t){const e=Ar(n[t],s[t]);if(e)return e}return Hs(n.length,s.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){const n=t.fields||{},s=Object.keys(n),r=e.fields||{},i=Object.keys(r);s.sort(),i.sort();for(let t=0;t<s.length&&t<i.length;++t){const e=Hs(s[t],i[t]);if(0!==e)return e;const o=Ar(n[s[t]],r[i[t]]);if(0!==o)return o}return Hs(s.length,i.length)}(t.mapValue,e.mapValue);default:throw Cs()}}function _r(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Hs(t,e);const n=ur(t),s=ur(e),r=Hs(n.seconds,s.seconds);return 0!==r?r:Hs(n.nanos,s.nanos)}function Nr(t){return Cr(t)}function Cr(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=ur(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?lr(t.bytesValue).toBase64():"referenceValue"in t?(n=t.referenceValue,br.fromName(n).toString()):"geoPointValue"in t?`geo(${(e=t.geoPointValue).latitude},${e.longitude})`:"arrayValue"in t?function(t){let e="[",n=!0;for(const s of t.values||[])n?n=!1:e+=",",e+=Cr(s);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",s=!0;for(const r of e)s?s=!1:n+=",",n+=`${r}:${Cr(t.fields[r])}`;return n+"}"}(t.mapValue):Cs();var e,n}function Dr(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function xr(t){return!!t&&"integerValue"in t}function kr(t){return!!t&&"arrayValue"in t}function Or(t){return!!t&&"nullValue"in t}function Rr(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Lr(t){return!!t&&"mapValue"in t}function Mr(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Zs(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=Mr(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Mr(t.arrayValue.values[n]);return e}return Object.assign({},t)}class Pr{constructor(t){this.value=t}static empty(){return new Pr({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!Lr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Mr(e)}setAll(t){let e=rr.emptyPath(),n={},s=[];t.forEach(((t,r)=>{if(!e.isImmediateParentOf(r)){const t=this.getFieldsMap(e);this.applyChanges(t,n,s),n={},s=[],e=r.popLast()}t?n[r.lastSegment()]=Mr(t):s.push(r.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,n,s)}delete(t){const e=this.field(t.popLast());Lr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Er(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let s=e.mapValue.fields[t.get(n)];Lr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,n){Zs(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new Pr(Mr(this.value))}}function Fr(t){const e=[];return Zs(t.fields,((t,n)=>{const s=new rr([t]);if(Lr(n)){const t=Fr(n.mapValue).fields;if(0===t.length)e.push(s);else for(const n of t)e.push(s.child(n))}else e.push(s)})),new ir(e)}class Vr{constructor(t,e,n,s,r,i){this.key=t,this.documentType=e,this.version=n,this.readTime=s,this.data=r,this.documentState=i}static newInvalidDocument(t){return new Vr(t,0,Xs.min(),Xs.min(),Pr.empty(),0)}static newFoundDocument(t,e,n){return new Vr(t,1,e,Xs.min(),n,0)}static newNoDocument(t,e){return new Vr(t,2,e,Xs.min(),Pr.empty(),0)}static newUnknownDocument(t,e){return new Vr(t,3,e,Xs.min(),Pr.empty(),2)}convertToFoundDocument(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Pr.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Pr.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof Vr&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Vr(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Ur{constructor(t,e,n,s){this.indexId=t,this.collectionGroup=e,this.fields=n,this.indexState=s}}Ur.UNKNOWN_ID=-1;class qr{constructor(t,e){this.fieldPath=t,this.kind=e}}class Br{constructor(t,e){this.sequenceNumber=t,this.offset=e}static empty(){return new Br(0,jr.min())}}class jr{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new jr(Xs.min(),br.empty(),-1)}}class Kr{constructor(t,e=null,n=[],s=[],r=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=s,this.limit=r,this.startAt=i,this.endAt=o,this.P=null}}function $r(t,e=null,n=[],s=[],r=null,i=null,o=null){return new Kr(t,e,n,s,r,i,o)}function Gr(t){const e=ks(t);if(null===e.P){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>{return(e=t).field.canonicalString()+e.op.toString()+Nr(e.value);var e})).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),yr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>Nr(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>Nr(t))).join(",")),e.P=t}return e.P}function zr(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!ii(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let r=0;r<t.filters.length;r++)if(n=t.filters[r],s=e.filters[r],n.op!==s.op||!n.field.isEqual(s.field)||!Er(n.value,s.value))return!1;var n,s;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!ai(t.startAt,e.startAt)&&ai(t.endAt,e.endAt)}function Hr(t){return br.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Qr extends class{}{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.v(t,e,n):new Wr(t,e,n):"array-contains"===e?new Zr(t,n):"in"===e?new ti(t,n):"not-in"===e?new ei(t,n):"array-contains-any"===e?new ni(t,n):new Qr(t,e,n)}static v(t,e,n){return"in"===e?new Yr(t,n):new Xr(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.V(Ar(e,this.value)):null!==e&&Tr(this.value)===Tr(e)&&this.V(Ar(e,this.value))}V(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Cs()}}S(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}class Wr extends Qr{constructor(t,e,n){super(t,e,n),this.key=br.fromName(n.referenceValue)}matches(t){const e=br.comparator(t.key,this.key);return this.V(e)}}class Yr extends Qr{constructor(t,e){super(t,"in",e),this.keys=Jr(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Xr extends Qr{constructor(t,e){super(t,"not-in",e),this.keys=Jr(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Jr(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>br.fromName(t.referenceValue)))}class Zr extends Qr{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return kr(e)&&Sr(e.arrayValue,this.value)}}class ti extends Qr{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Sr(this.value.arrayValue,e)}}class ei extends Qr{constructor(t,e){super(t,"not-in",e)}matches(t){if(Sr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!Sr(this.value.arrayValue,e)}}class ni extends Qr{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!kr(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>Sr(this.value.arrayValue,t)))}}class si{constructor(t,e){this.position=t,this.inclusive=e}}class ri{constructor(t,e="asc"){this.field=t,this.dir=e}}function ii(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function oi(t,e,n){let s=0;for(let r=0;r<t.position.length;r++){const i=e[r],o=t.position[r];if(s=i.field.isKeyField()?br.comparator(br.fromName(o.referenceValue),n.key):Ar(o,n.data.field(i.field)),"desc"===i.dir&&(s*=-1),0!==s)break}return s}function ai(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Er(t.position[n],e.position[n]))return!1;return!0}class ci{constructor(t,e=null,n=[],s=[],r=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=s,this.limit=r,this.limitType=i,this.startAt=o,this.endAt=a,this.D=null,this.C=null,this.startAt,this.endAt}}function ui(t,e,n,s,r,i,o,a){return new ci(t,e,n,s,r,i,o,a)}function hi(t){return new ci(t)}function li(t){return!yr(t.limit)&&"F"===t.limitType}function di(t){return!yr(t.limit)&&"L"===t.limitType}function fi(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function mi(t){for(const e of t.filters)if(e.S())return e.field;return null}function gi(t){return null!==t.collectionGroup}function pi(t){const e=ks(t);if(null===e.D){e.D=[];const t=mi(e),n=fi(e);if(null!==t&&null===n)t.isKeyField()||e.D.push(new ri(t)),e.D.push(new ri(rr.keyField(),"asc"));else{let t=!1;for(const n of e.explicitOrderBy)e.D.push(n),n.field.isKeyField()&&(t=!0);if(!t){const t=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.D.push(new ri(rr.keyField(),t))}}}return e.D}function yi(t){const e=ks(t);if(!e.C)if("F"===e.limitType)e.C=$r(e.path,e.collectionGroup,pi(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const n of pi(e)){const e="desc"===n.dir?"asc":"desc";t.push(new ri(n.field,e))}const n=e.endAt?new si(e.endAt.position,!e.endAt.inclusive):null,s=e.startAt?new si(e.startAt.position,!e.startAt.inclusive):null;e.C=$r(e.path,e.collectionGroup,t,e.filters,e.limit,n,s)}return e.C}function wi(t,e,n){return new ci(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function vi(t,e){return zr(yi(t),yi(e))&&t.limitType===e.limitType}function bi(t){return`${Gr(yi(t))}|lt:${t.limitType}`}function Ii(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>{return`${(e=t).field.canonicalString()} ${e.op} ${Nr(e.value)}`;var e})).join(", ")}]`),yr(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>Nr(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>Nr(t))).join(",")),`Target(${e})`}(yi(t))}; limitType=${t.limitType})`}function Ti(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):br.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of t.explicitOrderBy)if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const s=oi(t,e,n);return t.inclusive?s<=0:s<0}(t.startAt,pi(t),e)||t.endAt&&!function(t,e,n){const s=oi(t,e,n);return t.inclusive?s>=0:s>0}(t.endAt,pi(t),e))}(t,e)}function Ei(t){return(e,n)=>{let s=!1;for(const r of pi(t)){const t=Si(r,e,n);if(0!==t)return t;s=s||r.field.isKeyField()}return 0}}function Si(t,e,n){const s=t.field.isKeyField()?br.comparator(e.key,n.key):function(t,e,n){const s=e.data.field(t),r=n.data.field(t);return null!==s&&null!==r?Ar(s,r):Cs()}(t.field,e,n);switch(t.dir){case"asc":return s;case"desc":return-1*s;default:return Cs()}}function Ai(t,e){if(t.N){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:wr(e)?"-0":e}}function _i(t){return{integerValue:""+t}}function Ni(t,e){return vr(e)?_i(e):Ai(t,e)}class Ci{constructor(){this._=void 0}}function Di(t,e,n){return t instanceof Oi?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ri?Li(t,e):t instanceof Mi?Pi(t,e):function(t,e){const n=ki(t,e),s=Vi(n)+Vi(t.k);return xr(n)&&xr(t.k)?_i(s):Ai(t.O,s)}(t,e)}function xi(t,e,n){return t instanceof Ri?Li(t,e):t instanceof Mi?Pi(t,e):n}function ki(t,e){return t instanceof Fi?xr(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}class Oi extends Ci{}class Ri extends Ci{constructor(t){super(),this.elements=t}}function Li(t,e){const n=Ui(e);for(const e of t.elements)n.some((t=>Er(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Mi extends Ci{constructor(t){super(),this.elements=t}}function Pi(t,e){let n=Ui(e);for(const e of t.elements)n=n.filter((t=>!Er(t,e)));return{arrayValue:{values:n}}}class Fi extends Ci{constructor(t,e){super(),this.O=t,this.k=e}}function Vi(t){return hr(t.integerValue||t.doubleValue)}function Ui(t){return kr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class qi{constructor(t,e){this.field=t,this.transform=e}}class Bi{constructor(t,e){this.version=t,this.transformResults=e}}class ji{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new ji}static exists(t){return new ji(void 0,t)}static updateTime(t){return new ji(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ki(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class $i{}function Gi(t,e,n){t instanceof Yi?function(t,e,n){const s=t.value.clone(),r=Zi(t.fieldTransforms,e,n.transformResults);s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):t instanceof Xi?function(t,e,n){if(!Ki(t.precondition,e))return void e.convertToUnknownDocument(n.version);const s=Zi(t.fieldTransforms,e,n.transformResults),r=e.data;r.setAll(Ji(t)),r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function zi(t,e,n){t instanceof Yi?function(t,e,n){if(!Ki(t.precondition,e))return;const s=t.value.clone(),r=to(t.fieldTransforms,n,e);s.setAll(r),e.convertToFoundDocument(Wi(e),s).setHasLocalMutations()}(t,e,n):t instanceof Xi?function(t,e,n){if(!Ki(t.precondition,e))return;const s=to(t.fieldTransforms,n,e),r=e.data;r.setAll(Ji(t)),r.setAll(s),e.convertToFoundDocument(Wi(e),r).setHasLocalMutations()}(t,e,n):function(t,e){Ki(t.precondition,e)&&e.convertToNoDocument(Xs.min())}(t,e)}function Hi(t,e){let n=null;for(const s of t.fieldTransforms){const t=e.data.field(s.field),r=ki(s.transform,t||null);null!=r&&(null==n&&(n=Pr.empty()),n.set(s.field,r))}return n||null}function Qi(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Qs(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ri&&e instanceof Ri||t instanceof Mi&&e instanceof Mi?Qs(t.elements,e.elements,Er):t instanceof Fi&&e instanceof Fi?Er(t.k,e.k):t instanceof Oi&&e instanceof Oi}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Wi(t){return t.isFoundDocument()?t.version:Xs.min()}class Yi extends $i{constructor(t,e,n,s=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=s,this.type=0}}class Xi extends $i{constructor(t,e,n,s,r=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=s,this.fieldTransforms=r,this.type=1}}function Ji(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const s=t.data.field(n);e.set(n,s)}})),e}function Zi(t,e,n){const s=new Map;Ds(t.length===n.length);for(let r=0;r<n.length;r++){const i=t[r],o=i.transform,a=e.data.field(i.field);s.set(i.field,xi(o,a,n[r]))}return s}function to(t,e,n){const s=new Map;for(const r of t){const t=r.transform,i=n.data.field(r.field);s.set(r.field,Di(t,i,e))}return s}class eo extends $i{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}}class no extends $i{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}}class so{constructor(t){this.count=t}}var ro,io;function oo(t){switch(t){default:return Cs();case Os.CANCELLED:case Os.UNKNOWN:case Os.DEADLINE_EXCEEDED:case Os.RESOURCE_EXHAUSTED:case Os.INTERNAL:case Os.UNAVAILABLE:case Os.UNAUTHENTICATED:return!1;case Os.INVALID_ARGUMENT:case Os.NOT_FOUND:case Os.ALREADY_EXISTS:case Os.PERMISSION_DENIED:case Os.FAILED_PRECONDITION:case Os.ABORTED:case Os.OUT_OF_RANGE:case Os.UNIMPLEMENTED:case Os.DATA_LOSS:return!0}}function ao(t){if(void 0===t)return As("GRPC error has no .code"),Os.UNKNOWN;switch(t){case ro.OK:return Os.OK;case ro.CANCELLED:return Os.CANCELLED;case ro.UNKNOWN:return Os.UNKNOWN;case ro.DEADLINE_EXCEEDED:return Os.DEADLINE_EXCEEDED;case ro.RESOURCE_EXHAUSTED:return Os.RESOURCE_EXHAUSTED;case ro.INTERNAL:return Os.INTERNAL;case ro.UNAVAILABLE:return Os.UNAVAILABLE;case ro.UNAUTHENTICATED:return Os.UNAUTHENTICATED;case ro.INVALID_ARGUMENT:return Os.INVALID_ARGUMENT;case ro.NOT_FOUND:return Os.NOT_FOUND;case ro.ALREADY_EXISTS:return Os.ALREADY_EXISTS;case ro.PERMISSION_DENIED:return Os.PERMISSION_DENIED;case ro.FAILED_PRECONDITION:return Os.FAILED_PRECONDITION;case ro.ABORTED:return Os.ABORTED;case ro.OUT_OF_RANGE:return Os.OUT_OF_RANGE;case ro.UNIMPLEMENTED:return Os.UNIMPLEMENTED;case ro.DATA_LOSS:return Os.DATA_LOSS;default:return Cs()}}(io=ro||(ro={}))[io.OK=0]="OK",io[io.CANCELLED=1]="CANCELLED",io[io.UNKNOWN=2]="UNKNOWN",io[io.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",io[io.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",io[io.NOT_FOUND=5]="NOT_FOUND",io[io.ALREADY_EXISTS=6]="ALREADY_EXISTS",io[io.PERMISSION_DENIED=7]="PERMISSION_DENIED",io[io.UNAUTHENTICATED=16]="UNAUTHENTICATED",io[io.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",io[io.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",io[io.ABORTED=10]="ABORTED",io[io.OUT_OF_RANGE=11]="OUT_OF_RANGE",io[io.UNIMPLEMENTED=12]="UNIMPLEMENTED",io[io.INTERNAL=13]="INTERNAL",io[io.UNAVAILABLE=14]="UNAVAILABLE",io[io.DATA_LOSS=15]="DATA_LOSS";class co{constructor(t,e){this.comparator=t,this.root=e||ho.EMPTY}insert(t,e){return new co(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ho.BLACK,null,null))}remove(t){return new co(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ho.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const s=this.comparator(t,n.key);if(0===s)return e+n.left.size;s<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new uo(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new uo(this.root,t,this.comparator,!1)}getReverseIterator(){return new uo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new uo(this.root,t,this.comparator,!0)}}class uo{constructor(t,e,n,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?n(t.key,e):1,s&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(0===r){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ho{constructor(t,e,n,s,r){this.key=t,this.value=e,this.color=null!=n?n:ho.RED,this.left=null!=s?s:ho.EMPTY,this.right=null!=r?r:ho.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,s,r){return new ho(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=s?s:this.left,null!=r?r:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let s=this;const r=n(t,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(t,e,n),null):0===r?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,n)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ho.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),0===e(t,s.key)){if(s.right.isEmpty())return ho.EMPTY;n=s.right.min(),s=s.copy(n.key,n.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ho.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ho.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Cs();if(this.right.isRed())throw Cs();const t=this.left.check();if(t!==this.right.check())throw Cs();return t+(this.isRed()?0:1)}}ho.EMPTY=null,ho.RED=!0,ho.BLACK=!1,ho.EMPTY=new class{constructor(){this.size=0}get key(){throw Cs()}get value(){throw Cs()}get color(){throw Cs()}get left(){throw Cs()}get right(){throw Cs()}copy(t,e,n,s,r){return this}insert(t,e,n){return new ho(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class lo{constructor(t){this.comparator=t,this.data=new co(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const s=n.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new fo(this.data.getIterator())}getIteratorFrom(t){return new fo(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof lo))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(0!==this.comparator(t,s))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new lo(this.comparator);return e.data=t,e}}class fo{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function mo(t){return t.hasNext()?t.getNext():void 0}const go=new co(br.comparator);function po(){return go}const yo=new co(br.comparator);function wo(){return yo}const vo=new co(br.comparator),bo=new lo(br.comparator);function Io(...t){let e=bo;for(const n of t)e=e.add(n);return e}const To=new lo(Hs);function Eo(){return To}class So{constructor(t,e,n,s,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e){const n=new Map;return n.set(t,Ao.createSynthesizedTargetChangeForCurrentChange(t,e)),new So(Xs.min(),n,Eo(),po(),Io())}}class Ao{constructor(t,e,n,s,r){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e){return new Ao(ar.EMPTY_BYTE_STRING,e,Io(),Io(),Io())}}class _o{constructor(t,e,n,s){this.M=t,this.removedTargetIds=e,this.key=n,this.$=s}}class No{constructor(t,e){this.targetId=t,this.F=e}}class Co{constructor(t,e,n=ar.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=s}}class Do{constructor(){this.B=0,this.L=Oo(),this.U=ar.EMPTY_BYTE_STRING,this.q=!1,this.K=!0}get current(){return this.q}get resumeToken(){return this.U}get G(){return 0!==this.B}get j(){return this.K}W(t){t.approximateByteSize()>0&&(this.K=!0,this.U=t)}H(){let t=Io(),e=Io(),n=Io();return this.L.forEach(((s,r)=>{switch(r){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:n=n.add(s);break;default:Cs()}})),new Ao(this.U,this.q,t,e,n)}J(){this.K=!1,this.L=Oo()}Y(t,e){this.K=!0,this.L=this.L.insert(t,e)}X(t){this.K=!0,this.L=this.L.remove(t)}Z(){this.B+=1}tt(){this.B-=1}et(){this.K=!0,this.q=!0}}class xo{constructor(t){this.nt=t,this.st=new Map,this.it=po(),this.rt=ko(),this.ot=new lo(Hs)}ct(t){for(const e of t.M)t.$&&t.$.isFoundDocument()?this.ut(e,t.$):this.at(e,t.key,t.$);for(const e of t.removedTargetIds)this.at(e,t.key,t.$)}ht(t){this.forEachTarget(t,(e=>{const n=this.lt(e);switch(t.state){case 0:this.ft(e)&&n.W(t.resumeToken);break;case 1:n.tt(),n.G||n.J(),n.W(t.resumeToken);break;case 2:n.tt(),n.G||this.removeTarget(e);break;case 3:this.ft(e)&&(n.et(),n.W(t.resumeToken));break;case 4:this.ft(e)&&(this.dt(e),n.W(t.resumeToken));break;default:Cs()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.st.forEach(((t,n)=>{this.ft(n)&&e(n)}))}_t(t){const e=t.targetId,n=t.F.count,s=this.wt(e);if(s){const t=s.target;if(Hr(t))if(0===n){const n=new br(t.path);this.at(e,n,Vr.newNoDocument(n,Xs.min()))}else Ds(1===n);else this.gt(e)!==n&&(this.dt(e),this.ot=this.ot.add(e))}}yt(t){const e=new Map;this.st.forEach(((n,s)=>{const r=this.wt(s);if(r){if(n.current&&Hr(r.target)){const e=new br(r.target.path);null!==this.it.get(e)||this.It(s,e)||this.at(s,e,Vr.newNoDocument(e,t))}n.j&&(e.set(s,n.H()),n.J())}}));let n=Io();this.rt.forEach(((t,e)=>{let s=!0;e.forEachWhile((t=>{const e=this.wt(t);return!e||2===e.purpose||(s=!1,!1)})),s&&(n=n.add(t))})),this.it.forEach(((e,n)=>n.setReadTime(t)));const s=new So(t,e,this.ot,this.it,n);return this.it=po(),this.rt=ko(),this.ot=new lo(Hs),s}ut(t,e){if(!this.ft(t))return;const n=this.It(t,e.key)?2:0;this.lt(t).Y(e.key,n),this.it=this.it.insert(e.key,e),this.rt=this.rt.insert(e.key,this.Et(e.key).add(t))}at(t,e,n){if(!this.ft(t))return;const s=this.lt(t);this.It(t,e)?s.Y(e,1):s.X(e),this.rt=this.rt.insert(e,this.Et(e).delete(t)),n&&(this.it=this.it.insert(e,n))}removeTarget(t){this.st.delete(t)}gt(t){const e=this.lt(t).H();return this.nt.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Z(t){this.lt(t).Z()}lt(t){let e=this.st.get(t);return e||(e=new Do,this.st.set(t,e)),e}Et(t){let e=this.rt.get(t);return e||(e=new lo(Hs),this.rt=this.rt.insert(t,e)),e}ft(t){const e=null!==this.wt(t);return e||Ss("WatchChangeAggregator","Detected inactive target",t),e}wt(t){const e=this.st.get(t);return e&&e.G?null:this.nt.Tt(t)}dt(t){this.st.set(t,new Do),this.nt.getRemoteKeysForTarget(t).forEach((e=>{this.at(t,e,null)}))}It(t,e){return this.nt.getRemoteKeysForTarget(t).has(e)}}function ko(){return new co(br.comparator)}function Oo(){return new co(br.comparator)}const Ro={asc:"ASCENDING",desc:"DESCENDING"},Lo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"};class Mo{constructor(t,e){this.databaseId=t,this.N=e}}function Po(t,e){return t.N?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Fo(t,e){return t.N?e.toBase64():e.toUint8Array()}function Vo(t,e){return Po(t,e.toTimestamp())}function Uo(t){return Ds(!!t),Xs.fromTimestamp(function(t){const e=ur(t);return new Ys(e.seconds,e.nanos)}(t))}function qo(t,e){return function(t){return new nr(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Bo(t){const e=nr.fromString(t);return Ds(ua(e)),e}function jo(t,e){return qo(t.databaseId,e.path)}function Ko(t,e){const n=Bo(e);if(n.get(1)!==t.databaseId.projectId)throw new Rs(Os.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Rs(Os.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new br(Ho(n))}function $o(t,e){return qo(t.databaseId,e)}function Go(t){const e=Bo(t);return 4===e.length?nr.emptyPath():Ho(e)}function zo(t){return new nr(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Ho(t){return Ds(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Qo(t,e,n){return{name:jo(t,e),fields:n.value.mapValue.fields}}function Wo(t,e,n){const s=Ko(t,e.name),r=Uo(e.updateTime),i=new Pr({mapValue:{fields:e.fields}}),o=Vr.newFoundDocument(s,r,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Yo(t,e){let n;if(e instanceof Yi)n={update:Qo(t,e.key,e.value)};else if(e instanceof eo)n={delete:jo(t,e.key)};else if(e instanceof Xi)n={update:Qo(t,e.key,e.data),updateMask:ca(e.fieldMask)};else{if(!(e instanceof no))return Cs();n={verify:jo(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Oi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ri)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Mi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Fi)return{fieldPath:e.field.canonicalString(),increment:n.k};throw Cs()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:Vo(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Cs()}(t,e.precondition)),n}function Xo(t,e){const n=e.currentDocument?function(t){return void 0!==t.updateTime?ji.updateTime(Uo(t.updateTime)):void 0!==t.exists?ji.exists(t.exists):ji.none()}(e.currentDocument):ji.none(),s=e.updateTransforms?e.updateTransforms.map((e=>function(t,e){let n=null;if("setToServerValue"in e)Ds("REQUEST_TIME"===e.setToServerValue),n=new Oi;else if("appendMissingElements"in e){const t=e.appendMissingElements.values||[];n=new Ri(t)}else if("removeAllFromArray"in e){const t=e.removeAllFromArray.values||[];n=new Mi(t)}else"increment"in e?n=new Fi(t,e.increment):Cs();const s=rr.fromServerFormat(e.fieldPath);return new qi(s,n)}(t,e))):[];if(e.update){e.update.name;const r=Ko(t,e.update.name),i=new Pr({mapValue:{fields:e.update.fields}});if(e.updateMask){const t=function(t){const e=t.fieldPaths||[];return new ir(e.map((t=>rr.fromServerFormat(t))))}(e.updateMask);return new Xi(r,i,t,n,s)}return new Yi(r,i,n,s)}if(e.delete){const s=Ko(t,e.delete);return new eo(s,n)}if(e.verify){const s=Ko(t,e.verify);return new no(s,n)}return Cs()}function Jo(t,e){return{documents:[$o(t,e.path)]}}function Zo(t,e){const n={structuredQuery:{}},s=e.path;null!==e.collectionGroup?(n.parent=$o(t,s),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=$o(t,s.popLast()),n.structuredQuery.from=[{collectionId:s.lastSegment()}]);const r=function(t){if(0===t.length)return;const e=t.map((t=>function(t){if("=="===t.op){if(Rr(t.value))return{unaryFilter:{field:ra(t.field),op:"IS_NAN"}};if(Or(t.value))return{unaryFilter:{field:ra(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(Rr(t.value))return{unaryFilter:{field:ra(t.field),op:"IS_NOT_NAN"}};if(Or(t.value))return{unaryFilter:{field:ra(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ra(t.field),op:sa(t.op),value:t.value}}}(t)));return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}(e.filters);r&&(n.structuredQuery.where=r);const i=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:ra(t.field),direction:na(t.dir)}}(t)))}(e.orderBy);i&&(n.structuredQuery.orderBy=i);const o=function(t,e){return t.N||yr(e)?e:{value:e}}(t,e.limit);var a;return null!==o&&(n.structuredQuery.limit=o),e.startAt&&(n.structuredQuery.startAt={before:(a=e.startAt).inclusive,values:a.position}),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),n}function ta(t){let e=Go(t.parent);const n=t.structuredQuery,s=n.from?n.from.length:0;let r=null;if(s>0){Ds(1===s);const t=n.from[0];t.allDescendants?r=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=ea(n.where));let o=[];n.orderBy&&(o=n.orderBy.map((t=>function(t){return new ri(ia(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,yr(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new si(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new si(n,e)}(n.endAt)),ui(e,r,o,i,a,"F",c,u)}function ea(t){return t?void 0!==t.unaryFilter?[aa(t)]:void 0!==t.fieldFilter?[oa(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((t=>ea(t))).reduce(((t,e)=>t.concat(e))):Cs():[]}function na(t){return Ro[t]}function sa(t){return Lo[t]}function ra(t){return{fieldPath:t.canonicalString()}}function ia(t){return rr.fromServerFormat(t.fieldPath)}function oa(t){return Qr.create(ia(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Cs()}}(t.fieldFilter.op),t.fieldFilter.value)}function aa(t){switch(t.unaryFilter.op){case"IS_NAN":const e=ia(t.unaryFilter.field);return Qr.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=ia(t.unaryFilter.field);return Qr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const s=ia(t.unaryFilter.field);return Qr.create(s,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const r=ia(t.unaryFilter.field);return Qr.create(r,"!=",{nullValue:"NULL_VALUE"});default:return Cs()}}function ca(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function ua(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function ha(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=da(e)),e=la(t.get(n),e);return da(e)}function la(t,e){let n=e;const s=t.length;for(let e=0;e<s;e++){const s=t.charAt(e);switch(s){case"\0":n+="";break;case"":n+="";break;default:n+=s}}return n}function da(t){return t+""}function fa(t){const e=t.length;if(Ds(e>=2),2===e)return Ds(""===t.charAt(0)&&""===t.charAt(1)),nr.emptyPath();const n=e-2,s=[];let r="";for(let i=0;i<e;){const e=t.indexOf("",i);switch((e<0||e>n)&&Cs(),t.charAt(e+1)){case"":const n=t.substring(i,e);let o;0===r.length?o=n:(r+=n,o=r,r=""),s.push(o);break;case"":r+=t.substring(i,e),r+="\0";break;case"":r+=t.substring(i,e+1);break;default:Cs()}i=e+2}return new nr(s)}class ma{constructor(t,e){this.seconds=t,this.nanoseconds=e}}class ga{constructor(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}}ga.store="owner",ga.key="owner";class pa{constructor(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}}pa.store="mutationQueues",pa.keyPath="userId";class ya{constructor(t,e,n,s,r){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=s,this.mutations=r}}ya.store="mutations",ya.keyPath="batchId",ya.userMutationsIndex="userMutationsIndex",ya.userMutationsKeyPath=["userId","batchId"];class wa{constructor(){}static prefixForUser(t){return[t]}static prefixForPath(t,e){return[t,ha(e)]}static key(t,e,n){return[t,ha(e),n]}}wa.store="documentMutations",wa.PLACEHOLDER=new wa;class va{constructor(t,e){this.path=t,this.readTime=e}}class ba{constructor(t,e){this.path=t,this.version=e}}class Ia{constructor(t,e,n,s,r,i){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=s,this.readTime=r,this.parentPath=i}}Ia.store="remoteDocuments",Ia.readTimeIndex="readTimeIndex",Ia.readTimeIndexPath="readTime",Ia.collectionReadTimeIndex="collectionReadTimeIndex",Ia.collectionReadTimeIndexPath=["parentPath","readTime"];class Ta{constructor(t){this.byteSize=t}}Ta.store="remoteDocumentGlobal",Ta.key="remoteDocumentGlobalKey";class Ea{constructor(t,e,n,s,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=s,this.lastListenSequenceNumber=r,this.lastLimboFreeSnapshotVersion=i,this.query=o}}Ea.store="targets",Ea.keyPath="targetId",Ea.queryTargetsIndexName="queryTargetsIndex",Ea.queryTargetsKeyPath=["canonicalId","targetId"];class Sa{constructor(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n}}Sa.store="targetDocuments",Sa.keyPath=["targetId","path"],Sa.documentTargetsIndex="documentTargetsIndex",Sa.documentTargetsKeyPath=["path","targetId"];class Aa{constructor(t,e,n,s){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=s}}Aa.key="targetGlobalKey",Aa.store="targetGlobal";class _a{constructor(t,e){this.collectionId=t,this.parent=e}}_a.store="collectionParents",_a.keyPath=["collectionId","parent"];class Na{constructor(t,e,n,s){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=s}}Na.store="clientMetadata",Na.keyPath="clientId";class Ca{constructor(t,e,n){this.bundleId=t,this.createTime=e,this.version=n}}Ca.store="bundles",Ca.keyPath="bundleId";class Da{constructor(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n}}Da.store="namedQueries",Da.keyPath="name";class xa{constructor(t,e,n){this.indexId=t,this.collectionGroup=e,this.fields=n}}xa.store="indexConfiguration",xa.keyPath="indexId",xa.collectionGroupIndex="collectionGroupIndex",xa.collectionGroupIndexPath="collectionGroup";class ka{constructor(t,e,n,s,r,i){this.indexId=t,this.uid=e,this.sequenceNumber=n,this.readTime=s,this.documentKey=r,this.largestBatchId=i}}ka.store="indexState",ka.keyPath=["indexId","uid"],ka.sequenceNumberIndex="sequenceNumberIndex",ka.sequenceNumberIndexPath=["uid","sequenceNumber"];class Oa{constructor(t,e,n,s,r){this.indexId=t,this.uid=e,this.arrayValue=n,this.directionalValue=s,this.documentKey=r}}Oa.store="indexEntries",Oa.keyPath=["indexId","uid","arrayValue","directionalValue","documentKey"],Oa.documentKeyIndex="documentKeyIndex",Oa.documentKeyIndexPath=["indexId","uid","documentKey"];class Ra{constructor(t,e,n,s,r,i){this.userId=t,this.collectionPath=e,this.documentId=n,this.collectionGroup=s,this.largestBatchId=r,this.overlayMutation=i}}Ra.store="documentOverlays",Ra.keyPath=["userId","collectionPath","documentId"],Ra.collectionPathOverlayIndex="collectionPathOverlayIndex",Ra.collectionPathOverlayIndexPath=["userId","collectionPath","largestBatchId"],Ra.collectionGroupOverlayIndex="collectionGroupOverlayIndex",Ra.collectionGroupOverlayIndexPath=["userId","collectionGroup","largestBatchId"];const La=[pa.store,ya.store,wa.store,Ia.store,Ea.store,ga.store,Aa.store,Sa.store,Na.store,Ta.store,_a.store,Ca.store,Da.store],Ma=[...La,Ra.store],Pa=[...Ma,xa.store,ka.store,Oa.store],Fa="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Va{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}class Ua{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Cs(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Ua(((n,s)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,s)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof Ua?e:Ua.resolve(e)}catch(t){return Ua.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):Ua.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):Ua.reject(e)}static resolve(t){return new Ua(((e,n)=>{e(t)}))}static reject(t){return new Ua(((e,n)=>{n(t)}))}static waitFor(t){return new Ua(((e,n)=>{let s=0,r=0,i=!1;t.forEach((t=>{++s,t.next((()=>{++r,i&&r===s&&e()}),(t=>n(t)))})),i=!0,r===s&&e()}))}static or(t){let e=Ua.resolve(!1);for(const n of t)e=e.next((t=>t?Ua.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,s)=>{n.push(e.call(this,t,s))})),this.waitFor(n)}}class qa{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.At=new Ls,this.transaction.oncomplete=()=>{this.At.resolve()},this.transaction.onabort=()=>{e.error?this.At.reject(new Ka(t,e.error)):this.At.resolve()},this.transaction.onerror=e=>{const n=Qa(e.target.error);this.At.reject(new Ka(t,n))}}static open(t,e,n,s){try{return new qa(e,t.transaction(s,n))}catch(t){throw new Ka(e,t)}}get Rt(){return this.At.promise}abort(t){t&&this.At.reject(t),this.aborted||(Ss("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}Pt(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Ga(e)}}class Ba{constructor(t,e,n){this.name=t,this.version=e,this.bt=n,12.2===Ba.vt((0,a.z$)())&&As("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return Ss("SimpleDb","Removing database:",t),za(window.indexedDB.deleteDatabase(t)).toPromise()}static Vt(){if(!(0,a.hl)())return!1;if(Ba.St())return!0;const t=(0,a.z$)(),e=Ba.vt(t),n=0<e&&e<10,s=Ba.Dt(t),r=0<s&&s<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||r)}static St(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Ct)}static Nt(t,e){return t.store(e)}static vt(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static Dt(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async xt(t){return this.db||(Ss("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const s=indexedDB.open(this.name,this.version);s.onsuccess=t=>{const n=t.target.result;e(n)},s.onblocked=()=>{n(new Ka(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=e=>{const s=e.target.error;"VersionError"===s.name?n(new Rs(Os.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===s.name?n(new Rs(Os.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+s)):n(new Ka(t,s))},s.onupgradeneeded=t=>{Ss("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.bt.kt(e,s.transaction,t.oldVersion,this.version).next((()=>{Ss("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.Ot&&(this.db.onversionchange=t=>this.Ot(t)),this.db}Mt(t){this.Ot=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,s){const r="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.xt(t);const e=qa.open(this.db,t,r?"readonly":"readwrite",n),i=s(e).next((t=>(e.Pt(),t))).catch((t=>(e.abort(t),Ua.reject(t)))).toPromise();return i.catch((()=>{})),await e.Rt,i}catch(t){const e="FirebaseError"!==t.name&&i<3;if(Ss("SimpleDb","Transaction failed with error:",t.message,"Retrying:",e),this.close(),!e)return Promise.reject(t)}}}close(){this.db&&this.db.close(),this.db=void 0}}class ja{constructor(t){this.$t=t,this.Ft=!1,this.Bt=null}get isDone(){return this.Ft}get Lt(){return this.Bt}set cursor(t){this.$t=t}done(){this.Ft=!0}Ut(t){this.Bt=t}delete(){return za(this.$t.delete())}}class Ka extends Rs{constructor(t,e){super(Os.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function $a(t){return"IndexedDbTransactionError"===t.name}class Ga{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(Ss("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Ss("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),za(n)}add(t){return Ss("SimpleDb","ADD",this.store.name,t,t),za(this.store.add(t))}get(t){return za(this.store.get(t)).next((e=>(void 0===e&&(e=null),Ss("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return Ss("SimpleDb","DELETE",this.store.name,t),za(this.store.delete(t))}count(){return Ss("SimpleDb","COUNT",this.store.name),za(this.store.count())}qt(t,e){const n=this.options(t,e);if(n.index||"function"!=typeof this.store.getAll){const t=this.cursor(n),e=[];return this.Kt(t,((t,n)=>{e.push(n)})).next((()=>e))}{const t=this.store.getAll(n.range);return new Ua(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}}Gt(t,e){Ss("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.jt=!1;const s=this.cursor(n);return this.Kt(s,((t,e,n)=>n.delete()))}Qt(t,e){let n;e?n=t:(n={},e=t);const s=this.cursor(n);return this.Kt(s,e)}Wt(t){const e=this.cursor({});return new Ua(((n,s)=>{e.onerror=t=>{const e=Qa(t.target.error);s(e)},e.onsuccess=e=>{const s=e.target.result;s?t(s.primaryKey,s.value).next((t=>{t?s.continue():n()})):n()}}))}Kt(t,e){const n=[];return new Ua(((s,r)=>{t.onerror=t=>{r(t.target.error)},t.onsuccess=t=>{const r=t.target.result;if(!r)return void s();const i=new ja(r),o=e(r.primaryKey,r.value,i);if(o instanceof Ua){const t=o.catch((t=>(i.done(),Ua.reject(t))));n.push(t)}i.isDone?s():null===i.Lt?r.continue():r.continue(i.Lt)}})).next((()=>Ua.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.jt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function za(t){return new Ua(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=Qa(t.target.error);n(e)}}))}let Ha=!1;function Qa(t){const e=Ba.vt((0,a.z$)());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Rs("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Ha||(Ha=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Wa extends Va{constructor(t,e){super(),this.zt=t,this.currentSequenceNumber=e}}function Ya(t,e){const n=ks(t);return Ba.Nt(n.zt,e)}class Xa{constructor(t,e,n,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=s}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const s=this.mutations[e];s.key.isEqual(t.key)&&Gi(s,t,n[e])}}applyToLocalView(t){for(const e of this.baseMutations)e.key.isEqual(t.key)&&zi(e,t,this.localWriteTime);for(const e of this.mutations)e.key.isEqual(t.key)&&zi(e,t,this.localWriteTime)}applyToLocalDocumentSet(t){this.mutations.forEach((e=>{const n=t.get(e.key),s=n;this.applyToLocalView(s),n.isValidDocument()||s.convertToNoDocument(Xs.min())}))}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),Io())}isEqual(t){return this.batchId===t.batchId&&Qs(this.mutations,t.mutations,((t,e)=>Qi(t,e)))&&Qs(this.baseMutations,t.baseMutations,((t,e)=>Qi(t,e)))}}class Ja{constructor(t,e,n,s){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=s}static from(t,e,n){Ds(t.mutations.length===n.length);let s=vo;const r=t.mutations;for(let t=0;t<r.length;t++)s=s.insert(r[t].key,n[t].version);return new Ja(t,e,n,s)}}class Za{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class tc{constructor(t,e,n,s,r=Xs.min(),i=Xs.min(),o=ar.EMPTY_BYTE_STRING){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o}withSequenceNumber(t){return new tc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(t,e){return new tc(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)}withLastLimboFreeSnapshotVersion(t){return new tc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}class ec{constructor(t){this.Ht=t}}function nc(t,e){let n;if(e.document)n=Wo(t.Ht,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const t=br.fromSegments(e.noDocument.path),s=ac(e.noDocument.readTime);n=Vr.newNoDocument(t,s),e.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!e.unknownDocument)return Cs();{const t=br.fromSegments(e.unknownDocument.path),s=ac(e.unknownDocument.version);n=Vr.newUnknownDocument(t,s)}}return e.readTime&&n.setReadTime(ic(e.readTime)),n}function sc(t,e){const n=rc(e.readTime),s=e.key.path.popLast().toArray();if(e.isFoundDocument()){const r=function(t,e){return{name:jo(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Po(t,e.version.toTimestamp())}}(t.Ht,e),i=e.hasCommittedMutations;return new Ia(null,null,r,i,n,s)}if(e.isNoDocument()){const t=e.key.path.toArray(),r=oc(e.version),i=e.hasCommittedMutations;return new Ia(null,new va(t,r),null,i,n,s)}if(e.isUnknownDocument()){const t=e.key.path.toArray(),r=oc(e.version);return new Ia(new ba(t,r),null,null,!0,n,s)}return Cs()}function rc(t){const e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ic(t){const e=new Ys(t[0],t[1]);return Xs.fromTimestamp(e)}function oc(t){const e=t.toTimestamp();return new ma(e.seconds,e.nanoseconds)}function ac(t){const e=new Ys(t.seconds,t.nanoseconds);return Xs.fromTimestamp(e)}function cc(t,e){const n=(e.baseMutations||[]).map((e=>Xo(t.Ht,e)));for(let t=0;t<e.mutations.length-1;++t){const n=e.mutations[t];if(t+1<e.mutations.length&&void 0!==e.mutations[t+1].transform){const s=e.mutations[t+1];n.updateTransforms=s.transform.fieldTransforms,e.mutations.splice(t+1,1),++t}}const s=e.mutations.map((e=>Xo(t.Ht,e))),r=Ys.fromMillis(e.localWriteTimeMs);return new Xa(e.batchId,r,n,s)}function uc(t){const e=ac(t.readTime),n=void 0!==t.lastLimboFreeSnapshotVersion?ac(t.lastLimboFreeSnapshotVersion):Xs.min();let s;var r;return void 0!==t.query.documents?(Ds(1===(r=t.query).documents.length),s=yi(hi(Go(r.documents[0])))):s=function(t){return yi(ta(t))}(t.query),new tc(s,t.targetId,0,t.lastListenSequenceNumber,e,n,ar.fromBase64String(t.resumeToken))}function hc(t,e){const n=oc(e.snapshotVersion),s=oc(e.lastLimboFreeSnapshotVersion);let r;r=Hr(e.target)?Jo(t.Ht,e.target):Zo(t.Ht,e.target);const i=e.resumeToken.toBase64();return new Ea(e.targetId,Gr(e.target),n,i,e.sequenceNumber,s,r)}function lc(t){const e=ta({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?wi(e,e.limit,"L"):e}function dc(t,e){return new Za(e.largestBatchId,Xo(t.Ht,e.overlayMutation))}function fc(t,e){const n=e.path.lastSegment();return[t,ha(e.path.popLast()),n]}class mc{getBundleMetadata(t,e){return gc(t).get(e).next((t=>{if(t)return{id:(e=t).bundleId,createTime:ac(e.createTime),version:e.version};var e}))}saveBundleMetadata(t,e){return gc(t).put({bundleId:(n=e).id,createTime:oc(Uo(n.createTime)),version:n.version});var n}getNamedQuery(t,e){return pc(t).get(e).next((t=>{if(t)return{name:(e=t).name,query:lc(e.bundledQuery),readTime:ac(e.readTime)};var e}))}saveNamedQuery(t,e){return pc(t).put(function(t){return{name:t.name,readTime:oc(Uo(t.readTime)),bundledQuery:t.bundledQuery}}(e))}}function gc(t){return Ya(t,Ca.store)}function pc(t){return Ya(t,Da.store)}class yc{constructor(t,e){this.O=t,this.userId=e}static Jt(t,e){const n=e.uid||"";return new yc(t,n)}getOverlay(t,e){return wc(t).get(fc(this.userId,e)).next((t=>t?dc(this.O,t):null))}saveOverlays(t,e,n){const s=[];return n.forEach((n=>{const r=new Za(e,n);s.push(this.Yt(t,r))})),Ua.waitFor(s)}removeOverlaysForBatchId(t,e,n){const s=new Set;e.forEach((t=>s.add(ha(t.getCollectionPath()))));const r=[];return s.forEach((e=>{const s=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,n+1],!1,!0);r.push(wc(t).Gt(Ra.collectionPathOverlayIndex,s))})),Ua.waitFor(r)}getOverlaysForCollection(t,e,n){const s=new Map,r=ha(e),i=IDBKeyRange.bound([this.userId,r,n],[this.userId,r,Number.POSITIVE_INFINITY],!0);return wc(t).qt(Ra.collectionPathOverlayIndex,i).next((t=>{for(const e of t){const t=dc(this.O,e);s.set(t.getKey(),t)}return s}))}getOverlaysForCollectionGroup(t,e,n,s){const r=new Map;let i;const o=IDBKeyRange.bound([this.userId,e,n],[this.userId,e,Number.POSITIVE_INFINITY],!0);return wc(t).Qt({index:Ra.collectionGroupOverlayIndex,range:o},((t,e,n)=>{const o=dc(this.O,e);r.size<s||o.largestBatchId===i?(r.set(o.getKey(),o),i=o.largestBatchId):n.done()})).next((()=>r))}Yt(t,e){return wc(t).put(function(t,e,n){const[s,r,i]=fc(e,n.mutation.key);return new Ra(e,r,i,n.mutation.key.getCollectionGroup(),n.largestBatchId,Yo(t.Ht,n.mutation))}(this.O,this.userId,e))}}function wc(t){return Ya(t,Ra.store)}class vc{constructor(){}Xt(t,e){this.Zt(t,e),e.te()}Zt(t,e){if("nullValue"in t)this.ee(e,5);else if("booleanValue"in t)this.ee(e,10),e.ne(t.booleanValue?1:0);else if("integerValue"in t)this.ee(e,15),e.ne(hr(t.integerValue));else if("doubleValue"in t){const n=hr(t.doubleValue);isNaN(n)?this.ee(e,13):(this.ee(e,15),wr(n)?e.ne(0):e.ne(n))}else if("timestampValue"in t){const n=t.timestampValue;this.ee(e,20),"string"==typeof n?e.se(n):(e.se(`${n.seconds||""}`),e.ne(n.nanos||0))}else if("stringValue"in t)this.ie(t.stringValue,e),this.re(e);else if("bytesValue"in t)this.ee(e,30),e.oe(lr(t.bytesValue)),this.re(e);else if("referenceValue"in t)this.ce(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.ee(e,45),e.ne(n.latitude||0),e.ne(n.longitude||0)}else"mapValue"in t?Er(t,Ir)?this.ee(e,Number.MAX_SAFE_INTEGER):(this.ue(t.mapValue,e),this.re(e)):"arrayValue"in t?(this.ae(t.arrayValue,e),this.re(e)):Cs()}ie(t,e){this.ee(e,25),this.he(t,e)}he(t,e){e.se(t)}ue(t,e){const n=t.fields||{};this.ee(e,55);for(const t of Object.keys(n))this.ie(t,e),this.Zt(n[t],e)}ae(t,e){const n=t.values||[];this.ee(e,50);for(const t of n)this.Zt(t,e)}ce(t,e){this.ee(e,37),br.fromName(t).path.forEach((t=>{this.ee(e,60),this.he(t,e)}))}ee(t,e){t.ne(e)}re(t){t.ne(2)}}function bc(t){if(0===t)return 8;let e=0;return t>>4==0&&(e+=4,t<<=4),t>>6==0&&(e+=2,t<<=2),t>>7==0&&(e+=1),e}function Ic(t){const e=64-function(t){let e=0;for(let n=0;n<8;++n){const s=bc(255&t[n]);if(e+=s,8!==s)break}return e}(t);return Math.ceil(e/8)}vc.le=new vc;class Tc{constructor(){this.buffer=new Uint8Array(1024),this.position=0}fe(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.de(n.value),n=e.next();this._e()}we(t){const e=t[Symbol.iterator]();let n=e.next();for(;!n.done;)this.me(n.value),n=e.next();this.ge()}ye(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.de(t);else if(t<2048)this.de(960|t>>>6),this.de(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.de(480|t>>>12),this.de(128|63&t>>>6),this.de(128|63&t);else{const t=e.codePointAt(0);this.de(240|t>>>18),this.de(128|63&t>>>12),this.de(128|63&t>>>6),this.de(128|63&t)}}this._e()}pe(t){for(const e of t){const t=e.charCodeAt(0);if(t<128)this.me(t);else if(t<2048)this.me(960|t>>>6),this.me(128|63&t);else if(e<"\ud800"||"\udbff"<e)this.me(480|t>>>12),this.me(128|63&t>>>6),this.me(128|63&t);else{const t=e.codePointAt(0);this.me(240|t>>>18),this.me(128|63&t>>>12),this.me(128|63&t>>>6),this.me(128|63&t)}}this.ge()}Ie(t){const e=this.Ee(t),n=Ic(e);this.Te(1+n),this.buffer[this.position++]=255&n;for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=255&e[t]}Ae(t){const e=this.Ee(t),n=Ic(e);this.Te(1+n),this.buffer[this.position++]=~(255&n);for(let t=e.length-n;t<e.length;++t)this.buffer[this.position++]=~(255&e[t])}Re(){this.Pe(255),this.Pe(255)}be(){this.ve(255),this.ve(255)}reset(){this.position=0}seed(t){this.Te(t.length),this.buffer.set(t,this.position),this.position+=t.length}Ve(){return this.buffer.slice(0,this.position)}Ee(t){const e=function(t){const e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,t,!1),new Uint8Array(e.buffer)}(t),n=0!=(128&e[0]);e[0]^=n?255:128;for(let t=1;t<e.length;++t)e[t]^=n?255:0;return e}de(t){const e=255&t;0===e?(this.Pe(0),this.Pe(255)):255===e?(this.Pe(255),this.Pe(0)):this.Pe(e)}me(t){const e=255&t;0===e?(this.ve(0),this.ve(255)):255===e?(this.ve(255),this.ve(0)):this.ve(t)}_e(){this.Pe(0),this.Pe(1)}ge(){this.ve(0),this.ve(1)}Pe(t){this.Te(1),this.buffer[this.position++]=t}ve(t){this.Te(1),this.buffer[this.position++]=~t}Te(t){const e=t+this.position;if(e<=this.buffer.length)return;let n=2*this.buffer.length;n<e&&(n=e);const s=new Uint8Array(n);s.set(this.buffer),this.buffer=s}}class Ec{constructor(t){this.Se=t}oe(t){this.Se.fe(t)}se(t){this.Se.ye(t)}ne(t){this.Se.Ie(t)}te(){this.Se.Re()}}class Sc{constructor(t){this.Se=t}oe(t){this.Se.we(t)}se(t){this.Se.pe(t)}ne(t){this.Se.Ae(t)}te(){this.Se.be()}}class Ac{constructor(){this.Se=new Tc,this.De=new Ec(this.Se),this.Ce=new Sc(this.Se)}seed(t){this.Se.seed(t)}Ne(t){return 0===t?this.De:this.Ce}Ve(){return this.Se.Ve()}reset(){this.Se.reset()}}class _c{constructor(t,e,n,s){this.indexId=t,this.documentKey=e,this.arrayValue=n,this.directionalValue=s}}function Nc(t,e){let n=t.indexId-e.indexId;return 0!==n?n:(n=br.comparator(t.documentKey,e.documentKey),0!==n?n:(n=Cc(t.arrayValue,e.arrayValue),0!==n?n:Cc(t.directionalValue,e.directionalValue)))}function Cc(t,e){for(let n=0;n<t.length&&n<e.length;++n){const s=t[n]-e[n];if(0!==s)return s}return t.length-e.length}class Dc{constructor(){this.xe=new xc}addToCollectionParentIndex(t,e){return this.xe.add(e),Ua.resolve()}getCollectionParents(t,e){return Ua.resolve(this.xe.getEntries(e))}addFieldIndex(t,e){return Ua.resolve()}deleteFieldIndex(t,e){return Ua.resolve()}getDocumentsMatchingTarget(t,e,n){return Ua.resolve(Io())}getFieldIndex(t,e){return Ua.resolve(null)}getFieldIndexes(t,e){return Ua.resolve([])}getNextCollectionGroupToUpdate(t){return Ua.resolve(null)}updateCollectionGroup(t,e,n){return Ua.resolve()}updateIndexEntries(t,e){return Ua.resolve()}}class xc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e]||new lo(nr.comparator),r=!s.has(n);return this.index[e]=s.add(n),r}has(t){const e=t.lastSegment(),n=t.popLast(),s=this.index[e];return s&&s.has(n)}getEntries(t){return(this.index[t]||new lo(nr.comparator)).toArray()}}class kc{constructor(t){this.user=t,this.ke=new xc,this.uid=t.uid||""}addToCollectionParentIndex(t,e){if(!this.ke.has(e)){const n=e.lastSegment(),s=e.popLast();t.addOnCommittedListener((()=>{this.ke.add(e)}));const r={collectionId:n,parent:ha(s)};return Oc(t).put(r)}return Ua.resolve()}getCollectionParents(t,e){const n=[],s=IDBKeyRange.bound([e,""],[Ws(e),""],!1,!0);return Oc(t).qt(s).next((t=>{for(const s of t){if(s.collectionId!==e)break;n.push(fa(s.parent))}return n}))}addFieldIndex(t,e){const n=Lc(t),s=function(t){return new xa(t.indexId,t.collectionGroup,t.fields.map((t=>[t.fieldPath.canonicalString(),t.kind])))}(e);return delete s.indexId,n.add(s).next()}deleteFieldIndex(t,e){const n=Lc(t),s=Mc(t),r=Rc(t);return n.delete(e.indexId).next((()=>s.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0)))).next((()=>r.delete(IDBKeyRange.bound([e.indexId],[e.indexId+1],!1,!0))))}getDocumentsMatchingTarget(t,e,n){return Ua.resolve(Io())}getFieldIndex(t,e){return Ua.resolve(null)}Oe(t,e){const n=new Ac;for(const s of function(t){return t.fields.filter((t=>2!==t.kind))}(t)){const t=e.data.field(s.fieldPath);if(null==t)return null;const r=n.Ne(s.kind);vc.le.Xt(t,r)}return n.Ve()}Me(t){const e=new Ac;return vc.le.Xt(t,e.Ne(0)),e.Ve()}getFieldIndexes(t,e){const n=Lc(t),s=Mc(t);return(e?n.qt(xa.collectionGroupIndex,IDBKeyRange.bound(e,e)):n.qt()).next((t=>{const e=[];return Ua.forEach(t,(t=>s.get([t.indexId,this.uid]).next((n=>{e.push(function(t,e){const n=e?new Br(e.sequenceNumber,new jr(ac(e.readTime),new br(fa(e.documentKey)),e.largestBatchId)):Br.empty(),s=t.fields.map((([t,e])=>new qr(rr.fromServerFormat(t),e)));return new Ur(t.indexId,t.collectionGroup,s,n)}(t,n))})))).next((()=>e))}))}getNextCollectionGroupToUpdate(t){return this.getFieldIndexes(t).next((t=>0===t.length?null:(t.sort(((t,e)=>t.indexState.sequenceNumber-e.indexState.sequenceNumber)),t[0].collectionGroup)))}updateCollectionGroup(t,e,n){const s=Lc(t),r=Mc(t);return this.$e(t).next((t=>s.qt(xa.collectionGroupIndex,IDBKeyRange.bound(e,e)).next((e=>Ua.forEach(e,(e=>r.put(function(t,e,n,s){return new ka(t,e.uid||"",n,oc(s.readTime),ha(s.documentKey.path),s.largestBatchId)}(e.indexId,this.user,t,n))))))))}updateIndexEntries(t,e){const n=new Map;return Ua.forEach(e,((e,s)=>{const r=n.get(e.collectionGroup);return(r?Ua.resolve(r):this.getFieldIndexes(t,e.collectionGroup)).next((r=>(n.set(e.collectionGroup,r),Ua.forEach(r,(n=>this.Fe(t,e,n).next((e=>{const r=this.Be(s,n);return e.isEqual(r)?Ua.resolve():this.Le(t,s,e,r)})))))))}))}Ue(t,e,n){return Rc(t).put(new Oa(n.indexId,this.uid,n.arrayValue,n.directionalValue,ha(e.key.path)))}qe(t,e,n){return Rc(t).delete([n.indexId,this.uid,n.arrayValue,n.directionalValue,ha(e.key.path)])}Fe(t,e,n){const s=Rc(t);let r=new lo(Nc);return s.Qt({index:Oa.documentKeyIndex,range:IDBKeyRange.only([n.indexId,this.uid,ha(e.path)])},((t,s)=>{r=r.add(new _c(n.indexId,e,s.arrayValue,s.directionalValue))})).next((()=>r))}Be(t,e){let n=new lo(Nc);const s=this.Oe(e,t);if(null==s)return n;const r=function(t){return t.fields.find((t=>2===t.kind))}(e);if(null!=r){const i=t.data.field(r.fieldPath);if(kr(i))for(const r of i.arrayValue.values||[])n=n.add(new _c(e.indexId,t.key,this.Me(r),s))}else n=n.add(new _c(e.indexId,t.key,new Uint8Array,s));return n}Le(t,e,n,s){Ss("IndexedDbIndexManager","Updating index entries for document '%s'",e.key);const r=[];return function(t,e,n,s,r){const i=t.getIterator(),o=e.getIterator();let a=mo(i),c=mo(o);for(;a||c;){let t=!1,e=!1;if(a&&c){const s=n(a,c);s<0?e=!0:s>0&&(t=!0)}else null!=a?e=!0:t=!0;t?(s(c),c=mo(o)):e?(r(a),a=mo(i)):(a=mo(i),c=mo(o))}}(n,s,Nc,(n=>{r.push(this.Ue(t,e,n))}),(n=>{r.push(this.qe(t,e,n))})),Ua.waitFor(r)}$e(t){let e=1;return Mc(t).Qt({index:ka.sequenceNumberIndex,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},((t,n,s)=>{s.done(),e=n.sequenceNumber+1})).next((()=>e))}}function Oc(t){return Ya(t,_a.store)}function Rc(t){return Ya(t,Oa.store)}function Lc(t){return Ya(t,xa.store)}function Mc(t){return Ya(t,ka.store)}const Pc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Fc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Fc(t,Fc.DEFAULT_COLLECTION_PERCENTILE,Fc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function Vc(t,e,n){const s=t.store(ya.store),r=t.store(wa.store),i=[],o=IDBKeyRange.only(n.batchId);let a=0;const c=s.Qt({range:o},((t,e,n)=>(a++,n.delete())));i.push(c.next((()=>{Ds(1===a)})));const u=[];for(const t of n.mutations){const s=wa.key(e,t.key.path,n.batchId);i.push(r.delete(s)),u.push(t.key)}return Ua.waitFor(i).next((()=>u))}function Uc(t){if(!t)return 0;let e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Cs();e=t.noDocument}return JSON.stringify(e).length}Fc.DEFAULT_COLLECTION_PERCENTILE=10,Fc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Fc.DEFAULT=new Fc(41943040,Fc.DEFAULT_COLLECTION_PERCENTILE,Fc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Fc.DISABLED=new Fc(-1,0,0);class qc{constructor(t,e,n,s){this.userId=t,this.O=e,this.indexManager=n,this.referenceDelegate=s,this.Ke={}}static Jt(t,e,n,s){Ds(""!==t.uid);const r=t.isAuthenticated()?t.uid:"";return new qc(r,e,n,s)}checkEmpty(t){let e=!0;const n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return jc(t).Qt({index:ya.userMutationsIndex,range:n},((t,n,s)=>{e=!1,s.done()})).next((()=>e))}addMutationBatch(t,e,n,s){const r=Kc(t),i=jc(t);return i.add({}).next((o=>{Ds("number"==typeof o);const a=new Xa(o,e,n,s),c=function(t,e,n){const s=n.baseMutations.map((e=>Yo(t.Ht,e))),r=n.mutations.map((e=>Yo(t.Ht,e)));return new ya(e,n.batchId,n.localWriteTime.toMillis(),s,r)}(this.O,this.userId,a),u=[];let h=new lo(((t,e)=>Hs(t.canonicalString(),e.canonicalString())));for(const t of s){const e=wa.key(this.userId,t.key.path,o);h=h.add(t.key.path.popLast()),u.push(i.put(c)),u.push(r.put(e,wa.PLACEHOLDER))}return h.forEach((e=>{u.push(this.indexManager.addToCollectionParentIndex(t,e))})),t.addOnCommittedListener((()=>{this.Ke[o]=a.keys()})),Ua.waitFor(u).next((()=>a))}))}lookupMutationBatch(t,e){return jc(t).get(e).next((t=>t?(Ds(t.userId===this.userId),cc(this.O,t)):null))}Ge(t,e){return this.Ke[e]?Ua.resolve(this.Ke[e]):this.lookupMutationBatch(t,e).next((t=>{if(t){const n=t.keys();return this.Ke[e]=n,n}return null}))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=IDBKeyRange.lowerBound([this.userId,n]);let r=null;return jc(t).Qt({index:ya.userMutationsIndex,range:s},((t,e,s)=>{e.userId===this.userId&&(Ds(e.batchId>=n),r=cc(this.O,e)),s.done()})).next((()=>r))}getHighestUnacknowledgedBatchId(t){const e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let n=-1;return jc(t).Qt({index:ya.userMutationsIndex,range:e,reverse:!0},((t,e,s)=>{n=e.batchId,s.done()})).next((()=>n))}getAllMutationBatches(t){const e=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return jc(t).qt(ya.userMutationsIndex,e).next((t=>t.map((t=>cc(this.O,t)))))}getAllMutationBatchesAffectingDocumentKey(t,e){const n=wa.prefixForPath(this.userId,e.path),s=IDBKeyRange.lowerBound(n),r=[];return Kc(t).Qt({range:s},((n,s,i)=>{const[o,a,c]=n,u=fa(a);if(o===this.userId&&e.path.isEqual(u))return jc(t).get(c).next((t=>{if(!t)throw Cs();Ds(t.userId===this.userId),r.push(cc(this.O,t))}));i.done()})).next((()=>r))}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new lo(Hs);const s=[];return e.forEach((e=>{const r=wa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=Kc(t).Qt({range:i},((t,s,r)=>{const[i,o,a]=t,c=fa(o);i===this.userId&&e.path.isEqual(c)?n=n.add(a):r.done()}));s.push(o)})),Ua.waitFor(s).next((()=>this.je(t,n)))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1,r=wa.prefixForPath(this.userId,n),i=IDBKeyRange.lowerBound(r);let o=new lo(Hs);return Kc(t).Qt({range:i},((t,e,r)=>{const[i,a,c]=t,u=fa(a);i===this.userId&&n.isPrefixOf(u)?u.length===s&&(o=o.add(c)):r.done()})).next((()=>this.je(t,o)))}je(t,e){const n=[],s=[];return e.forEach((e=>{s.push(jc(t).get(e).next((t=>{if(null===t)throw Cs();Ds(t.userId===this.userId),n.push(cc(this.O,t))})))})),Ua.waitFor(s).next((()=>n))}removeMutationBatch(t,e){return Vc(t.zt,this.userId,e).next((n=>(t.addOnCommittedListener((()=>{this.Qe(e.batchId)})),Ua.forEach(n,(e=>this.referenceDelegate.markPotentiallyOrphaned(t,e))))))}Qe(t){delete this.Ke[t]}performConsistencyCheck(t){return this.checkEmpty(t).next((e=>{if(!e)return Ua.resolve();const n=IDBKeyRange.lowerBound(wa.prefixForUser(this.userId)),s=[];return Kc(t).Qt({range:n},((t,e,n)=>{if(t[0]===this.userId){const e=fa(t[1]);s.push(e)}else n.done()})).next((()=>{Ds(0===s.length)}))}))}containsKey(t,e){return Bc(t,this.userId,e)}We(t){return $c(t).get(this.userId).next((t=>t||new pa(this.userId,-1,"")))}}function Bc(t,e,n){const s=wa.prefixForPath(e,n.path),r=s[1],i=IDBKeyRange.lowerBound(s);let o=!1;return Kc(t).Qt({range:i,jt:!0},((t,n,s)=>{const[i,a,c]=t;i===e&&a===r&&(o=!0),s.done()})).next((()=>o))}function jc(t){return Ya(t,ya.store)}function Kc(t){return Ya(t,wa.store)}function $c(t){return Ya(t,pa.store)}class Gc{constructor(t){this.ze=t}next(){return this.ze+=2,this.ze}static He(){return new Gc(0)}static Je(){return new Gc(-1)}}class zc{constructor(t,e){this.referenceDelegate=t,this.O=e}allocateTargetId(t){return this.Ye(t).next((e=>{const n=new Gc(e.highestTargetId);return e.highestTargetId=n.next(),this.Xe(t,e).next((()=>e.highestTargetId))}))}getLastRemoteSnapshotVersion(t){return this.Ye(t).next((t=>Xs.fromTimestamp(new Ys(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))))}getHighestSequenceNumber(t){return this.Ye(t).next((t=>t.highestListenSequenceNumber))}setTargetsMetadata(t,e,n){return this.Ye(t).next((s=>(s.highestListenSequenceNumber=e,n&&(s.lastRemoteSnapshotVersion=n.toTimestamp()),e>s.highestListenSequenceNumber&&(s.highestListenSequenceNumber=e),this.Xe(t,s))))}addTargetData(t,e){return this.Ze(t,e).next((()=>this.Ye(t).next((n=>(n.targetCount+=1,this.tn(e,n),this.Xe(t,n))))))}updateTargetData(t,e){return this.Ze(t,e)}removeTargetData(t,e){return this.removeMatchingKeysForTargetId(t,e.targetId).next((()=>Hc(t).delete(e.targetId))).next((()=>this.Ye(t))).next((e=>(Ds(e.targetCount>0),e.targetCount-=1,this.Xe(t,e))))}removeTargets(t,e,n){let s=0;const r=[];return Hc(t).Qt(((i,o)=>{const a=uc(o);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(s++,r.push(this.removeTargetData(t,a)))})).next((()=>Ua.waitFor(r))).next((()=>s))}forEachTarget(t,e){return Hc(t).Qt(((t,n)=>{const s=uc(n);e(s)}))}Ye(t){return Qc(t).get(Aa.key).next((t=>(Ds(null!==t),t)))}Xe(t,e){return Qc(t).put(Aa.key,e)}Ze(t,e){return Hc(t).put(hc(this.O,e))}tn(t,e){let n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n}getTargetCount(t){return this.Ye(t).next((t=>t.targetCount))}getTargetData(t,e){const n=Gr(e),s=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]);let r=null;return Hc(t).Qt({range:s,index:Ea.queryTargetsIndexName},((t,n,s)=>{const i=uc(n);zr(e,i.target)&&(r=i,s.done())})).next((()=>r))}addMatchingKeys(t,e,n){const s=[],r=Wc(t);return e.forEach((e=>{const i=ha(e.path);s.push(r.put(new Sa(n,i))),s.push(this.referenceDelegate.addReference(t,n,e))})),Ua.waitFor(s)}removeMatchingKeys(t,e,n){const s=Wc(t);return Ua.forEach(e,(e=>{const r=ha(e.path);return Ua.waitFor([s.delete([n,r]),this.referenceDelegate.removeReference(t,n,e)])}))}removeMatchingKeysForTargetId(t,e){const n=Wc(t),s=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(s)}getMatchingKeysForTargetId(t,e){const n=IDBKeyRange.bound([e],[e+1],!1,!0),s=Wc(t);let r=Io();return s.Qt({range:n,jt:!0},((t,e,n)=>{const s=fa(t[1]),i=new br(s);r=r.add(i)})).next((()=>r))}containsKey(t,e){const n=ha(e.path),s=IDBKeyRange.bound([n],[Ws(n)],!1,!0);let r=0;return Wc(t).Qt({index:Sa.documentTargetsIndex,jt:!0,range:s},(([t,e],n,s)=>{0!==t&&(r++,s.done())})).next((()=>r>0))}Tt(t,e){return Hc(t).get(e).next((t=>t?uc(t):null))}}function Hc(t){return Ya(t,Ea.store)}function Qc(t){return Ya(t,Aa.store)}function Wc(t){return Ya(t,Sa.store)}async function Yc(t){if(t.code!==Os.FAILED_PRECONDITION||t.message!==Fa)throw t;Ss("LocalStore","Unexpectedly lost primary lease")}function Xc([t,e],[n,s]){const r=Hs(t,n);return 0===r?Hs(e,s):r}class Jc{constructor(t){this.en=t,this.buffer=new lo(Xc),this.nn=0}sn(){return++this.nn}rn(t){const e=[t,this.sn()];if(this.buffer.size<this.en)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Xc(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Zc{constructor(t,e){this.garbageCollector=t,this.asyncQueue=e,this.on=!1,this.cn=null}start(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.un(t)}stop(){this.cn&&(this.cn.cancel(),this.cn=null)}get started(){return null!==this.cn}un(t){const e=this.on?3e5:6e4;Ss("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.cn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.cn=null,this.on=!0;try{await t.collectGarbage(this.garbageCollector)}catch(t){$a(t)?Ss("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",t):await Yc(t)}await this.un(t)}))}}class tu{constructor(t,e){this.an=t,this.params=e}calculateTargetCount(t,e){return this.an.hn(t).next((t=>Math.floor(e/100*t)))}nthSequenceNumber(t,e){if(0===e)return Ua.resolve($s.A);const n=new Jc(e);return this.an.forEachTarget(t,(t=>n.rn(t.sequenceNumber))).next((()=>this.an.ln(t,(t=>n.rn(t))))).next((()=>n.maxValue))}removeTargets(t,e,n){return this.an.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.an.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(Ss("LruGarbageCollector","Garbage collection skipped; disabled"),Ua.resolve(Pc)):this.getCacheSize(t).next((n=>n<this.params.cacheSizeCollectionThreshold?(Ss("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Pc):this.fn(t,e)))}getCacheSize(t){return this.an.getCacheSize(t)}fn(t,e){let n,s,r,i,a,c,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((e=>(e>this.params.maximumSequenceNumbersToCollect?(Ss("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),s=this.params.maximumSequenceNumbersToCollect):s=e,i=Date.now(),this.nthSequenceNumber(t,s)))).next((s=>(n=s,a=Date.now(),this.removeTargets(t,n,e)))).next((e=>(r=e,c=Date.now(),this.removeOrphanedDocuments(t,n)))).next((t=>(u=Date.now(),Ts()<=o.in.DEBUG&&Ss("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${i-h}ms\n\tDetermined least recently used ${s} in `+(a-i)+"ms\n"+`\tRemoved ${r} targets in `+(c-a)+"ms\n"+`\tRemoved ${t} documents in `+(u-c)+"ms\n"+`Total Duration: ${u-h}ms`),Ua.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:t}))))}}class eu{constructor(t,e){this.db=t,this.garbageCollector=function(t,e){return new tu(t,e)}(this,e)}hn(t){const e=this.dn(t);return this.db.getTargetCache().getTargetCount(t).next((t=>e.next((e=>t+e))))}dn(t){let e=0;return this.ln(t,(t=>{e++})).next((()=>e))}forEachTarget(t,e){return this.db.getTargetCache().forEachTarget(t,e)}ln(t,e){return this._n(t,((t,n)=>e(n)))}addReference(t,e,n){return nu(t,n)}removeReference(t,e,n){return nu(t,n)}removeTargets(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)}markPotentiallyOrphaned(t,e){return nu(t,e)}wn(t,e){return function(t,e){let n=!1;return $c(t).Wt((s=>Bc(t,s,e).next((t=>(t&&(n=!0),Ua.resolve(!t)))))).next((()=>n))}(t,e)}removeOrphanedDocuments(t,e){const n=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[];let r=0;return this._n(t,((i,o)=>{if(o<=e){const e=this.wn(t,i).next((e=>{if(!e)return r++,n.getEntry(t,i).next((()=>(n.removeEntry(i,Xs.min()),Wc(t).delete([0,ha(i.path)]))))}));s.push(e)}})).next((()=>Ua.waitFor(s))).next((()=>n.apply(t))).next((()=>r))}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)}updateLimboDocument(t,e){return nu(t,e)}_n(t,e){const n=Wc(t);let s,r=$s.A;return n.Qt({index:Sa.documentTargetsIndex},(([t,n],{path:i,sequenceNumber:o})=>{0===t?(r!==$s.A&&e(new br(fa(s)),r),r=o,s=i):r=$s.A})).next((()=>{r!==$s.A&&e(new br(fa(s)),r)}))}getCacheSize(t){return this.db.getRemoteDocumentCache().getSize(t)}}function nu(t,e){return Wc(t).put(function(t,e){return new Sa(0,ha(t.path),e)}(e,t.currentSequenceNumber))}class su{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,s]of n)if(this.equalsFn(e,t))return s}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),s=this.inner[n];if(void 0!==s){for(let n=0;n<s.length;n++)if(this.equalsFn(s[n][0],t))return void(s[n]=[t,e]);s.push([t,e])}else this.inner[n]=[[t,e]]}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let s=0;s<n.length;s++)if(this.equalsFn(n[s][0],t))return 1===n.length?delete this.inner[e]:n.splice(s,1),!0;return!1}forEach(t){Zs(this.inner,((e,n)=>{for(const[e,s]of n)t(e,s)}))}isEmpty(){return tr(this.inner)}}class ru{constructor(){this.changes=new su((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Vr.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Ua.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class iu{constructor(t){this.O=t}setIndexManager(t){this.indexManager=t}addEntry(t,e,n){return cu(t).put(uu(e),n)}removeEntry(t,e){const n=cu(t),s=uu(e);return n.delete(s)}updateMetadata(t,e){return this.getMetadata(t).next((n=>(n.byteSize+=e,this.mn(t,n))))}getEntry(t,e){return cu(t).get(uu(e)).next((t=>this.gn(e,t)))}yn(t,e){return cu(t).get(uu(e)).next((t=>({document:this.gn(e,t),size:Uc(t)})))}getEntries(t,e){let n=po();return this.pn(t,e,((t,e)=>{const s=this.gn(t,e);n=n.insert(t,s)})).next((()=>n))}In(t,e){let n=po(),s=new co(br.comparator);return this.pn(t,e,((t,e)=>{const r=this.gn(t,e);n=n.insert(t,r),s=s.insert(t,Uc(e))})).next((()=>({documents:n,En:s})))}pn(t,e,n){if(e.isEmpty())return Ua.resolve();const s=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),r=e.getIterator();let i=r.getNext();return cu(t).Qt({range:s},((t,e,s)=>{const o=br.fromSegments(t);for(;i&&br.comparator(i,o)<0;)n(i,null),i=r.getNext();i&&i.isEqual(o)&&(n(i,e),i=r.hasNext()?r.getNext():null),i?s.Ut(i.path.toArray()):s.done()})).next((()=>{for(;i;)n(i,null),i=r.hasNext()?r.getNext():null}))}getAll(t,e,n){let s=po();const r=e.length+1,i={};if(n.isEqual(Xs.min())){const t=e.toArray();i.range=IDBKeyRange.lowerBound(t)}else{const t=e.toArray(),s=rc(n);i.range=IDBKeyRange.lowerBound([t,s],!0),i.index=Ia.collectionReadTimeIndex}return cu(t).Qt(i,((t,n,i)=>{if(t.length!==r)return;const o=this.gn(br.fromSegments(t),n);e.isPrefixOf(o.key.path)?s=s.insert(o.key,o):i.done()})).next((()=>s))}newChangeBuffer(t){return new ou(this,!!t&&t.trackRemovals)}getSize(t){return this.getMetadata(t).next((t=>t.byteSize))}getMetadata(t){return au(t).get(Ta.key).next((t=>(Ds(!!t),t)))}mn(t,e){return au(t).put(Ta.key,e)}gn(t,e){if(e){const t=nc(this.O,e);if(!t.isNoDocument()||!t.version.isEqual(Xs.min()))return t}return Vr.newInvalidDocument(t)}}class ou extends ru{constructor(t,e){super(),this.Tn=t,this.trackRemovals=e,this.An=new su((t=>t.toString()),((t,e)=>t.isEqual(e)))}applyChanges(t){const e=[];let n=0,s=new lo(((t,e)=>Hs(t.canonicalString(),e.canonicalString())));return this.changes.forEach(((r,i)=>{const o=this.An.get(r);if(i.isValidDocument()){const a=sc(this.Tn.O,i);s=s.add(r.path.popLast());const c=Uc(a);n+=c-o,e.push(this.Tn.addEntry(t,r,a))}else if(n-=o,this.trackRemovals){const n=sc(this.Tn.O,i.convertToNoDocument(Xs.min()));e.push(this.Tn.addEntry(t,r,n))}else e.push(this.Tn.removeEntry(t,r))})),s.forEach((n=>{e.push(this.Tn.indexManager.addToCollectionParentIndex(t,n))})),e.push(this.Tn.updateMetadata(t,n)),Ua.waitFor(e)}getFromCache(t,e){return this.Tn.yn(t,e).next((t=>(this.An.set(e,t.size),t.document)))}getAllFromCache(t,e){return this.Tn.In(t,e).next((({documents:t,En:e})=>(e.forEach(((t,e)=>{this.An.set(t,e)})),t)))}}function au(t){return Ya(t,Ta.store)}function cu(t){return Ya(t,Ia.store)}function uu(t){return t.path.toArray()}class hu{constructor(t){this.O=t}kt(t,e,n,s){const r=new qa("createOrUpgrade",e);n<1&&s>=1&&(function(t){t.createObjectStore(ga.store)}(t),function(t){t.createObjectStore(pa.store,{keyPath:pa.keyPath}),t.createObjectStore(ya.store,{keyPath:ya.keyPath,autoIncrement:!0}).createIndex(ya.userMutationsIndex,ya.userMutationsKeyPath,{unique:!0}),t.createObjectStore(wa.store)}(t),lu(t),function(t){t.createObjectStore(Ia.store)}(t));let i=Ua.resolve();return n<3&&s>=3&&(0!==n&&(function(t){t.deleteObjectStore(Sa.store),t.deleteObjectStore(Ea.store),t.deleteObjectStore(Aa.store)}(t),lu(t)),i=i.next((()=>function(t){const e=t.store(Aa.store),n=new Aa(0,0,Xs.min().toTimestamp(),0);return e.put(Aa.key,n)}(r)))),n<4&&s>=4&&(0!==n&&(i=i.next((()=>function(t,e){return e.store(ya.store).qt().next((n=>{t.deleteObjectStore(ya.store),t.createObjectStore(ya.store,{keyPath:ya.keyPath,autoIncrement:!0}).createIndex(ya.userMutationsIndex,ya.userMutationsKeyPath,{unique:!0});const s=e.store(ya.store),r=n.map((t=>s.put(t)));return Ua.waitFor(r)}))}(t,r)))),i=i.next((()=>{!function(t){t.createObjectStore(Na.store,{keyPath:Na.keyPath})}(t)}))),n<5&&s>=5&&(i=i.next((()=>this.Rn(r)))),n<6&&s>=6&&(i=i.next((()=>(function(t){t.createObjectStore(Ta.store)}(t),this.Pn(r))))),n<7&&s>=7&&(i=i.next((()=>this.bn(r)))),n<8&&s>=8&&(i=i.next((()=>this.vn(t,r)))),n<9&&s>=9&&(i=i.next((()=>{!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){const e=t.objectStore(Ia.store);e.createIndex(Ia.readTimeIndex,Ia.readTimeIndexPath,{unique:!1}),e.createIndex(Ia.collectionReadTimeIndex,Ia.collectionReadTimeIndexPath,{unique:!1})}(e)}))),n<10&&s>=10&&(i=i.next((()=>this.Vn(r)))),n<11&&s>=11&&(i=i.next((()=>{!function(t){t.createObjectStore(Ca.store,{keyPath:Ca.keyPath})}(t),function(t){t.createObjectStore(Da.store,{keyPath:Da.keyPath})}(t)}))),n<12&&s>=12&&(i=i.next((()=>{!function(t){const e=t.createObjectStore(Ra.store,{keyPath:Ra.keyPath});e.createIndex(Ra.collectionPathOverlayIndex,Ra.collectionPathOverlayIndexPath,{unique:!1}),e.createIndex(Ra.collectionGroupOverlayIndex,Ra.collectionGroupOverlayIndexPath,{unique:!1})}(t)}))),n<13&&s>=13&&(i=i.next((()=>{!function(t){t.createObjectStore(xa.store,{keyPath:xa.keyPath,autoIncrement:!0}).createIndex(xa.collectionGroupIndex,xa.collectionGroupIndexPath,{unique:!1}),t.createObjectStore(ka.store,{keyPath:ka.keyPath}).createIndex(ka.sequenceNumberIndex,ka.sequenceNumberIndexPath,{unique:!1}),t.createObjectStore(Oa.store,{keyPath:Oa.keyPath}).createIndex(Oa.documentKeyIndex,Oa.documentKeyIndexPath,{unique:!1})}(t)}))),i}Pn(t){let e=0;return t.store(Ia.store).Qt(((t,n)=>{e+=Uc(n)})).next((()=>{const n=new Ta(e);return t.store(Ta.store).put(Ta.key,n)}))}Rn(t){const e=t.store(pa.store),n=t.store(ya.store);return e.qt().next((e=>Ua.forEach(e,(e=>{const s=IDBKeyRange.bound([e.userId,-1],[e.userId,e.lastAcknowledgedBatchId]);return n.qt(ya.userMutationsIndex,s).next((n=>Ua.forEach(n,(n=>{Ds(n.userId===e.userId);const s=cc(this.O,n);return Vc(t,e.userId,s).next((()=>{}))}))))}))))}bn(t){const e=t.store(Sa.store),n=t.store(Ia.store);return t.store(Aa.store).get(Aa.key).next((t=>{const s=[];return n.Qt(((n,r)=>{const i=new nr(n),o=function(t){return[0,ha(t)]}(i);s.push(e.get(o).next((n=>n?Ua.resolve():(n=>e.put(new Sa(0,ha(n),t.highestListenSequenceNumber)))(i))))})).next((()=>Ua.waitFor(s)))}))}vn(t,e){t.createObjectStore(_a.store,{keyPath:_a.keyPath});const n=e.store(_a.store),s=new xc,r=t=>{if(s.add(t)){const e=t.lastSegment(),s=t.popLast();return n.put({collectionId:e,parent:ha(s)})}};return e.store(Ia.store).Qt({jt:!0},((t,e)=>{const n=new nr(t);return r(n.popLast())})).next((()=>e.store(wa.store).Qt({jt:!0},(([t,e,n],s)=>{const i=fa(e);return r(i.popLast())}))))}Vn(t){const e=t.store(Ea.store);return e.Qt(((t,n)=>{const s=uc(n),r=hc(this.O,s);return e.put(r)}))}}function lu(t){t.createObjectStore(Sa.store,{keyPath:Sa.keyPath}).createIndex(Sa.documentTargetsIndex,Sa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ea.store,{keyPath:Ea.keyPath}).createIndex(Ea.queryTargetsIndexName,Ea.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Aa.store)}const du="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class fu{constructor(t,e,n,s,r,i,o,a,c,u,h=12){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Sn=r,this.window=i,this.document=o,this.Dn=c,this.Cn=u,this.schemaVersion=h,this.Nn=null,this.xn=!1,this.isPrimary=!1,this.networkEnabled=!0,this.kn=null,this.inForeground=!1,this.On=null,this.Mn=null,this.$n=Number.NEGATIVE_INFINITY,this.Fn=t=>Promise.resolve(),!fu.Vt())throw new Rs(Os.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new eu(this,s),this.Bn=e+"main",this.O=new ec(a),this.Ln=new Ba(this.Bn,this.schemaVersion,new hu(this.O)),this.Un=new zc(this.referenceDelegate,this.O),this.qn=function(t){return new iu(t)}(this.O),this.Kn=new mc,this.window&&this.window.localStorage?this.Gn=this.window.localStorage:(this.Gn=null,!1===u&&As("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.jn().then((()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new Rs(Os.FAILED_PRECONDITION,du);return this.Qn(),this.Wn(),this.zn(),this.runTransaction("getHighestListenSequenceNumber","readonly",(t=>this.Un.getHighestSequenceNumber(t)))})).then((t=>{this.Nn=new $s(t,this.Dn)})).then((()=>{this.xn=!0})).catch((t=>(this.Ln&&this.Ln.close(),Promise.reject(t))))}Hn(t){return this.Fn=async e=>{if(this.started)return t(e)},t(this.isPrimary)}setDatabaseDeletedListener(t){this.Ln.Mt((async e=>{null===e.newVersion&&await t()}))}setNetworkEnabled(t){this.networkEnabled!==t&&(this.networkEnabled=t,this.Sn.enqueueAndForget((async()=>{this.started&&await this.jn()})))}jn(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(t=>gu(t).put(new Na(this.clientId,Date.now(),this.networkEnabled,this.inForeground)).next((()=>{if(this.isPrimary)return this.Jn(t).next((t=>{t||(this.isPrimary=!1,this.Sn.enqueueRetryable((()=>this.Fn(!1))))}))})).next((()=>this.Yn(t))).next((e=>this.isPrimary&&!e?this.Xn(t).next((()=>!1)):!!e&&this.Zn(t).next((()=>!0)))))).catch((t=>{if($a(t))return Ss("IndexedDbPersistence","Failed to extend owner lease: ",t),this.isPrimary;if(!this.allowTabSynchronization)throw t;return Ss("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((t=>{this.isPrimary!==t&&this.Sn.enqueueRetryable((()=>this.Fn(t))),this.isPrimary=t}))}Jn(t){return mu(t).get(ga.key).next((t=>Ua.resolve(this.ts(t))))}es(t){return gu(t).delete(this.clientId)}async ns(){if(this.isPrimary&&!this.ss(this.$n,18e5)){this.$n=Date.now();const t=await this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(t=>{const e=Ya(t,Na.store);return e.qt().next((t=>{const n=this.rs(t,18e5),s=t.filter((t=>-1===n.indexOf(t)));return Ua.forEach(s,(t=>e.delete(t.clientId))).next((()=>s))}))})).catch((()=>[]));if(this.Gn)for(const e of t)this.Gn.removeItem(this.os(e.clientId))}}zn(){this.Mn=this.Sn.enqueueAfterDelay("client_metadata_refresh",4e3,(()=>this.jn().then((()=>this.ns())).then((()=>this.zn()))))}ts(t){return!!t&&t.ownerId===this.clientId}Yn(t){return this.Cn?Ua.resolve(!0):mu(t).get(ga.key).next((e=>{if(null!==e&&this.ss(e.leaseTimestampMs,5e3)&&!this.cs(e.ownerId)){if(this.ts(e)&&this.networkEnabled)return!0;if(!this.ts(e)){if(!e.allowTabSynchronization)throw new Rs(Os.FAILED_PRECONDITION,du);return!1}}return!(!this.networkEnabled||!this.inForeground)||gu(t).qt().next((t=>void 0===this.rs(t,5e3).find((t=>{if(this.clientId!==t.clientId){const e=!this.networkEnabled&&t.networkEnabled,n=!this.inForeground&&t.inForeground,s=this.networkEnabled===t.networkEnabled;if(e||n&&s)return!0}return!1}))))})).next((t=>(this.isPrimary!==t&&Ss("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t)))}async shutdown(){this.xn=!1,this.us(),this.Mn&&(this.Mn.cancel(),this.Mn=null),this.hs(),this.ls(),await this.Ln.runTransaction("shutdown","readwrite",[ga.store,Na.store],(t=>{const e=new Wa(t,$s.A);return this.Xn(e).next((()=>this.es(e)))})),this.Ln.close(),this.fs()}rs(t,e){return t.filter((t=>this.ss(t.updateTimeMs,e)&&!this.cs(t.clientId)))}ds(){return this.runTransaction("getActiveClients","readonly",(t=>gu(t).qt().next((t=>this.rs(t,18e5).map((t=>t.clientId))))))}get started(){return this.xn}getMutationQueue(t,e){return qc.Jt(t,this.O,e,this.referenceDelegate)}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getIndexManager(t){return new kc(t)}getDocumentOverlayCache(t){return yc.Jt(this.O,t)}getBundleCache(){return this.Kn}runTransaction(t,e,n){Ss("IndexedDbPersistence","Starting transaction:",t);const s="readonly"===e?"readonly":"readwrite",r=13===(i=this.schemaVersion)?Pa:12===i?Ma:11===i?La:void Cs();var i;let o;return this.Ln.runTransaction(t,s,r,(s=>(o=new Wa(s,this.Nn?this.Nn.next():$s.A),"readwrite-primary"===e?this.Jn(o).next((t=>!!t||this.Yn(o))).next((e=>{if(!e)throw As(`Failed to obtain primary lease for action '${t}'.`),this.isPrimary=!1,this.Sn.enqueueRetryable((()=>this.Fn(!1))),new Rs(Os.FAILED_PRECONDITION,Fa);return n(o)})).next((t=>this.Zn(o).next((()=>t)))):this._s(o).next((()=>n(o)))))).then((t=>(o.raiseOnCommittedEvent(),t)))}_s(t){return mu(t).get(ga.key).next((t=>{if(null!==t&&this.ss(t.leaseTimestampMs,5e3)&&!this.cs(t.ownerId)&&!this.ts(t)&&!(this.Cn||this.allowTabSynchronization&&t.allowTabSynchronization))throw new Rs(Os.FAILED_PRECONDITION,du)}))}Zn(t){const e=new ga(this.clientId,this.allowTabSynchronization,Date.now());return mu(t).put(ga.key,e)}static Vt(){return Ba.Vt()}Xn(t){const e=mu(t);return e.get(ga.key).next((t=>this.ts(t)?(Ss("IndexedDbPersistence","Releasing primary lease."),e.delete(ga.key)):Ua.resolve()))}ss(t,e){const n=Date.now();return!(t<n-e||t>n&&(As(`Detected an update time that is in the future: ${t} > ${n}`),1))}Qn(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.On=()=>{this.Sn.enqueueAndForget((()=>(this.inForeground="visible"===this.document.visibilityState,this.jn())))},this.document.addEventListener("visibilitychange",this.On),this.inForeground="visible"===this.document.visibilityState)}hs(){this.On&&(this.document.removeEventListener("visibilitychange",this.On),this.On=null)}Wn(){var t;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.kn=()=>{this.us(),(0,a.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Sn.enterRestrictedMode(!0),this.Sn.enqueueAndForget((()=>this.shutdown()))},this.window.addEventListener("pagehide",this.kn))}ls(){this.kn&&(this.window.removeEventListener("pagehide",this.kn),this.kn=null)}cs(t){var e;try{const n=null!==(null===(e=this.Gn)||void 0===e?void 0:e.getItem(this.os(t)));return Ss("IndexedDbPersistence",`Client '${t}' ${n?"is":"is not"} zombied in LocalStorage`),n}catch(t){return As("IndexedDbPersistence","Failed to get zombied client id.",t),!1}}us(){if(this.Gn)try{this.Gn.setItem(this.os(this.clientId),String(Date.now()))}catch(t){As("Failed to set zombie client id.",t)}}fs(){if(this.Gn)try{this.Gn.removeItem(this.os(this.clientId))}catch(t){}}os(t){return`firestore_zombie_${this.persistenceKey}_${t}`}}function mu(t){return Ya(t,ga.store)}function gu(t){return Ya(t,Na.store)}function pu(t,e){let n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}class yu{constructor(t,e){this.progress=t,this.ws=e}}class wu{constructor(t,e,n){this.qn=t,this.gs=e,this.indexManager=n}ys(t,e){return this.gs.getAllMutationBatchesAffectingDocumentKey(t,e).next((n=>this.ps(t,e,n)))}ps(t,e,n){return this.qn.getEntry(t,e).next((t=>{for(const e of n)e.applyToLocalView(t);return t}))}Is(t,e){t.forEach(((t,n)=>{for(const t of e)t.applyToLocalView(n)}))}Es(t,e){return this.qn.getEntries(t,e).next((e=>this.Ts(t,e).next((()=>e))))}Ts(t,e){return this.gs.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>this.Is(e,t)))}As(t,e,n){return function(t){return br.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Rs(t,e.path):gi(e)?this.Ps(t,e,n):this.bs(t,e,n)}Rs(t,e){return this.ys(t,new br(e)).next((t=>{let e=wo();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}Ps(t,e,n){const s=e.collectionGroup;let r=wo();return this.indexManager.getCollectionParents(t,s).next((i=>Ua.forEach(i,(i=>{const o=function(t,e){return new ci(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,i.child(s));return this.bs(t,o,n).next((t=>{t.forEach(((t,e)=>{r=r.insert(t,e)}))}))})).next((()=>r))))}bs(t,e,n){let s;return this.qn.getAll(t,e.path,n).next((n=>(s=n,this.gs.getAllMutationBatchesAffectingQuery(t,e)))).next((t=>{for(const e of t)for(const t of e.mutations){const n=t.key;let r=s.get(n);null==r&&(r=Vr.newInvalidDocument(n),s=s.insert(n,r)),zi(t,r,e.localWriteTime),r.isFoundDocument()||(s=s.remove(n))}})).next((()=>(s.forEach(((t,n)=>{Ti(e,n)||(s=s.remove(t))})),s)))}}class vu{constructor(t,e,n,s){this.targetId=t,this.fromCache=e,this.vs=n,this.Vs=s}static Ss(t,e){let n=Io(),s=Io();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:s=s.add(t.doc.key)}return new vu(t,e.fromCache,n,s)}}class bu{Ds(t){this.Cs=t}As(t,e,n,s){return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Xs.min())?this.Ns(t,e):this.Cs.Es(t,s).next((r=>{const i=this.xs(e,r);return(li(e)||di(e))&&this.ks(e.limitType,i,s,n)?this.Ns(t,e):(Ts()<=o.in.DEBUG&&Ss("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Ii(e)),this.Cs.As(t,e,n).next((t=>(i.forEach((e=>{t=t.insert(e.key,e)})),t))))}))}xs(t,e){let n=new lo(Ei(t));return e.forEach(((e,s)=>{Ti(t,s)&&(n=n.add(s))})),n}ks(t,e,n,s){if(n.size!==e.size)return!0;const r="F"===t?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Ns(t,e){return Ts()<=o.in.DEBUG&&Ss("QueryEngine","Using full collection scan to execute query:",Ii(e)),this.Cs.As(t,e,Xs.min())}}class Iu{constructor(t,e,n,s){this.persistence=t,this.Os=e,this.O=s,this.Ms=new co(Hs),this.$s=new su((t=>Gr(t)),zr),this.Fs=Xs.min(),this.Bs=t.getRemoteDocumentCache(),this.Un=t.getTargetCache(),this.Kn=t.getBundleCache(),this.Ls(n)}Ls(t){this.indexManager=this.persistence.getIndexManager(t),this.gs=this.persistence.getMutationQueue(t,this.indexManager),this.Us=new wu(this.Bs,this.gs,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Os.Ds(this.Us)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Tu(t,e,n,s){return new Iu(t,e,n,s)}async function Eu(t,e){const n=ks(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let s;return n.gs.getAllMutationBatches(t).next((r=>(s=r,n.Ls(e),n.gs.getAllMutationBatches(t)))).next((e=>{const r=[],i=[];let o=Io();for(const t of s){r.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.Us.Es(t,o).next((t=>({qs:t,removedBatchIds:r,addedBatchIds:i})))}))}))}function Su(t){const e=ks(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Un.getLastRemoteSnapshotVersion(t)))}function Au(t,e,n){let s=Io();return n.forEach((t=>s=s.add(t))),e.getEntries(t,s).next((t=>{let s=po();return n.forEach(((n,r)=>{const i=t.get(n);r.isNoDocument()&&r.version.isEqual(Xs.min())?(e.removeEntry(n,r.readTime),s=s.insert(n,r)):!i.isValidDocument()||r.version.compareTo(i.version)>0||0===r.version.compareTo(i.version)&&i.hasPendingWrites?(e.addEntry(r),s=s.insert(n,r)):Ss("LocalStore","Ignoring outdated watch update for ",n,". Current version:",i.version," Watch version:",r.version)})),s}))}function _u(t,e){const n=ks(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.gs.getNextMutationBatchAfterBatchId(t,e))))}function Nu(t,e){const n=ks(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let s;return n.Un.getTargetData(t,e).next((r=>r?(s=r,Ua.resolve(s)):n.Un.allocateTargetId(t).next((r=>(s=new tc(e,r,0,t.currentSequenceNumber),n.Un.addTargetData(t,s).next((()=>s)))))))})).then((t=>{const s=n.Ms.get(t.targetId);return(null===s||t.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(t.targetId,t),n.$s.set(e,t.targetId)),t}))}async function Cu(t,e,n){const s=ks(t),r=s.Ms.get(e),i=n?"readwrite":"readwrite-primary";try{n||await s.persistence.runTransaction("Release target",i,(t=>s.persistence.referenceDelegate.removeTarget(t,r)))}catch(t){if(!$a(t))throw t;Ss("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}s.Ms=s.Ms.remove(e),s.$s.delete(r.target)}function Du(t,e,n){const s=ks(t);let r=Xs.min(),i=Io();return s.persistence.runTransaction("Execute query","readonly",(t=>function(t,e,n){const s=ks(t),r=s.$s.get(n);return void 0!==r?Ua.resolve(s.Ms.get(r)):s.Un.getTargetData(e,n)}(s,t,yi(e)).next((e=>{if(e)return r=e.lastLimboFreeSnapshotVersion,s.Un.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>s.Os.As(t,e,n?r:Xs.min(),n?i:Io()))).next((t=>({documents:t,Ks:i})))))}function xu(t,e){const n=ks(t),s=ks(n.Un),r=n.Ms.get(e);return r?Promise.resolve(r.target):n.persistence.runTransaction("Get target data","readonly",(t=>s.Tt(t,e).next((t=>t?t.target:null))))}function ku(t){const e=ks(t);return e.persistence.runTransaction("Get new document changes","readonly",(t=>function(t,e,n){const s=ks(t);let r=po(),i=rc(n);const o=cu(e),a=IDBKeyRange.lowerBound(i,!0);return o.Qt({index:Ia.readTimeIndex,range:a},((t,e)=>{const n=nc(s.O,e);r=r.insert(n.key,n),i=e.readTime})).next((()=>({ws:r,readTime:ic(i)})))}(e.Bs,t,e.Fs))).then((({ws:t,readTime:n})=>(e.Fs=n,t)))}async function Ou(t,e,n=Io()){const s=await Nu(t,yi(lc(e.bundledQuery))),r=ks(t);return r.persistence.runTransaction("Save named query","readwrite",(t=>{const i=Uo(e.readTime);if(s.snapshotVersion.compareTo(i)>=0)return r.Kn.saveNamedQuery(t,e);const o=s.withResumeToken(ar.EMPTY_BYTE_STRING,i);return r.Ms=r.Ms.insert(o.targetId,o),r.Un.updateTargetData(t,o).next((()=>r.Un.removeMatchingKeysForTargetId(t,s.targetId))).next((()=>r.Un.addMatchingKeys(t,n,s.targetId))).next((()=>r.Kn.saveNamedQuery(t,e)))}))}class Ru{constructor(t){this.O=t,this.Ws=new Map,this.zs=new Map}getBundleMetadata(t,e){return Ua.resolve(this.Ws.get(e))}saveBundleMetadata(t,e){var n;return this.Ws.set(e.id,{id:(n=e).id,version:n.version,createTime:Uo(n.createTime)}),Ua.resolve()}getNamedQuery(t,e){return Ua.resolve(this.zs.get(e))}saveNamedQuery(t,e){return this.zs.set(e.name,function(t){return{name:t.name,query:lc(t.bundledQuery),readTime:Uo(t.readTime)}}(e)),Ua.resolve()}}class Lu{constructor(){this.overlays=new co(br.comparator),this.Hs=new Map}getOverlay(t,e){return Ua.resolve(this.overlays.get(e))}saveOverlays(t,e,n){return n.forEach((n=>{this.Yt(t,e,n)})),Ua.resolve()}removeOverlaysForBatchId(t,e,n){const s=this.Hs.get(n);return void 0!==s&&(s.forEach((t=>this.overlays=this.overlays.remove(t))),this.Hs.delete(n)),Ua.resolve()}getOverlaysForCollection(t,e,n){const s=new Map,r=e.length+1,i=new br(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===r&&t.largestBatchId>n&&s.set(t.getKey(),t)}return Ua.resolve(s)}getOverlaysForCollectionGroup(t,e,n,s){let r=new co(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=r.get(t.largestBatchId);null===e&&(e=new Map,r=r.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=new Map,a=r.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(e,t))),!(o.size>=s)););return Ua.resolve(o)}Yt(t,e,n){if(null===n)return;const s=this.overlays.get(n.key);null!==s&&this.Hs.get(s.largestBatchId).delete(n.key),this.overlays=this.overlays.insert(n.key,new Za(e,n));let r=this.Hs.get(e);void 0===r&&(r=new Set,this.Hs.set(e,r)),r.add(n.key)}}class Mu{constructor(){this.Js=new lo(Pu.Ys),this.Xs=new lo(Pu.Zs)}isEmpty(){return this.Js.isEmpty()}addReference(t,e){const n=new Pu(t,e);this.Js=this.Js.add(n),this.Xs=this.Xs.add(n)}ti(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.ei(new Pu(t,e))}ni(t,e){t.forEach((t=>this.removeReference(t,e)))}si(t){const e=new br(new nr([])),n=new Pu(e,t),s=new Pu(e,t+1),r=[];return this.Xs.forEachInRange([n,s],(t=>{this.ei(t),r.push(t.key)})),r}ii(){this.Js.forEach((t=>this.ei(t)))}ei(t){this.Js=this.Js.delete(t),this.Xs=this.Xs.delete(t)}ri(t){const e=new br(new nr([])),n=new Pu(e,t),s=new Pu(e,t+1);let r=Io();return this.Xs.forEachInRange([n,s],(t=>{r=r.add(t.key)})),r}containsKey(t){const e=new Pu(t,0),n=this.Js.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class Pu{constructor(t,e){this.key=t,this.oi=e}static Ys(t,e){return br.comparator(t.key,e.key)||Hs(t.oi,e.oi)}static Zs(t,e){return Hs(t.oi,e.oi)||br.comparator(t.key,e.key)}}class Fu{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.gs=[],this.ci=1,this.ui=new lo(Pu.Ys)}checkEmpty(t){return Ua.resolve(0===this.gs.length)}addMutationBatch(t,e,n,s){const r=this.ci;this.ci++,this.gs.length>0&&this.gs[this.gs.length-1];const i=new Xa(r,e,n,s);this.gs.push(i);for(const e of s)this.ui=this.ui.add(new Pu(e.key,r)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Ua.resolve(i)}lookupMutationBatch(t,e){return Ua.resolve(this.ai(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,s=this.hi(n),r=s<0?0:s;return Ua.resolve(this.gs.length>r?this.gs[r]:null)}getHighestUnacknowledgedBatchId(){return Ua.resolve(0===this.gs.length?-1:this.ci-1)}getAllMutationBatches(t){return Ua.resolve(this.gs.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new Pu(e,0),s=new Pu(e,Number.POSITIVE_INFINITY),r=[];return this.ui.forEachInRange([n,s],(t=>{const e=this.ai(t.oi);r.push(e)})),Ua.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new lo(Hs);return e.forEach((t=>{const e=new Pu(t,0),s=new Pu(t,Number.POSITIVE_INFINITY);this.ui.forEachInRange([e,s],(t=>{n=n.add(t.oi)}))})),Ua.resolve(this.li(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,s=n.length+1;let r=n;br.isDocumentKey(r)||(r=r.child(""));const i=new Pu(new br(r),0);let o=new lo(Hs);return this.ui.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===s&&(o=o.add(t.oi)),!0)}),i),Ua.resolve(this.li(o))}li(t){const e=[];return t.forEach((t=>{const n=this.ai(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Ds(0===this.fi(e.batchId,"removed")),this.gs.shift();let n=this.ui;return Ua.forEach(e.mutations,(s=>{const r=new Pu(s.key,e.batchId);return n=n.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.ui=n}))}Qe(t){}containsKey(t,e){const n=new Pu(e,0),s=this.ui.firstAfterOrEqual(n);return Ua.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.gs.length,Ua.resolve()}fi(t,e){return this.hi(t)}hi(t){return 0===this.gs.length?0:t-this.gs[0].batchId}ai(t){const e=this.hi(t);return e<0||e>=this.gs.length?null:this.gs[e]}}class Vu{constructor(t){this.di=t,this.docs=new co(br.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,s=this.docs.get(n),r=s?s.size:0,i=this.di(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-r,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Ua.resolve(n?n.document.mutableCopy():Vr.newInvalidDocument(e))}getEntries(t,e){let n=po();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():Vr.newInvalidDocument(t))})),Ua.resolve(n)}getAll(t,e,n){let s=po();const r=new br(e.child("")),i=this.docs.getIteratorFrom(r);for(;i.hasNext();){const{key:t,value:{document:r}}=i.getNext();if(!e.isPrefixOf(t.path))break;t.path.length>e.length+1||r.readTime.compareTo(n)<=0||(s=s.insert(r.key,r.mutableCopy()))}return Ua.resolve(s)}_i(t,e){return Ua.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new Uu(this)}getSize(t){return Ua.resolve(this.size)}}class Uu extends ru{constructor(t){super(),this.Tn=t}applyChanges(t){const e=[];return this.changes.forEach(((n,s)=>{s.isValidDocument()?e.push(this.Tn.addEntry(t,s)):this.Tn.removeEntry(n)})),Ua.waitFor(e)}getFromCache(t,e){return this.Tn.getEntry(t,e)}getAllFromCache(t,e){return this.Tn.getEntries(t,e)}}class qu{constructor(t){this.persistence=t,this.wi=new su((t=>Gr(t)),zr),this.lastRemoteSnapshotVersion=Xs.min(),this.highestTargetId=0,this.mi=0,this.gi=new Mu,this.targetCount=0,this.yi=Gc.He()}forEachTarget(t,e){return this.wi.forEach(((t,n)=>e(n))),Ua.resolve()}getLastRemoteSnapshotVersion(t){return Ua.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Ua.resolve(this.mi)}allocateTargetId(t){return this.highestTargetId=this.yi.next(),Ua.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.mi&&(this.mi=e),Ua.resolve()}Ze(t){this.wi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.yi=new Gc(e),this.highestTargetId=e),t.sequenceNumber>this.mi&&(this.mi=t.sequenceNumber)}addTargetData(t,e){return this.Ze(e),this.targetCount+=1,Ua.resolve()}updateTargetData(t,e){return this.Ze(e),Ua.resolve()}removeTargetData(t,e){return this.wi.delete(e.target),this.gi.si(e.targetId),this.targetCount-=1,Ua.resolve()}removeTargets(t,e,n){let s=0;const r=[];return this.wi.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.wi.delete(i),r.push(this.removeMatchingKeysForTargetId(t,o.targetId)),s++)})),Ua.waitFor(r).next((()=>s))}getTargetCount(t){return Ua.resolve(this.targetCount)}getTargetData(t,e){const n=this.wi.get(e)||null;return Ua.resolve(n)}addMatchingKeys(t,e,n){return this.gi.ti(e,n),Ua.resolve()}removeMatchingKeys(t,e,n){this.gi.ni(e,n);const s=this.persistence.referenceDelegate,r=[];return s&&e.forEach((e=>{r.push(s.markPotentiallyOrphaned(t,e))})),Ua.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this.gi.si(e),Ua.resolve()}getMatchingKeysForTargetId(t,e){const n=this.gi.ri(e);return Ua.resolve(n)}containsKey(t,e){return Ua.resolve(this.gi.containsKey(e))}}class Bu{constructor(t,e){this.pi={},this.overlays={},this.Nn=new $s(0),this.xn=!1,this.xn=!0,this.referenceDelegate=t(this),this.Un=new qu(this),this.indexManager=new Dc,this.qn=function(t){return new Vu(t)}((t=>this.referenceDelegate.Ii(t))),this.O=new ec(e),this.Kn=new Ru(this.O)}start(){return Promise.resolve()}shutdown(){return this.xn=!1,Promise.resolve()}get started(){return this.xn}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Lu,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.pi[t.toKey()];return n||(n=new Fu(e,this.referenceDelegate),this.pi[t.toKey()]=n),n}getTargetCache(){return this.Un}getRemoteDocumentCache(){return this.qn}getBundleCache(){return this.Kn}runTransaction(t,e,n){Ss("MemoryPersistence","Starting transaction:",t);const s=new ju(this.Nn.next());return this.referenceDelegate.Ei(),n(s).next((t=>this.referenceDelegate.Ti(s).next((()=>t)))).toPromise().then((t=>(s.raiseOnCommittedEvent(),t)))}Ai(t,e){return Ua.or(Object.values(this.pi).map((n=>()=>n.containsKey(t,e))))}}class ju extends Va{constructor(t){super(),this.currentSequenceNumber=t}}class Ku{constructor(t){this.persistence=t,this.Ri=new Mu,this.Pi=null}static bi(t){return new Ku(t)}get vi(){if(this.Pi)return this.Pi;throw Cs()}addReference(t,e,n){return this.Ri.addReference(n,e),this.vi.delete(n.toString()),Ua.resolve()}removeReference(t,e,n){return this.Ri.removeReference(n,e),this.vi.add(n.toString()),Ua.resolve()}markPotentiallyOrphaned(t,e){return this.vi.add(e.toString()),Ua.resolve()}removeTarget(t,e){this.Ri.si(e.targetId).forEach((t=>this.vi.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.vi.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ei(){this.Pi=new Set}Ti(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ua.forEach(this.vi,(n=>{const s=br.fromPath(n);return this.Vi(t,s).next((t=>{t||e.removeEntry(s,Xs.min())}))})).next((()=>(this.Pi=null,e.apply(t))))}updateLimboDocument(t,e){return this.Vi(t,e).next((t=>{t?this.vi.delete(e.toString()):this.vi.add(e.toString())}))}Ii(t){return 0}Vi(t,e){return Ua.or([()=>Ua.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}function $u(t,e){return`firestore_clients_${t}_${e}`}function Gu(t,e,n){let s=`firestore_mutations_${t}_${n}`;return e.isAuthenticated()&&(s+=`_${e.uid}`),s}function zu(t,e){return`firestore_targets_${t}_${e}`}class Hu{constructor(t,e,n,s){this.user=t,this.batchId=e,this.state=n,this.error=s}static Si(t,e,n){const s=JSON.parse(n);let r,i="object"==typeof s&&-1!==["pending","acknowledged","rejected"].indexOf(s.state)&&(void 0===s.error||"object"==typeof s.error);return i&&s.error&&(i="string"==typeof s.error.message&&"string"==typeof s.error.code,i&&(r=new Rs(s.error.code,s.error.message))),i?new Hu(t,e,s.state,r):(As("SharedClientState",`Failed to parse mutation state for ID '${e}': ${n}`),null)}Di(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Qu{constructor(t,e,n){this.targetId=t,this.state=e,this.error=n}static Si(t,e){const n=JSON.parse(e);let s,r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error);return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code,r&&(s=new Rs(n.error.code,n.error.message))),r?new Qu(t,n.state,s):(As("SharedClientState",`Failed to parse target state for ID '${t}': ${e}`),null)}Di(){const t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)}}class Wu{constructor(t,e){this.clientId=t,this.activeTargetIds=e}static Si(t,e){const n=JSON.parse(e);let s="object"==typeof n&&n.activeTargetIds instanceof Array,r=Eo();for(let t=0;s&&t<n.activeTargetIds.length;++t)s=vr(n.activeTargetIds[t]),r=r.add(n.activeTargetIds[t]);return s?new Wu(t,r):(As("SharedClientState",`Failed to parse client data for instance '${t}': ${e}`),null)}}class Yu{constructor(t,e){this.clientId=t,this.onlineState=e}static Si(t){const e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Yu(e.clientId,e.onlineState):(As("SharedClientState",`Failed to parse online state: ${t}`),null)}}class Xu{constructor(){this.activeTargetIds=Eo()}Ci(t){this.activeTargetIds=this.activeTargetIds.add(t)}Ni(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Di(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Ju{constructor(t,e,n,s,r){this.window=t,this.Sn=e,this.persistenceKey=n,this.xi=s,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ki=this.Oi.bind(this),this.Mi=new co(Hs),this.started=!1,this.$i=[];const i=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=r,this.Fi=$u(this.persistenceKey,this.xi),this.Bi=function(t){return`firestore_sequence_number_${t}`}(this.persistenceKey),this.Mi=this.Mi.insert(this.xi,new Xu),this.Li=new RegExp(`^firestore_clients_${i}_([^_]*)$`),this.Ui=new RegExp(`^firestore_mutations_${i}_(\\d+)(?:_(.*))?$`),this.qi=new RegExp(`^firestore_targets_${i}_(\\d+)$`),this.Ki=function(t){return`firestore_online_state_${t}`}(this.persistenceKey),this.Gi=function(t){return`firestore_bundle_loaded_${t}`}(this.persistenceKey),this.window.addEventListener("storage",this.ki)}static Vt(t){return!(!t||!t.localStorage)}async start(){const t=await this.syncEngine.ds();for(const e of t){if(e===this.xi)continue;const t=this.getItem($u(this.persistenceKey,e));if(t){const n=Wu.Si(e,t);n&&(this.Mi=this.Mi.insert(n.clientId,n))}}this.ji();const e=this.storage.getItem(this.Ki);if(e){const t=this.Qi(e);t&&this.Wi(t)}for(const t of this.$i)this.Oi(t);this.$i=[],this.window.addEventListener("pagehide",(()=>this.shutdown())),this.started=!0}writeSequenceNumber(t){this.setItem(this.Bi,JSON.stringify(t))}getAllActiveQueryTargets(){return this.zi(this.Mi)}isActiveQueryTarget(t){let e=!1;return this.Mi.forEach(((n,s)=>{s.activeTargetIds.has(t)&&(e=!0)})),e}addPendingMutation(t){this.Hi(t,"pending")}updateMutationState(t,e,n){this.Hi(t,e,n),this.Ji(t)}addLocalQueryTarget(t){let e="not-current";if(this.isActiveQueryTarget(t)){const n=this.storage.getItem(zu(this.persistenceKey,t));if(n){const s=Qu.Si(t,n);s&&(e=s.state)}}return this.Yi.Ci(t),this.ji(),e}removeLocalQueryTarget(t){this.Yi.Ni(t),this.ji()}isLocalQueryTarget(t){return this.Yi.activeTargetIds.has(t)}clearQueryState(t){this.removeItem(zu(this.persistenceKey,t))}updateQueryState(t,e,n){this.Xi(t,e,n)}handleUserChange(t,e,n){e.forEach((t=>{this.Ji(t)})),this.currentUser=t,n.forEach((t=>{this.addPendingMutation(t)}))}setOnlineState(t){this.Zi(t)}notifyBundleLoaded(){this.tr()}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ki),this.removeItem(this.Fi),this.started=!1)}getItem(t){const e=this.storage.getItem(t);return Ss("SharedClientState","READ",t,e),e}setItem(t,e){Ss("SharedClientState","SET",t,e),this.storage.setItem(t,e)}removeItem(t){Ss("SharedClientState","REMOVE",t),this.storage.removeItem(t)}Oi(t){const e=t;if(e.storageArea===this.storage){if(Ss("SharedClientState","EVENT",e.key,e.newValue),e.key===this.Fi)return void As("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Sn.enqueueRetryable((async()=>{if(this.started){if(null!==e.key)if(this.Li.test(e.key)){if(null==e.newValue){const t=this.er(e.key);return this.nr(t,null)}{const t=this.sr(e.key,e.newValue);if(t)return this.nr(t.clientId,t)}}else if(this.Ui.test(e.key)){if(null!==e.newValue){const t=this.ir(e.key,e.newValue);if(t)return this.rr(t)}}else if(this.qi.test(e.key)){if(null!==e.newValue){const t=this.cr(e.key,e.newValue);if(t)return this.ur(t)}}else if(e.key===this.Ki){if(null!==e.newValue){const t=this.Qi(e.newValue);if(t)return this.Wi(t)}}else if(e.key===this.Bi){const t=function(t){let e=$s.A;if(null!=t)try{const n=JSON.parse(t);Ds("number"==typeof n),e=n}catch(t){As("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(e.newValue);t!==$s.A&&this.sequenceNumberHandler(t)}else if(e.key===this.Gi)return this.syncEngine.ar()}else this.$i.push(e)}))}}get Yi(){return this.Mi.get(this.xi)}ji(){this.setItem(this.Fi,this.Yi.Di())}Hi(t,e,n){const s=new Hu(this.currentUser,t,e,n),r=Gu(this.persistenceKey,this.currentUser,t);this.setItem(r,s.Di())}Ji(t){const e=Gu(this.persistenceKey,this.currentUser,t);this.removeItem(e)}Zi(t){const e={clientId:this.xi,onlineState:t};this.storage.setItem(this.Ki,JSON.stringify(e))}Xi(t,e,n){const s=zu(this.persistenceKey,t),r=new Qu(t,e,n);this.setItem(s,r.Di())}tr(){this.setItem(this.Gi,"value-not-used")}er(t){const e=this.Li.exec(t);return e?e[1]:null}sr(t,e){const n=this.er(t);return Wu.Si(n,e)}ir(t,e){const n=this.Ui.exec(t),s=Number(n[1]),r=void 0!==n[2]?n[2]:null;return Hu.Si(new vs(r),s,e)}cr(t,e){const n=this.qi.exec(t),s=Number(n[1]);return Qu.Si(s,e)}Qi(t){return Yu.Si(t)}async rr(t){if(t.user.uid===this.currentUser.uid)return this.syncEngine.hr(t.batchId,t.state,t.error);Ss("SharedClientState",`Ignoring mutation for non-active user ${t.user.uid}`)}ur(t){return this.syncEngine.lr(t.targetId,t.state,t.error)}nr(t,e){const n=e?this.Mi.insert(t,e):this.Mi.remove(t),s=this.zi(this.Mi),r=this.zi(n),i=[],o=[];return r.forEach((t=>{s.has(t)||i.push(t)})),s.forEach((t=>{r.has(t)||o.push(t)})),this.syncEngine.dr(i,o).then((()=>{this.Mi=n}))}Wi(t){this.Mi.get(t.clientId)&&this.onlineStateHandler(t.onlineState)}zi(t){let e=Eo();return t.forEach(((t,n)=>{e=e.unionWith(n.activeTargetIds)})),e}}class Zu{constructor(){this._r=new Xu,this.wr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this._r.Ci(t),this.wr[t]||"not-current"}updateQueryState(t,e,n){this.wr[t]=e}removeLocalQueryTarget(t){this._r.Ni(t)}isLocalQueryTarget(t){return this._r.activeTargetIds.has(t)}clearQueryState(t){delete this.wr[t]}getAllActiveQueryTargets(){return this._r.activeTargetIds}isActiveQueryTarget(t){return this._r.activeTargetIds.has(t)}start(){return this._r=new Xu,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(){}}class th{mr(t){}shutdown(){}}class eh{constructor(){this.gr=()=>this.yr(),this.pr=()=>this.Ir(),this.Er=[],this.Tr()}mr(t){this.Er.push(t)}shutdown(){window.removeEventListener("online",this.gr),window.removeEventListener("offline",this.pr)}Tr(){window.addEventListener("online",this.gr),window.addEventListener("offline",this.pr)}yr(){Ss("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.Er)t(0)}Ir(){Ss("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.Er)t(1)}static Vt(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const nh={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"};class sh{constructor(t){this.Ar=t.Ar,this.Rr=t.Rr}Pr(t){this.br=t}vr(t){this.Vr=t}onMessage(t){this.Sr=t}close(){this.Rr()}send(t){this.Ar(t)}Dr(){this.br()}Cr(t){this.Vr(t)}Nr(t){this.Sr(t)}}class rh extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http";this.kr=e+"://"+t.host,this.Or="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}Mr(t,e,n,s,r){const i=this.$r(t,e);Ss("RestConnection","Sending: ",i,n);const o={};return this.Fr(o,s,r),this.Br(t,i,o,n).then((t=>(Ss("RestConnection","Received: ",t),t)),(e=>{throw _s("RestConnection",`${t} failed with error: `,e,"url: ",i,"request:",n),e}))}Lr(t,e,n,s,r){return this.Mr(t,e,n,s,r)}Fr(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+bs,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}$r(t,e){const n=nh[t];return`${this.kr}/v1/${e}:${n}`}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams}Br(t,e,n,s){return new Promise(((r,i)=>{const o=new ys;o.listenOnce(ds.COMPLETE,(()=>{try{switch(o.getLastErrorCode()){case ls.NO_ERROR:const e=o.getResponseJson();Ss("Connection","XHR received:",JSON.stringify(e)),r(e);break;case ls.TIMEOUT:Ss("Connection",'RPC "'+t+'" timed out'),i(new Rs(Os.DEADLINE_EXCEEDED,"Request time out"));break;case ls.HTTP_ERROR:const n=o.getStatus();if(Ss("Connection",'RPC "'+t+'" failed with status:',n,"response text:",o.getResponseText()),n>0){const t=o.getResponseJson().error;if(t&&t.status&&t.message){const e=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Os).indexOf(e)>=0?e:Os.UNKNOWN}(t.status);i(new Rs(e,t.message))}else i(new Rs(Os.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Rs(Os.UNAVAILABLE,"Connection failed."));break;default:Cs()}}finally{Ss("Connection",'RPC "'+t+'" completed.')}}));const a=JSON.stringify(s);o.send(e,"POST",a,n,15)}))}Ur(t,e,n){const s=[this.kr,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=us(),i=hs(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new gs({})),this.Fr(o.initMessageHeaders,e,n),(0,a.uI)()||(0,a.b$)()||(0,a.d)()||(0,a.w1)()||(0,a.Mn)()||(0,a.ru)()||(o.httpHeadersOverwriteParam="$httpHeaders");const c=s.join("");Ss("Connection","Creating WebChannel: "+c,o);const u=r.createWebChannel(c,o);let h=!1,l=!1;const d=new sh({Ar:t=>{l?Ss("Connection","Not sending because WebChannel is closed:",t):(h||(Ss("Connection","Opening WebChannel transport."),u.open(),h=!0),Ss("Connection","WebChannel sending:",t),u.send(t))},Rr:()=>u.close()}),f=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return f(u,ps.EventType.OPEN,(()=>{l||Ss("Connection","WebChannel transport opened.")})),f(u,ps.EventType.CLOSE,(()=>{l||(l=!0,Ss("Connection","WebChannel transport closed"),d.Cr())})),f(u,ps.EventType.ERROR,(t=>{l||(l=!0,_s("Connection","WebChannel transport errored:",t),d.Cr(new Rs(Os.UNAVAILABLE,"The operation could not be completed")))})),f(u,ps.EventType.MESSAGE,(t=>{var e;if(!l){const n=t.data[0];Ds(!!n);const s=n,r=s.error||(null===(e=s[0])||void 0===e?void 0:e.error);if(r){Ss("Connection","WebChannel received error:",r);const t=r.status;let e=function(t){const e=ro[t];if(void 0!==e)return ao(e)}(t),n=r.message;void 0===e&&(e=Os.INTERNAL,n="Unknown error status: "+t+" with message "+r.message),l=!0,d.Cr(new Rs(e,n)),u.close()}else Ss("Connection","WebChannel received:",n),d.Nr(n)}})),f(i,fs.STAT_EVENT,(t=>{t.stat===ms.PROXY?Ss("Connection","Detected buffering proxy"):t.stat===ms.NOPROXY&&Ss("Connection","Detected no buffering proxy")})),setTimeout((()=>{d.Dr()}),0),d}}function ih(){return"undefined"!=typeof window?window:null}function oh(){return"undefined"!=typeof document?document:null}function ah(t){return new Mo(t,!0)}class ch{constructor(t,e,n=1e3,s=1.5,r=6e4){this.Sn=t,this.timerId=e,this.qr=n,this.Kr=s,this.Gr=r,this.jr=0,this.Qr=null,this.Wr=Date.now(),this.reset()}reset(){this.jr=0}zr(){this.jr=this.Gr}Hr(t){this.cancel();const e=Math.floor(this.jr+this.Jr()),n=Math.max(0,Date.now()-this.Wr),s=Math.max(0,e-n);s>0&&Ss("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.jr} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Qr=this.Sn.enqueueAfterDelay(this.timerId,s,(()=>(this.Wr=Date.now(),t()))),this.jr*=this.Kr,this.jr<this.qr&&(this.jr=this.qr),this.jr>this.Gr&&(this.jr=this.Gr)}Yr(){null!==this.Qr&&(this.Qr.skipDelay(),this.Qr=null)}cancel(){null!==this.Qr&&(this.Qr.cancel(),this.Qr=null)}Jr(){return(Math.random()-.5)*this.jr}}class uh{constructor(t,e,n,s,r,i,o,a){this.Sn=t,this.Xr=n,this.Zr=s,this.eo=r,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.no=0,this.so=null,this.io=null,this.stream=null,this.ro=new ch(t,e)}oo(){return 1===this.state||5===this.state||this.co()}co(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.uo()}async stop(){this.oo()&&await this.close(0)}ao(){this.state=0,this.ro.reset()}ho(){this.co()&&null===this.so&&(this.so=this.Sn.enqueueAfterDelay(this.Xr,6e4,(()=>this.lo())))}fo(t){this._o(),this.stream.send(t)}async lo(){if(this.co())return this.close(0)}_o(){this.so&&(this.so.cancel(),this.so=null)}wo(){this.io&&(this.io.cancel(),this.io=null)}async close(t,e){this._o(),this.wo(),this.ro.cancel(),this.no++,4!==t?this.ro.reset():e&&e.code===Os.RESOURCE_EXHAUSTED?(As(e.toString()),As("Using maximum backoff delay to prevent overloading the backend."),this.ro.zr()):e&&e.code===Os.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.mo(),this.stream.close(),this.stream=null),this.state=t,await this.listener.vr(e)}mo(){}auth(){this.state=1;const t=this.yo(this.no),e=this.no;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.no===e&&this.po(t,n)}),(e=>{t((()=>{const t=new Rs(Os.UNKNOWN,"Fetching auth token failed: "+e.message);return this.Io(t)}))}))}po(t,e){const n=this.yo(this.no);this.stream=this.Eo(t,e),this.stream.Pr((()=>{n((()=>(this.state=2,this.io=this.Sn.enqueueAfterDelay(this.Zr,1e4,(()=>(this.co()&&(this.state=3),Promise.resolve()))),this.listener.Pr())))})),this.stream.vr((t=>{n((()=>this.Io(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}uo(){this.state=5,this.ro.Hr((async()=>{this.state=0,this.start()}))}Io(t){return Ss("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}yo(t){return e=>{this.Sn.enqueueAndForget((()=>this.no===t?e():(Ss("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class hh extends uh{constructor(t,e,n,s,r,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,s,i),this.O=r}Eo(t,e){return this.eo.Ur("Listen",t,e)}onMessage(t){this.ro.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const s=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Cs()}(e.targetChange.targetChangeType||"NO_CHANGE"),r=e.targetChange.targetIds||[],i=function(t,e){return t.N?(Ds(void 0===e||"string"==typeof e),ar.fromBase64String(e||"")):(Ds(void 0===e||e instanceof Uint8Array),ar.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Os.UNKNOWN:ao(t.code);return new Rs(e,t.message||"")}(o);n=new Co(s,r,i,a||null)}else if("documentChange"in e){e.documentChange;const s=e.documentChange;s.document,s.document.name,s.document.updateTime;const r=Ko(t,s.document.name),i=Uo(s.document.updateTime),o=new Pr({mapValue:{fields:s.document.fields}}),a=Vr.newFoundDocument(r,i,o),c=s.targetIds||[],u=s.removedTargetIds||[];n=new _o(c,u,a.key,a)}else if("documentDelete"in e){e.documentDelete;const s=e.documentDelete;s.document;const r=Ko(t,s.document),i=s.readTime?Uo(s.readTime):Xs.min(),o=Vr.newNoDocument(r,i),a=s.removedTargetIds||[];n=new _o([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const s=e.documentRemove;s.document;const r=Ko(t,s.document),i=s.removedTargetIds||[];n=new _o([],i,r,null)}else{if(!("filter"in e))return Cs();{e.filter;const t=e.filter;t.targetId;const s=t.count||0,r=new so(s),i=t.targetId;n=new No(i,r)}}return n}(this.O,t),n=function(t){if(!("targetChange"in t))return Xs.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Xs.min():e.readTime?Uo(e.readTime):Xs.min()}(t);return this.listener.To(e,n)}Ao(t){const e={};e.database=zo(this.O),e.addTarget=function(t,e){let n;const s=e.target;return n=Hr(s)?{documents:Jo(t,s)}:{query:Zo(t,s)},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Fo(t,e.resumeToken):e.snapshotVersion.compareTo(Xs.min())>0&&(n.readTime=Po(t,e.snapshotVersion.toTimestamp())),n}(this.O,t);const n=function(t,e){const n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Cs()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.O,t);n&&(e.labels=n),this.fo(e)}Ro(t){const e={};e.database=zo(this.O),e.removeTarget=t,this.fo(e)}}class lh extends uh{constructor(t,e,n,s,r,i){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,s,i),this.O=r,this.Po=!1}get bo(){return this.Po}start(){this.Po=!1,this.lastStreamToken=void 0,super.start()}mo(){this.Po&&this.vo([])}Eo(t,e){return this.eo.Ur("Write",t,e)}onMessage(t){if(Ds(!!t.streamToken),this.lastStreamToken=t.streamToken,this.Po){this.ro.reset();const e=function(t,e){return t&&t.length>0?(Ds(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Uo(t.updateTime):Uo(e);return n.isEqual(Xs.min())&&(n=Uo(e)),new Bi(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Uo(t.commitTime);return this.listener.Vo(n,e)}return Ds(!t.writeResults||0===t.writeResults.length),this.Po=!0,this.listener.So()}Do(){const t={};t.database=zo(this.O),this.fo(t)}vo(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>Yo(this.O,t)))};this.fo(e)}}class dh extends class{}{constructor(t,e,n,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.eo=n,this.O=s,this.Co=!1}No(){if(this.Co)throw new Rs(Os.FAILED_PRECONDITION,"The client has already been terminated.")}Mr(t,e,n){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.eo.Mr(t,e,n,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Os.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Rs(Os.UNKNOWN,t.toString())}))}Lr(t,e,n){return this.No(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.eo.Lr(t,e,n,s,r))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Os.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Rs(Os.UNKNOWN,t.toString())}))}terminate(){this.Co=!0}}class fh{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.xo=0,this.ko=null,this.Oo=!0}Mo(){0===this.xo&&(this.$o("Unknown"),this.ko=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.ko=null,this.Fo("Backend didn't respond within 10 seconds."),this.$o("Offline"),Promise.resolve()))))}Bo(t){"Online"===this.state?this.$o("Unknown"):(this.xo++,this.xo>=1&&(this.Lo(),this.Fo(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.$o("Offline")))}set(t){this.Lo(),this.xo=0,"Online"===t&&(this.Oo=!1),this.$o(t)}$o(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}Fo(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.Oo?(As(e),this.Oo=!1):Ss("OnlineStateTracker",e)}Lo(){null!==this.ko&&(this.ko.cancel(),this.ko=null)}}class mh{constructor(t,e,n,s,r){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Uo=[],this.qo=new Map,this.Ko=new Set,this.Go=[],this.jo=r,this.jo.mr((t=>{n.enqueueAndForget((async()=>{Eh(this)&&(Ss("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=ks(t);e.Ko.add(4),await ph(e),e.Qo.set("Unknown"),e.Ko.delete(4),await gh(e)}(this))}))})),this.Qo=new fh(n,s)}}async function gh(t){if(Eh(t))for(const e of t.Go)await e(!0)}async function ph(t){for(const e of t.Go)await e(!1)}function yh(t,e){const n=ks(t);n.qo.has(e.targetId)||(n.qo.set(e.targetId,e),Th(n)?Ih(n):Bh(n).co()&&vh(n,e))}function wh(t,e){const n=ks(t),s=Bh(n);n.qo.delete(e),s.co()&&bh(n,e),0===n.qo.size&&(s.co()?s.ho():Eh(n)&&n.Qo.set("Unknown"))}function vh(t,e){t.Wo.Z(e.targetId),Bh(t).Ao(e)}function bh(t,e){t.Wo.Z(e),Bh(t).Ro(e)}function Ih(t){t.Wo=new xo({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Tt:e=>t.qo.get(e)||null}),Bh(t).start(),t.Qo.Mo()}function Th(t){return Eh(t)&&!Bh(t).oo()&&t.qo.size>0}function Eh(t){return 0===ks(t).Ko.size}function Sh(t){t.Wo=void 0}async function Ah(t){t.qo.forEach(((e,n)=>{vh(t,e)}))}async function _h(t,e){Sh(t),Th(t)?(t.Qo.Bo(e),Ih(t)):t.Qo.set("Unknown")}async function Nh(t,e,n){if(t.Qo.set("Online"),e instanceof Co&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const s of e.targetIds)t.qo.has(s)&&(await t.remoteSyncer.rejectListen(s,n),t.qo.delete(s),t.Wo.removeTarget(s))}(t,e)}catch(n){Ss("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Ch(t,n)}else if(e instanceof _o?t.Wo.ct(e):e instanceof No?t.Wo._t(e):t.Wo.ht(e),!n.isEqual(Xs.min()))try{const e=await Su(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.Wo.yt(e);return n.targetChanges.forEach(((n,s)=>{if(n.resumeToken.approximateByteSize()>0){const r=t.qo.get(s);r&&t.qo.set(s,r.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach((e=>{const n=t.qo.get(e);if(!n)return;t.qo.set(e,n.withResumeToken(ar.EMPTY_BYTE_STRING,n.snapshotVersion)),bh(t,e);const s=new tc(n.target,e,1,n.sequenceNumber);vh(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){Ss("RemoteStore","Failed to raise snapshot:",e),await Ch(t,e)}}async function Ch(t,e,n){if(!$a(e))throw e;t.Ko.add(1),await ph(t),t.Qo.set("Offline"),n||(n=()=>Su(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ss("RemoteStore","Retrying IndexedDB access"),await n(),t.Ko.delete(1),await gh(t)}))}function Dh(t,e){return e().catch((n=>Ch(t,n,e)))}async function xh(t){const e=ks(t),n=jh(e);let s=e.Uo.length>0?e.Uo[e.Uo.length-1].batchId:-1;for(;kh(e);)try{const t=await _u(e.localStore,s);if(null===t){0===e.Uo.length&&n.ho();break}s=t.batchId,Oh(e,t)}catch(t){await Ch(e,t)}Rh(e)&&Lh(e)}function kh(t){return Eh(t)&&t.Uo.length<10}function Oh(t,e){t.Uo.push(e);const n=jh(t);n.co()&&n.bo&&n.vo(e.mutations)}function Rh(t){return Eh(t)&&!jh(t).oo()&&t.Uo.length>0}function Lh(t){jh(t).start()}async function Mh(t){jh(t).Do()}async function Ph(t){const e=jh(t);for(const n of t.Uo)e.vo(n.mutations)}async function Fh(t,e,n){const s=t.Uo.shift(),r=Ja.from(s,e,n);await Dh(t,(()=>t.remoteSyncer.applySuccessfulWrite(r))),await xh(t)}async function Vh(t,e){e&&jh(t).bo&&await async function(t,e){if(oo(n=e.code)&&n!==Os.ABORTED){const n=t.Uo.shift();jh(t).ao(),await Dh(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await xh(t)}var n}(t,e),Rh(t)&&Lh(t)}async function Uh(t,e){const n=ks(t);n.asyncQueue.verifyOperationInProgress(),Ss("RemoteStore","RemoteStore received new credentials");const s=Eh(n);n.Ko.add(3),await ph(n),s&&n.Qo.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ko.delete(3),await gh(n)}async function qh(t,e){const n=ks(t);e?(n.Ko.delete(2),await gh(n)):e||(n.Ko.add(2),await ph(n),n.Qo.set("Unknown"))}function Bh(t){return t.zo||(t.zo=function(t,e,n){const s=ks(t);return s.No(),new hh(e,s.eo,s.authCredentials,s.appCheckCredentials,s.O,n)}(t.datastore,t.asyncQueue,{Pr:Ah.bind(null,t),vr:_h.bind(null,t),To:Nh.bind(null,t)}),t.Go.push((async e=>{e?(t.zo.ao(),Th(t)?Ih(t):t.Qo.set("Unknown")):(await t.zo.stop(),Sh(t))}))),t.zo}function jh(t){return t.Ho||(t.Ho=function(t,e,n){const s=ks(t);return s.No(),new lh(e,s.eo,s.authCredentials,s.appCheckCredentials,s.O,n)}(t.datastore,t.asyncQueue,{Pr:Mh.bind(null,t),vr:Vh.bind(null,t),So:Ph.bind(null,t),Vo:Fh.bind(null,t)}),t.Go.push((async e=>{e?(t.Ho.ao(),await xh(t)):(await t.Ho.stop(),t.Uo.length>0&&(Ss("RemoteStore",`Stopping write stream with ${t.Uo.length} pending writes`),t.Uo=[]))}))),t.Ho}class Kh{constructor(t,e,n,s,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=s,this.removalCallback=r,this.deferred=new Ls,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}static createAndSchedule(t,e,n,s,r){const i=Date.now()+n,o=new Kh(t,e,i,s,r);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Rs(Os.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function $h(t,e){if(As("AsyncQueue",`${e}: ${t}`),$a(t))return new Rs(Os.UNAVAILABLE,`${e}: ${t}`);throw t}class Gh{constructor(t){this.comparator=t?(e,n)=>t(e,n)||br.comparator(e.key,n.key):(t,e)=>br.comparator(t.key,e.key),this.keyedMap=wo(),this.sortedSet=new co(this.comparator)}static emptySet(t){return new Gh(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Gh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,s=n.getNext().key;if(!t.isEqual(s))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Gh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class zh{constructor(){this.Jo=new co(br.comparator)}track(t){const e=t.doc.key,n=this.Jo.get(e);n?0!==t.type&&3===n.type?this.Jo=this.Jo.insert(e,t):3===t.type&&1!==n.type?this.Jo=this.Jo.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Jo=this.Jo.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Jo=this.Jo.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Jo=this.Jo.remove(e):1===t.type&&2===n.type?this.Jo=this.Jo.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Jo=this.Jo.insert(e,{type:2,doc:t.doc}):Cs():this.Jo=this.Jo.insert(e,t)}Yo(){const t=[];return this.Jo.inorderTraversal(((e,n)=>{t.push(n)})),t}}class Hh{constructor(t,e,n,s,r,i,o,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=s,this.mutatedKeys=r,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a}static fromInitialDocuments(t,e,n,s){const r=[];return e.forEach((t=>{r.push({type:0,doc:t})})),new Hh(t,e,Gh.emptySet(e),r,n,s,!0,!1)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&vi(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class Qh{constructor(){this.Xo=void 0,this.listeners=[]}}class Wh{constructor(){this.queries=new su((t=>bi(t)),vi),this.onlineState="Unknown",this.Zo=new Set}}async function Yh(t,e){const n=ks(t),s=e.query;let r=!1,i=n.queries.get(s);if(i||(r=!0,i=new Qh),r)try{i.Xo=await n.onListen(s)}catch(t){const n=$h(t,`Initialization of query '${Ii(e.query)}' failed`);return void e.onError(n)}n.queries.set(s,i),i.listeners.push(e),e.tc(n.onlineState),i.Xo&&e.ec(i.Xo)&&tl(n)}async function Xh(t,e){const n=ks(t),s=e.query;let r=!1;const i=n.queries.get(s);if(i){const t=i.listeners.indexOf(e);t>=0&&(i.listeners.splice(t,1),r=0===i.listeners.length)}if(r)return n.queries.delete(s),n.onUnlisten(s)}function Jh(t,e){const n=ks(t);let s=!1;for(const t of e){const e=t.query,r=n.queries.get(e);if(r){for(const e of r.listeners)e.ec(t)&&(s=!0);r.Xo=t}}s&&tl(n)}function Zh(t,e,n){const s=ks(t),r=s.queries.get(e);if(r)for(const t of r.listeners)t.onError(n);s.queries.delete(e)}function tl(t){t.Zo.forEach((t=>{t.next()}))}class el{constructor(t,e,n){this.query=t,this.nc=e,this.sc=!1,this.ic=null,this.onlineState="Unknown",this.options=n||{}}ec(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Hh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}let e=!1;return this.sc?this.rc(t)&&(this.nc.next(t),e=!0):this.oc(t,this.onlineState)&&(this.cc(t),e=!0),this.ic=t,e}onError(t){this.nc.error(t)}tc(t){this.onlineState=t;let e=!1;return this.ic&&!this.sc&&this.oc(this.ic,t)&&(this.cc(this.ic),e=!0),e}oc(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return!(this.options.uc&&n||t.docs.isEmpty()&&"Offline"!==e)}rc(t){if(t.docChanges.length>0)return!0;const e=this.ic&&this.ic.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}cc(t){t=Hh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.sc=!0,this.nc.next(t)}}class nl{constructor(t,e){this.payload=t,this.byteLength=e}ac(){return"metadata"in this.payload}}class sl{constructor(t){this.O=t}Gs(t){return Ko(this.O,t)}js(t){return t.metadata.exists?Wo(this.O,t.document,!1):Vr.newNoDocument(this.Gs(t.metadata.name),this.Qs(t.metadata.readTime))}Qs(t){return Uo(t)}}class rl{constructor(t,e,n){this.hc=t,this.localStore=e,this.O=n,this.queries=[],this.documents=[],this.progress=il(t)}lc(t){this.progress.bytesLoaded+=t.byteLength;let e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null}fc(t){const e=new Map,n=new sl(this.O);for(const s of t)if(s.metadata.queries){const t=n.Gs(s.metadata.name);for(const n of s.metadata.queries){const s=(e.get(n)||Io()).add(t);e.set(n,s)}}return e}async complete(){const t=await async function(t,e,n,s){const r=ks(t);let i=Io(),o=po();for(const t of n){const n=e.Gs(t.metadata.name);t.document&&(i=i.add(n));const s=e.js(t);s.setReadTime(e.Qs(t.metadata.readTime)),o=o.insert(n,s)}const a=r.Bs.newChangeBuffer({trackRemovals:!0}),c=await Nu(r,function(t){return yi(hi(nr.fromString(`__bundle__/docs/${t}`)))}(s));return r.persistence.runTransaction("Apply bundle documents","readwrite",(t=>Au(t,a,o).next((e=>(a.apply(t),e))).next((e=>r.Un.removeMatchingKeysForTargetId(t,c.targetId).next((()=>r.Un.addMatchingKeys(t,i,c.targetId))).next((()=>r.Us.Ts(t,e))).next((()=>e))))))}(this.localStore,new sl(this.O),this.documents,this.hc.id),e=this.fc(this.documents);for(const t of this.queries)await Ou(this.localStore,t,e.get(t.name));return this.progress.taskState="Success",new yu(Object.assign({},this.progress),t)}}function il(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}class ol{constructor(t){this.key=t}}class al{constructor(t){this.key=t}}class cl{constructor(t,e){this.query=t,this.dc=e,this._c=null,this.current=!1,this.wc=Io(),this.mutatedKeys=Io(),this.mc=Ei(t),this.gc=new Gh(this.mc)}get yc(){return this.dc}Ic(t,e){const n=e?e.Ec:new zh,s=e?e.gc:this.gc;let r=e?e.mutatedKeys:this.mutatedKeys,i=s,o=!1;const a=li(this.query)&&s.size===this.query.limit?s.last():null,c=di(this.query)&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((t,e)=>{const u=s.get(t),h=Ti(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Tc(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.mc(h,a)>0||c&&this.mc(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(i=i.add(h),r=d?r.add(t):r.delete(t)):(i=i.delete(t),r=r.delete(t)))})),li(this.query)||di(this.query))for(;i.size>this.query.limit;){const t=li(this.query)?i.last():i.first();i=i.delete(t.key),r=r.delete(t.key),n.track({type:1,doc:t})}return{gc:i,Ec:n,ks:o,mutatedKeys:r}}Tc(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n){const s=this.gc;this.gc=t.gc,this.mutatedKeys=t.mutatedKeys;const r=t.Ec.Yo();r.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Cs()}};return n(t)-n(e)}(t.type,e.type)||this.mc(t.doc,e.doc))),this.Ac(n);const i=e?this.Rc():[],o=0===this.wc.size&&this.current?1:0,a=o!==this._c;return this._c=o,0!==r.length||a?{snapshot:new Hh(this.query,t.gc,s,r,t.mutatedKeys,0===o,a,!1),Pc:i}:{Pc:i}}tc(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({gc:this.gc,Ec:new zh,mutatedKeys:this.mutatedKeys,ks:!1},!1)):{Pc:[]}}bc(t){return!this.dc.has(t)&&!!this.gc.has(t)&&!this.gc.get(t).hasLocalMutations}Ac(t){t&&(t.addedDocuments.forEach((t=>this.dc=this.dc.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.dc=this.dc.delete(t))),this.current=t.current)}Rc(){if(!this.current)return[];const t=this.wc;this.wc=Io(),this.gc.forEach((t=>{this.bc(t.key)&&(this.wc=this.wc.add(t.key))}));const e=[];return t.forEach((t=>{this.wc.has(t)||e.push(new al(t))})),this.wc.forEach((n=>{t.has(n)||e.push(new ol(n))})),e}vc(t){this.dc=t.Ks,this.wc=Io();const e=this.Ic(t.documents);return this.applyChanges(e,!0)}Vc(){return Hh.fromInitialDocuments(this.query,this.gc,this.mutatedKeys,0===this._c)}}class ul{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class hl{constructor(t){this.key=t,this.Sc=!1}}class ll{constructor(t,e,n,s,r,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=i,this.Dc={},this.Cc=new su((t=>bi(t)),vi),this.Nc=new Map,this.xc=new Set,this.kc=new co(br.comparator),this.Oc=new Map,this.Mc=new Mu,this.$c={},this.Fc=new Map,this.Bc=Gc.Je(),this.onlineState="Unknown",this.Lc=void 0}get isPrimaryClient(){return!0===this.Lc}}async function dl(t,e){const n=Vl(t);let s,r;const i=n.Cc.get(e);if(i)s=i.targetId,n.sharedClientState.addLocalQueryTarget(s),r=i.view.Vc();else{const t=await Nu(n.localStore,yi(e));n.isPrimaryClient&&yh(n.remoteStore,t);const i=n.sharedClientState.addLocalQueryTarget(t.targetId);s=t.targetId,r=await fl(n,e,s,"current"===i)}return r}async function fl(t,e,n,s){t.Uc=(e,n,s)=>async function(t,e,n,s){let r=e.view.Ic(n);r.ks&&(r=await Du(t.localStore,e.query,!1).then((({documents:t})=>e.view.Ic(t,r))));const i=s&&s.targetChanges.get(e.targetId),o=e.view.applyChanges(r,t.isPrimaryClient,i);return Sl(t,e.targetId,o.Pc),o.snapshot}(t,e,n,s);const r=await Du(t.localStore,e,!0),i=new cl(e,r.Ks),o=i.Ic(r.documents),a=Ao.createSynthesizedTargetChangeForCurrentChange(n,s&&"Offline"!==t.onlineState),c=i.applyChanges(o,t.isPrimaryClient,a);Sl(t,n,c.Pc);const u=new ul(e,n,i);return t.Cc.set(e,u),t.Nc.has(n)?t.Nc.get(n).push(e):t.Nc.set(n,[e]),c.snapshot}async function ml(t,e){const n=ks(t),s=n.Cc.get(e),r=n.Nc.get(s.targetId);if(r.length>1)return n.Nc.set(s.targetId,r.filter((t=>!vi(t,e)))),void n.Cc.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(s.targetId),n.sharedClientState.isActiveQueryTarget(s.targetId)||await Cu(n.localStore,s.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(s.targetId),wh(n.remoteStore,s.targetId),Tl(n,s.targetId)})).catch(Yc)):(Tl(n,s.targetId),await Cu(n.localStore,s.targetId,!0))}async function gl(t,e){const n=ks(t);try{const t=await function(t,e){const n=ks(t),s=e.snapshotVersion;let r=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.Bs.newChangeBuffer({trackRemovals:!0});r=n.Ms;const o=[];e.targetChanges.forEach(((i,a)=>{const c=r.get(a);if(!c)return;o.push(n.Un.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Un.addMatchingKeys(t,i.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);e.targetMismatches.has(a)?u=u.withResumeToken(ar.EMPTY_BYTE_STRING,Xs.min()).withLastLimboFreeSnapshotVersion(Xs.min()):i.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(i.resumeToken,s)),r=r.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,i)&&o.push(n.Un.updateTargetData(t,u))}));let a=po();if(e.documentUpdates.forEach((s=>{e.resolvedLimboDocuments.has(s)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,s))})),o.push(Au(t,i,e.documentUpdates).next((t=>{a=t}))),!s.isEqual(Xs.min())){const e=n.Un.getLastRemoteSnapshotVersion(t).next((e=>n.Un.setTargetsMetadata(t,t.currentSequenceNumber,s)));o.push(e)}return Ua.waitFor(o).next((()=>i.apply(t))).next((()=>n.Us.Ts(t,a))).next((()=>a))})).then((t=>(n.Ms=r,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const s=n.Oc.get(e);s&&(Ds(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?s.Sc=!0:t.modifiedDocuments.size>0?Ds(s.Sc):t.removedDocuments.size>0&&(Ds(s.Sc),s.Sc=!1))})),await Nl(n,t,e)}catch(t){await Yc(t)}}function pl(t,e,n){const s=ks(t);if(s.isPrimaryClient&&0===n||!s.isPrimaryClient&&1===n){const t=[];s.Cc.forEach(((n,s)=>{const r=s.view.tc(e);r.snapshot&&t.push(r.snapshot)})),function(t,e){const n=ks(t);n.onlineState=e;let s=!1;n.queries.forEach(((t,n)=>{for(const t of n.listeners)t.tc(e)&&(s=!0)})),s&&tl(n)}(s.eventManager,e),t.length&&s.Dc.To(t),s.onlineState=e,s.isPrimaryClient&&s.sharedClientState.setOnlineState(e)}}async function yl(t,e,n){const s=ks(t);s.sharedClientState.updateQueryState(e,"rejected",n);const r=s.Oc.get(e),i=r&&r.key;if(i){let t=new co(br.comparator);t=t.insert(i,Vr.newNoDocument(i,Xs.min()));const n=Io().add(i),r=new So(Xs.min(),new Map,new lo(Hs),t,n);await gl(s,r),s.kc=s.kc.remove(i),s.Oc.delete(e),_l(s)}else await Cu(s.localStore,e,!1).then((()=>Tl(s,e,n))).catch(Yc)}async function wl(t,e){const n=ks(t),s=e.batch.batchId;try{const t=await function(t,e){const n=ks(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const s=e.batch.keys(),r=n.Bs.newChangeBuffer({trackRemovals:!0});return function(t,e,n,s){const r=n.batch,i=r.keys();let o=Ua.resolve();return i.forEach((t=>{o=o.next((()=>s.getEntry(e,t))).next((e=>{const i=n.docVersions.get(t);Ds(null!==i),e.version.compareTo(i)<0&&(r.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),s.addEntry(e)))}))})),o.next((()=>t.gs.removeMutationBatch(e,r)))}(n,t,e,r).next((()=>r.apply(t))).next((()=>n.gs.performConsistencyCheck(t))).next((()=>n.Us.Es(t,s)))}))}(n.localStore,e);Il(n,s,null),bl(n,s),n.sharedClientState.updateMutationState(s,"acknowledged"),await Nl(n,t)}catch(t){await Yc(t)}}async function vl(t,e,n){const s=ks(t);try{const t=await function(t,e){const n=ks(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let s;return n.gs.lookupMutationBatch(t,e).next((e=>(Ds(null!==e),s=e.keys(),n.gs.removeMutationBatch(t,e)))).next((()=>n.gs.performConsistencyCheck(t))).next((()=>n.Us.Es(t,s)))}))}(s.localStore,e);Il(s,e,n),bl(s,e),s.sharedClientState.updateMutationState(e,"rejected",n),await Nl(s,t)}catch(n){await Yc(n)}}function bl(t,e){(t.Fc.get(e)||[]).forEach((t=>{t.resolve()})),t.Fc.delete(e)}function Il(t,e,n){const s=ks(t);let r=s.$c[s.currentUser.toKey()];if(r){const t=r.get(e);t&&(n?t.reject(n):t.resolve(),r=r.remove(e)),s.$c[s.currentUser.toKey()]=r}}function Tl(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const s of t.Nc.get(e))t.Cc.delete(s),n&&t.Dc.qc(s,n);t.Nc.delete(e),t.isPrimaryClient&&t.Mc.si(e).forEach((e=>{t.Mc.containsKey(e)||El(t,e)}))}function El(t,e){t.xc.delete(e.path.canonicalString());const n=t.kc.get(e);null!==n&&(wh(t.remoteStore,n),t.kc=t.kc.remove(e),t.Oc.delete(n),_l(t))}function Sl(t,e,n){for(const s of n)s instanceof ol?(t.Mc.addReference(s.key,e),Al(t,s)):s instanceof al?(Ss("SyncEngine","Document no longer in limbo: "+s.key),t.Mc.removeReference(s.key,e),t.Mc.containsKey(s.key)||El(t,s.key)):Cs()}function Al(t,e){const n=e.key,s=n.path.canonicalString();t.kc.get(n)||t.xc.has(s)||(Ss("SyncEngine","New document in limbo: "+n),t.xc.add(s),_l(t))}function _l(t){for(;t.xc.size>0&&t.kc.size<t.maxConcurrentLimboResolutions;){const e=t.xc.values().next().value;t.xc.delete(e);const n=new br(nr.fromString(e)),s=t.Bc.next();t.Oc.set(s,new hl(n)),t.kc=t.kc.insert(n,s),yh(t.remoteStore,new tc(yi(hi(n.path)),s,2,$s.A))}}async function Nl(t,e,n){const s=ks(t),r=[],i=[],o=[];s.Cc.isEmpty()||(s.Cc.forEach(((t,a)=>{o.push(s.Uc(a,e,n).then((t=>{if(t){s.isPrimaryClient&&s.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),r.push(t);const e=vu.Ss(a.targetId,t);i.push(e)}})))})),await Promise.all(o),s.Dc.To(r),await async function(t,e){const n=ks(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>Ua.forEach(e,(e=>Ua.forEach(e.vs,(s=>n.persistence.referenceDelegate.addReference(t,e.targetId,s))).next((()=>Ua.forEach(e.Vs,(s=>n.persistence.referenceDelegate.removeReference(t,e.targetId,s)))))))))}catch(t){if(!$a(t))throw t;Ss("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.Ms.get(e),s=t.snapshotVersion,r=t.withLastLimboFreeSnapshotVersion(s);n.Ms=n.Ms.insert(e,r)}}}(s.localStore,i))}async function Cl(t,e){const n=ks(t);if(!n.currentUser.isEqual(e)){Ss("SyncEngine","User change. New user:",e.toKey());const t=await Eu(n.localStore,e);n.currentUser=e,function(t,e){t.Fc.forEach((t=>{t.forEach((t=>{t.reject(new Rs(Os.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Fc.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Nl(n,t.qs)}}function Dl(t,e){const n=ks(t),s=n.Oc.get(e);if(s&&s.Sc)return Io().add(s.key);{let t=Io();const s=n.Nc.get(e);if(!s)return t;for(const e of s){const s=n.Cc.get(e);t=t.unionWith(s.view.yc)}return t}}async function xl(t,e){const n=ks(t),s=await Du(n.localStore,e.query,!0),r=e.view.vc(s);return n.isPrimaryClient&&Sl(n,e.targetId,r.Pc),r}async function kl(t){const e=ks(t);return ku(e.localStore).then((t=>Nl(e,t)))}async function Ol(t,e,n,s){const r=ks(t),i=await function(t,e){const n=ks(t),s=ks(n.gs);return n.persistence.runTransaction("Lookup mutation documents","readonly",(t=>s.Ge(t,e).next((e=>e?n.Us.Es(t,e):Ua.resolve(null)))))}(r.localStore,e);null!==i?("pending"===n?await xh(r.remoteStore):"acknowledged"===n||"rejected"===n?(Il(r,e,s||null),bl(r,e),function(t,e){ks(ks(t).gs).Qe(e)}(r.localStore,e)):Cs(),await Nl(r,i)):Ss("SyncEngine","Cannot apply mutation batch with id: "+e)}async function Rl(t,e,n){const s=ks(t),r=[],i=[];for(const t of e){let e;const n=s.Nc.get(t);if(n&&0!==n.length){e=await Nu(s.localStore,yi(n[0]));for(const t of n){const e=s.Cc.get(t),n=await xl(s,e);n.snapshot&&i.push(n.snapshot)}}else{const n=await xu(s.localStore,t);e=await Nu(s.localStore,n),await fl(s,Ll(n),t,!1)}r.push(e)}return s.Dc.To(i),r}function Ll(t){return ui(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function Ml(t){const e=ks(t);return ks(ks(e.localStore).persistence).ds()}async function Pl(t,e,n,s){const r=ks(t);if(r.Lc)Ss("SyncEngine","Ignoring unexpected query state notification.");else if(r.Nc.has(e))switch(n){case"current":case"not-current":{const t=await ku(r.localStore),s=So.createSynthesizedRemoteEventForCurrentChange(e,"current"===n);await Nl(r,t,s);break}case"rejected":await Cu(r.localStore,e,!0),Tl(r,e,s);break;default:Cs()}}async function Fl(t,e,n){const s=Vl(t);if(s.Lc){for(const t of e){if(s.Nc.has(t)){Ss("SyncEngine","Adding an already active target "+t);continue}const e=await xu(s.localStore,t),n=await Nu(s.localStore,e);await fl(s,Ll(e),n.targetId,!1),yh(s.remoteStore,n)}for(const t of n)s.Nc.has(t)&&await Cu(s.localStore,t,!1).then((()=>{wh(s.remoteStore,t),Tl(s,t)})).catch(Yc)}}function Vl(t){const e=ks(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=gl.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Dl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=yl.bind(null,e),e.Dc.To=Jh.bind(null,e.eventManager),e.Dc.qc=Zh.bind(null,e.eventManager),e}function Ul(t){const e=ks(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=wl.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=vl.bind(null,e),e}class ql{constructor(){this.synchronizeTabs=!1}async initialize(t){this.O=ah(t.databaseInfo.databaseId),this.sharedClientState=this.Gc(t),this.persistence=this.jc(t),await this.persistence.start(),this.gcScheduler=this.Qc(t),this.localStore=this.Wc(t)}Qc(t){return null}Wc(t){return Tu(this.persistence,new bu,t.initialUser,this.O)}jc(t){return new Bu(Ku.bi,this.O)}Gc(t){return new Zu}async terminate(){this.gcScheduler&&this.gcScheduler.stop(),await this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Bl extends ql{constructor(t,e,n){super(),this.zc=t,this.cacheSizeBytes=e,this.forceOwnership=n,this.synchronizeTabs=!1}async initialize(t){await super.initialize(t),await async function(t){const e=ks(t);return e.persistence.runTransaction("Synchronize last document change read time","readonly",(t=>function(t){const e=cu(t);let n=Xs.min();return e.Qt({index:Ia.readTimeIndex,reverse:!0},((t,e,s)=>{e.readTime&&(n=ic(e.readTime)),s.done()})).next((()=>n))}(t))).then((t=>{e.Fs=t}))}(this.localStore),await this.zc.initialize(this,t),await Ul(this.zc.syncEngine),await xh(this.zc.remoteStore),await this.persistence.Hn((()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(this.localStore),Promise.resolve())))}Wc(t){return Tu(this.persistence,new bu,t.initialUser,this.O)}Qc(t){const e=this.persistence.referenceDelegate.garbageCollector;return new Zc(e,t.asyncQueue)}jc(t){const e=pu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?Fc.withCacheSize(this.cacheSizeBytes):Fc.DEFAULT;return new fu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,ih(),oh(),this.O,this.sharedClientState,!!this.forceOwnership)}Gc(t){return new Zu}}class jl extends Bl{constructor(t,e){super(t,e,!1),this.zc=t,this.cacheSizeBytes=e,this.synchronizeTabs=!0}async initialize(t){await super.initialize(t);const e=this.zc.syncEngine;this.sharedClientState instanceof Ju&&(this.sharedClientState.syncEngine={hr:Ol.bind(null,e),lr:Pl.bind(null,e),dr:Fl.bind(null,e),ds:Ml.bind(null,e),ar:kl.bind(null,e)},await this.sharedClientState.start()),await this.persistence.Hn((async t=>{await async function(t,e){const n=ks(t);if(Vl(n),Ul(n),!0===e&&!0!==n.Lc){const t=n.sharedClientState.getAllActiveQueryTargets(),e=await Rl(n,t.toArray());n.Lc=!0,await qh(n.remoteStore,!0);for(const t of e)yh(n.remoteStore,t)}else if(!1===e&&!1!==n.Lc){const t=[];let e=Promise.resolve();n.Nc.forEach(((s,r)=>{n.sharedClientState.isLocalQueryTarget(r)?t.push(r):e=e.then((()=>(Tl(n,r),Cu(n.localStore,r,!0)))),wh(n.remoteStore,r)})),await e,await Rl(n,t),function(t){const e=ks(t);e.Oc.forEach(((t,n)=>{wh(e.remoteStore,n)})),e.Mc.ii(),e.Oc=new Map,e.kc=new co(br.comparator)}(n),n.Lc=!1,await qh(n.remoteStore,!1)}}(this.zc.syncEngine,t),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop())}))}Gc(t){const e=ih();if(!Ju.Vt(e))throw new Rs(Os.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const n=pu(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Ju(e,t.asyncQueue,n,t.clientId,t.initialUser)}}class Kl{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>pl(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Cl.bind(null,this.syncEngine),await qh(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Wh}createDatastore(t){const e=ah(t.databaseInfo.databaseId),n=(s=t.databaseInfo,new rh(s));var s;return function(t,e,n,s){return new dh(t,e,n,s)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return e=this.localStore,n=this.datastore,s=t.asyncQueue,r=t=>pl(this.syncEngine,t,0),i=eh.Vt()?new eh:new th,new mh(e,n,s,r,i);var e,n,s,r,i}createSyncEngine(t,e){return function(t,e,n,s,r,i,o){const a=new ll(t,e,n,s,r,i);return o&&(a.Lc=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}terminate(){return async function(t){const e=ks(t);Ss("RemoteStore","RemoteStore shutting down."),e.Ko.add(5),await ph(e),e.jo.shutdown(),e.Qo.set("Unknown")}(this.remoteStore)}}function $l(t,e=10240){let n=0;return{async read(){if(n<t.byteLength){const s={value:t.slice(n,n+e),done:!1};return n+=e,s}return{done:!0}},async cancel(){},releaseLock(){},closed:Promise.reject("unimplemented")}}class Gl{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Hc(this.observer.next,t)}error(t){this.observer.error?this.Hc(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)}Jc(){this.muted=!0}Hc(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class zl{constructor(t,e){this.Yc=t,this.O=e,this.metadata=new Ls,this.buffer=new Uint8Array,this.Xc=new TextDecoder("utf-8"),this.Zc().then((t=>{t&&t.ac()?this.metadata.resolve(t.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==t?void 0:t.payload)}`))}),(t=>this.metadata.reject(t)))}close(){return this.Yc.cancel()}async getMetadata(){return this.metadata.promise}async Kc(){return await this.getMetadata(),this.Zc()}async Zc(){const t=await this.tu();if(null===t)return null;const e=this.Xc.decode(t),n=Number(e);isNaN(n)&&this.eu(`length string (${e}) is not valid number`);const s=await this.nu(n);return new nl(JSON.parse(s),t.length+n)}su(){return this.buffer.findIndex((t=>t==="{".charCodeAt(0)))}async tu(){for(;this.su()<0&&!await this.iu(););if(0===this.buffer.length)return null;const t=this.su();t<0&&this.eu("Reached the end of bundle when a length string is expected.");const e=this.buffer.slice(0,t);return this.buffer=this.buffer.slice(t),e}async nu(t){for(;this.buffer.length<t;)await this.iu()&&this.eu("Reached the end of bundle when more is expected.");const e=this.Xc.decode(this.buffer.slice(0,t));return this.buffer=this.buffer.slice(t),e}eu(t){throw this.Yc.cancel(),new Error(`Invalid bundle format: ${t}`)}async iu(){const t=await this.Yc.read();if(!t.done){const e=new Uint8Array(this.buffer.length+t.value.length);e.set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e}return t.done}}class Hl{constructor(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}async lookup(t){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Rs(Os.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const e=await async function(t,e){const n=ks(t),s=zo(n.O)+"/documents",r={documents:e.map((t=>jo(n.O,t)))},i=await n.Lr("BatchGetDocuments",s,r),o=new Map;i.forEach((t=>{const e=function(t,e){return"found"in e?function(t,e){Ds(!!e.found),e.found.name,e.found.updateTime;const n=Ko(t,e.found.name),s=Uo(e.found.updateTime),r=new Pr({mapValue:{fields:e.found.fields}});return Vr.newFoundDocument(n,s,r)}(t,e):"missing"in e?function(t,e){Ds(!!e.missing),Ds(!!e.readTime);const n=Ko(t,e.missing),s=Uo(e.readTime);return Vr.newNoDocument(n,s)}(t,e):Cs()}(n.O,t);o.set(e.key.toString(),e)}));const a=[];return e.forEach((t=>{const e=o.get(t.toString());Ds(!!e),a.push(e)})),a}(this.datastore,t);return e.forEach((t=>this.recordVersion(t))),e}set(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())}update(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())}delete(t){this.write(new eo(t,this.precondition(t))),this.writtenDocs.add(t.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;const t=this.readVersions;this.mutations.forEach((e=>{t.delete(e.key.toString())})),t.forEach(((t,e)=>{const n=br.fromPath(e);this.mutations.push(new no(n,this.precondition(n)))})),await async function(t,e){const n=ks(t),s=zo(n.O)+"/documents",r={writes:e.map((t=>Yo(n.O,t)))};await n.Mr("Commit",s,r)}(this.datastore,this.mutations),this.committed=!0}recordVersion(t){let e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Cs();e=Xs.min()}const n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Rs(Os.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)}precondition(t){const e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ji.updateTime(e):ji.none()}preconditionForUpdate(t){const e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Xs.min()))throw new Rs(Os.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ji.updateTime(e)}return ji.exists(!0)}write(t){this.ensureCommitNotCalled(),this.mutations.push(t)}ensureCommitNotCalled(){}}class Ql{constructor(t,e,n,s){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=s,this.ru=5,this.ro=new ch(this.asyncQueue,"transaction_retry")}run(){this.ru-=1,this.ou()}ou(){this.ro.Hr((async()=>{const t=new Hl(this.datastore),e=this.cu(t);e&&e.then((e=>{this.asyncQueue.enqueueAndForget((()=>t.commit().then((()=>{this.deferred.resolve(e)})).catch((t=>{this.uu(t)}))))})).catch((t=>{this.uu(t)}))}))}cu(t){try{const e=this.updateFunction(t);return!yr(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}uu(t){this.ru>0&&this.au(t)?(this.ru-=1,this.asyncQueue.enqueueAndForget((()=>(this.ou(),Promise.resolve())))):this.deferred.reject(t)}au(t){if("FirebaseError"===t.name){const e=t.code;return"aborted"===e||"failed-precondition"===e||!oo(e)}return!1}}class Wl{constructor(t,e,n,s){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=s,this.user=vs.UNAUTHENTICATED,this.clientId=zs.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{Ss("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(Ss("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}async getConfiguration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Rs(Os.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Ls;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this.onlineComponents&&await this.onlineComponents.terminate(),this.offlineComponents&&await this.offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=$h(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Yl(t,e){t.asyncQueue.verifyOperationInProgress(),Ss("FirestoreClient","Initializing OfflineComponentProvider");const n=await t.getConfiguration();await e.initialize(n);let s=n.initialUser;t.setCredentialChangeListener((async t=>{s.isEqual(t)||(await Eu(e.localStore,t),s=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t.offlineComponents=e}async function Xl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await Jl(t);Ss("FirestoreClient","Initializing OnlineComponentProvider");const s=await t.getConfiguration();await e.initialize(n,s),t.setCredentialChangeListener((t=>Uh(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Uh(e.remoteStore,n))),t.onlineComponents=e}async function Jl(t){return t.offlineComponents||(Ss("FirestoreClient","Using default OfflineComponentProvider"),await Yl(t,new ql)),t.offlineComponents}async function Zl(t){return t.onlineComponents||(Ss("FirestoreClient","Using default OnlineComponentProvider"),await Xl(t,new Kl)),t.onlineComponents}function td(t){return Jl(t).then((t=>t.persistence))}function ed(t){return Jl(t).then((t=>t.localStore))}function nd(t){return Zl(t).then((t=>t.remoteStore))}function sd(t){return Zl(t).then((t=>t.syncEngine))}async function rd(t){const e=await Zl(t),n=e.eventManager;return n.onListen=dl.bind(null,e.syncEngine),n.onUnlisten=ml.bind(null,e.syncEngine),n}function id(t,e,n={}){const s=new Ls;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,r){const i=new Gl({next:i=>{e.enqueueAndForget((()=>Xh(t,o)));const a=i.docs.has(n);!a&&i.fromCache?r.reject(new Rs(Os.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&s&&"server"===s.source?r.reject(new Rs(Os.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(i)},error:t=>r.reject(t)}),o=new el(hi(n.path),i,{includeMetadataChanges:!0,uc:!0});return Yh(t,o)}(await rd(t),t.asyncQueue,e,n,s))),s.promise}function od(t,e,n={}){const s=new Ls;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,s,r){const i=new Gl({next:n=>{e.enqueueAndForget((()=>Xh(t,o))),n.fromCache&&"server"===s.source?r.reject(new Rs(Os.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(n)},error:t=>r.reject(t)}),o=new el(n,i,{includeMetadataChanges:!0,uc:!0});return Yh(t,o)}(await rd(t),t.asyncQueue,e,n,s))),s.promise}const ad=new Map;function cd(t,e,n){if(!n)throw new Rs(Os.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function ud(t,e,n,s){if(!0===e&&!0===s)throw new Rs(Os.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function hd(t){if(!br.isDocumentKey(t))throw new Rs(Os.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function ld(t){if(br.isDocumentKey(t))throw new Rs(Os.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function dd(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Cs()}function fd(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Rs(Os.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=dd(t);throw new Rs(Os.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function md(t,e){if(e<=0)throw new Rs(Os.INVALID_ARGUMENT,`Function ${t}() requires a positive number, but it was: ${e}.`)}class gd{constructor(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Rs(Os.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Rs(Os.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,ud("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class pd{constructor(t,e,n){this._authCredentials=e,this._appCheckCredentials=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gd({}),this._settingsFrozen=!1,t instanceof pr?this._databaseId=t:(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Rs(Os.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pr(t.options.projectId)}(t))}get app(){if(!this._app)throw new Rs(Os.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Rs(Os.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gd(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Ps;switch(t.type){case"gapi":const e=t.client;return Ds(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new qs(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Rs(Os.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=ad.get(t);e&&(Ss("ComponentProvider","Removing Datastore"),ad.delete(t),e.terminate())}(this),Promise.resolve()}}function yd(t,e,n,s={}){var r;const i=(t=fd(t,pd))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&_s("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:`${e}:${n}`,ssl:!1})),s.mockUserToken){let e,n;if("string"==typeof s.mockUserToken)e=s.mockUserToken,n=vs.MOCK_USER;else{e=(0,a.Sg)(s.mockUserToken,null===(r=t._app)||void 0===r?void 0:r.options.projectId);const i=s.mockUserToken.sub||s.mockUserToken.user_id;if(!i)throw new Rs(Os.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new vs(i)}t._authCredentials=new Fs(new Ms(e,n))}}class wd{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bd(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new wd(this.firestore,t,this._key)}}class vd{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new vd(this.firestore,t,this._query)}}class bd extends vd{constructor(t,e,n){super(t,e,hi(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new wd(this.firestore,null,new br(t))}withConverter(t){return new bd(this.firestore,t,this._path)}}function Id(t,e,...n){if(t=(0,a.m9)(t),cd("collection","path",e),t instanceof pd){const s=nr.fromString(e,...n);return ld(s),new bd(t,null,s)}{if(!(t instanceof wd||t instanceof bd))throw new Rs(Os.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(nr.fromString(e,...n));return ld(s),new bd(t.firestore,null,s)}}function Td(t,e){if(t=fd(t,pd),cd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Rs(Os.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new vd(t,null,function(t){return new ci(nr.emptyPath(),t)}(e))}function Ed(t,e,...n){if(t=(0,a.m9)(t),1===arguments.length&&(e=zs.R()),cd("doc","path",e),t instanceof pd){const s=nr.fromString(e,...n);return hd(s),new wd(t,null,new br(s))}{if(!(t instanceof wd||t instanceof bd))throw new Rs(Os.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const s=t._path.child(nr.fromString(e,...n));return hd(s),new wd(t.firestore,t instanceof bd?t.converter:null,new br(s))}}function Sd(t,e){return t=(0,a.m9)(t),e=(0,a.m9)(e),(t instanceof wd||t instanceof bd)&&(e instanceof wd||e instanceof bd)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function Ad(t,e){return t=(0,a.m9)(t),e=(0,a.m9)(e),t instanceof vd&&e instanceof vd&&t.firestore===e.firestore&&vi(t._query,e._query)&&t.converter===e.converter}class _d{constructor(){this.hu=Promise.resolve(),this.lu=[],this.fu=!1,this.du=[],this._u=null,this.wu=!1,this.mu=!1,this.gu=[],this.ro=new ch(this,"async_queue_retry"),this.yu=()=>{const t=oh();t&&Ss("AsyncQueue","Visibility state changed to "+t.visibilityState),this.ro.Yr()};const t=oh();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.yu)}get isShuttingDown(){return this.fu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.pu(),this.Iu(t)}enterRestrictedMode(t){if(!this.fu){this.fu=!0,this.mu=t||!1;const e=oh();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.yu)}}enqueue(t){if(this.pu(),this.fu)return new Promise((()=>{}));const e=new Ls;return this.Iu((()=>this.fu&&this.mu?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.lu.push(t),this.Eu())))}async Eu(){if(0!==this.lu.length){try{await this.lu[0](),this.lu.shift(),this.ro.reset()}catch(t){if(!$a(t))throw t;Ss("AsyncQueue","Operation failed with retryable error: "+t)}this.lu.length>0&&this.ro.Hr((()=>this.Eu()))}}Iu(t){const e=this.hu.then((()=>(this.wu=!0,t().catch((t=>{this._u=t,this.wu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw As("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.wu=!1,t))))));return this.hu=e,e}enqueueAfterDelay(t,e,n){this.pu(),this.gu.indexOf(t)>-1&&(e=0);const s=Kh.createAndSchedule(this,t,e,n,(t=>this.Tu(t)));return this.du.push(s),s}pu(){this._u&&Cs()}verifyOperationInProgress(){}async Au(){let t;do{t=this.hu,await t}while(t!==this.hu)}Ru(t){for(const e of this.du)if(e.timerId===t)return!0;return!1}Pu(t){return this.Au().then((()=>{this.du.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.du)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.Au()}))}bu(t){this.gu.push(t)}Tu(t){const e=this.du.indexOf(t);this.du.splice(e,1)}}function Nd(t){return function(t,e){if("object"!=typeof t||null===t)return!1;const n=t;for(const t of["next","error","complete"])if(t in n&&"function"==typeof n[t])return!0;return!1}(t)}class Cd{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ls,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(t,e,n){this._progressObserver={next:t,error:e,complete:n}}catch(t){return this._taskCompletionResolver.promise.catch(t)}then(t,e){return this._taskCompletionResolver.promise.then(t,e)}_completeWith(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)}_failWith(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)}_updateProgress(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}const Dd=-1;class xd extends pd{constructor(t,e,n){super(t,e,n),this.type="firestore",this._queue=new _d,this._persistenceKey="name"in t?t.name:"[DEFAULT]"}_terminate(){return this._firestoreClient||Ld(this),this._firestoreClient.terminate()}}function kd(t,e){const n=(0,r.qX)(t,"firestore");if(n.isInitialized()){const t=n.getImmediate(),s=n.getOptions();if((0,a.vZ)(s,e))return t;throw new Rs(Os.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==e.cacheSizeBytes&&-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new Rs(Os.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:e})}function Od(t=(0,r.Mq)()){return(0,r.qX)(t,"firestore").getImmediate()}function Rd(t){return t._firestoreClient||Ld(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function Ld(t){var e;const n=t._freezeSettings(),s=function(t,e,n,s){return new gr(t,e,n,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,s.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Wl(t._authCredentials,t._appCheckCredentials,t._queue,s)}function Md(t,e){Gd(t=fd(t,xd));const n=Rd(t),s=t._freezeSettings(),r=new Kl;return Fd(n,r,new Bl(r,s.cacheSizeBytes,null==e?void 0:e.forceOwnership))}function Pd(t){Gd(t=fd(t,xd));const e=Rd(t),n=t._freezeSettings(),s=new Kl;return Fd(e,s,new jl(s,n.cacheSizeBytes))}function Fd(t,e,n){const s=new Ls;return t.asyncQueue.enqueue((async()=>{try{await Yl(t,n),await Xl(t,e),s.resolve()}catch(t){if(!function(t){return"FirebaseError"===t.name?t.code===Os.FAILED_PRECONDITION||t.code===Os.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(t))throw t;console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),s.reject(t)}})).then((()=>s.promise))}function Vd(t){if(t._initialized&&!t._terminated)throw new Rs(Os.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ls;return t._queue.enqueueAndForgetEvenWhileRestricted((async()=>{try{await async function(t){if(!Ba.Vt())return Promise.resolve();const e=t+"main";await Ba.delete(e)}(pu(t._databaseId,t._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function Ud(t){return function(t){const e=new Ls;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e){const n=ks(t);Eh(n.remoteStore)||Ss("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const t=await function(t){const e=ks(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(t=>e.gs.getHighestUnacknowledgedBatchId(t)))}(n.localStore);if(-1===t)return void e.resolve();const s=n.Fc.get(t)||[];s.push(e),n.Fc.set(t,s)}catch(t){const n=$h(t,"Initialization of waitForPendingWrites() operation failed");e.reject(n)}}(await sd(t),e))),e.promise}(Rd(t=fd(t,xd)))}function qd(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await td(t),n=await nd(t);return e.setNetworkEnabled(!0),function(t){const e=ks(t);return e.Ko.delete(0),gh(e)}(n)}))}(Rd(t=fd(t,xd)))}function Bd(t){return function(t){return t.asyncQueue.enqueue((async()=>{const e=await td(t),n=await nd(t);return e.setNetworkEnabled(!1),async function(t){const e=ks(t);e.Ko.add(0),await ph(e),e.Qo.set("Offline")}(n)}))}(Rd(t=fd(t,xd)))}function jd(t){return(0,r.wN)(t.app,"firestore"),t._delete()}function Kd(t,e){const n=Rd(t=fd(t,xd)),s=new Cd;return function(t,e,n,s){const r=function(t,e){let n;return n="string"==typeof t?(new TextEncoder).encode(t):t,function(t,e){return new zl(t,e)}(function(t,e){if(t instanceof Uint8Array)return $l(t,e);if(t instanceof ArrayBuffer)return $l(new Uint8Array(t),e);if(t instanceof ReadableStream)return t.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(n),e)}(n,ah(e));t.asyncQueue.enqueueAndForget((async()=>{!function(t,e,n){const s=ks(t);(async function(t,e,n){try{const s=await e.getMetadata();if(await function(t,e){const n=ks(t),s=Uo(e.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(t=>n.Kn.getBundleMetadata(t,e.id))).then((t=>!!t&&t.createTime.compareTo(s)>=0))}(t.localStore,s))return await e.close(),void n._completeWith(function(t){return{taskState:"Success",documentsLoaded:t.totalDocuments,bytesLoaded:t.totalBytes,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(s));n._updateProgress(il(s));const r=new rl(s,t.localStore,e.O);let i=await e.Kc();for(;i;){const t=await r.lc(i);t&&n._updateProgress(t),i=await e.Kc()}const o=await r.complete();await Nl(t,o.ws,void 0),await function(t,e){const n=ks(t);return n.persistence.runTransaction("Save bundle","readwrite",(t=>n.Kn.saveBundleMetadata(t,e)))}(t.localStore,s),n._completeWith(o.progress)}catch(t){_s("SyncEngine",`Loading bundle failed with ${t}`),n._failWith(t)}})(s,e,n).then((()=>{s.sharedClientState.notifyBundleLoaded()}))}(await sd(t),r,s)}))}(n,t._databaseId,e,s),s}function $d(t,e){return function(t,e){return t.asyncQueue.enqueue((async()=>function(t,e){const n=ks(t);return n.persistence.runTransaction("Get named query","readonly",(t=>n.Kn.getNamedQuery(t,e)))}(await ed(t),e)))}(Rd(t=fd(t,xd)),e).then((e=>e?new vd(t,null,e.query):null))}function Gd(t){if(t._initialized||t._terminated)throw new Rs(Os.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class zd{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Rs(Os.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new rr(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}function Hd(){return new zd("__name__")}class Qd{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Qd(ar.fromBase64String(t))}catch(t){throw new Rs(Os.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Qd(ar.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Wd{constructor(t){this._methodName=t}}class Yd{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Rs(Os.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Rs(Os.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Hs(this._lat,t._lat)||Hs(this._long,t._long)}}const Xd=/^__.*__$/;class Jd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Xi(t,this.data,this.fieldMask,e,this.fieldTransforms):new Yi(t,this.data,e,this.fieldTransforms)}}class Zd{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new Xi(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function tf(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Cs()}}class ef{constructor(t,e,n,s,r,i){this.settings=t,this.databaseId=e,this.O=n,this.ignoreUndefinedProperties=s,void 0===r&&this.vu(),this.fieldTransforms=r||[],this.fieldMask=i||[]}get path(){return this.settings.path}get Vu(){return this.settings.Vu}Su(t){return new ef(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.O,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Du(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Su({path:n,Cu:!1});return s.Nu(t),s}xu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),s=this.Su({path:n,Cu:!1});return s.vu(),s}ku(t){return this.Su({path:void 0,Cu:!0})}Ou(t){return Tf(t,this.settings.methodName,this.settings.Mu||!1,this.path,this.settings.$u)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}vu(){if(this.path)for(let t=0;t<this.path.length;t++)this.Nu(this.path.get(t))}Nu(t){if(0===t.length)throw this.Ou("Document fields must not be empty");if(tf(this.Vu)&&Xd.test(t))throw this.Ou('Document fields cannot begin and end with "__"')}}class nf{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.O=n||ah(t)}Fu(t,e,n,s=!1){return new ef({Vu:t,methodName:e,$u:n,path:rr.emptyPath(),Cu:!1,Mu:s},this.databaseId,this.O,this.ignoreUndefinedProperties)}}function sf(t){const e=t._freezeSettings(),n=ah(t._databaseId);return new nf(t._databaseId,!!e.ignoreUndefinedProperties,n)}function rf(t,e,n,s,r,i={}){const o=t.Fu(i.merge||i.mergeFields?2:0,e,n,r);wf("Data must be an object, but it was:",o,s);const a=pf(s,o);let c,u;if(i.merge)c=new ir(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){const t=[];for(const s of i.mergeFields){const r=vf(e,s,n);if(!o.contains(r))throw new Rs(Os.INVALID_ARGUMENT,`Field '${r}' is specified in your field mask but missing from your input data.`);Ef(t,r)||t.push(r)}c=new ir(t),u=o.fieldTransforms.filter((t=>c.covers(t.field)))}else c=null,u=o.fieldTransforms;return new Jd(new Pr(a),c,u)}class of extends Wd{_toFieldTransform(t){if(2!==t.Vu)throw 1===t.Vu?t.Ou(`${this._methodName}() can only appear at the top level of your update data`):t.Ou(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof of}}function af(t,e,n){return new ef({Vu:3,$u:e.settings.$u,methodName:t._methodName,Cu:n},e.databaseId,e.O,e.ignoreUndefinedProperties)}class cf extends Wd{_toFieldTransform(t){return new qi(t.path,new Oi)}isEqual(t){return t instanceof cf}}class uf extends Wd{constructor(t,e){super(t),this.Bu=e}_toFieldTransform(t){const e=af(this,t,!0),n=this.Bu.map((t=>gf(t,e))),s=new Ri(n);return new qi(t.path,s)}isEqual(t){return this===t}}class hf extends Wd{constructor(t,e){super(t),this.Bu=e}_toFieldTransform(t){const e=af(this,t,!0),n=this.Bu.map((t=>gf(t,e))),s=new Mi(n);return new qi(t.path,s)}isEqual(t){return this===t}}class lf extends Wd{constructor(t,e){super(t),this.Lu=e}_toFieldTransform(t){const e=new Fi(t.O,Ni(t.O,this.Lu));return new qi(t.path,e)}isEqual(t){return this===t}}function df(t,e,n,s){const r=t.Fu(1,e,n);wf("Data must be an object, but it was:",r,s);const i=[],o=Pr.empty();Zs(s,((t,s)=>{const c=If(e,t,n);s=(0,a.m9)(s);const u=r.xu(c);if(s instanceof of)i.push(c);else{const t=gf(s,u);null!=t&&(i.push(c),o.set(c,t))}}));const c=new ir(i);return new Zd(o,c,r.fieldTransforms)}function ff(t,e,n,s,r,i){const o=t.Fu(1,e,n),c=[vf(e,s,n)],u=[r];if(i.length%2!=0)throw new Rs(Os.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<i.length;t+=2)c.push(vf(e,i[t])),u.push(i[t+1]);const h=[],l=Pr.empty();for(let t=c.length-1;t>=0;--t)if(!Ef(h,c[t])){const e=c[t];let n=u[t];n=(0,a.m9)(n);const s=o.xu(e);if(n instanceof of)h.push(e);else{const t=gf(n,s);null!=t&&(h.push(e),l.set(e,t))}}const d=new ir(h);return new Zd(l,d,o.fieldTransforms)}function mf(t,e,n,s=!1){return gf(n,t.Fu(s?4:3,e))}function gf(t,e){if(yf(t=(0,a.m9)(t)))return wf("Unsupported field value:",e,t),pf(t,e);if(t instanceof Wd)return function(t,e){if(!tf(e.Vu))throw e.Ou(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.Ou(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Cu&&4!==e.Vu)throw e.Ou("Nested arrays are not supported");return function(t,e){const n=[];let s=0;for(const r of t){let t=gf(r,e.ku(s));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),s++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=(0,a.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Ni(e.O,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ys.fromDate(t);return{timestampValue:Po(e.O,n)}}if(t instanceof Ys){const n=new Ys(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Po(e.O,n)}}if(t instanceof Yd)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Qd)return{bytesValue:Fo(e.O,t._byteString)};if(t instanceof wd){const n=e.databaseId,s=t.firestore._databaseId;if(!s.isEqual(n))throw e.Ou(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:qo(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Ou(`Unsupported field value: ${dd(t)}`)}(t,e)}function pf(t,e){const n={};return tr(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Zs(t,((t,s)=>{const r=gf(s,e.Du(t));null!=r&&(n[t]=r)})),{mapValue:{fields:n}}}function yf(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ys||t instanceof Yd||t instanceof Qd||t instanceof wd||t instanceof Wd)}function wf(t,e,n){if(!yf(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const s=dd(n);throw"an object"===s?e.Ou(t+" a custom object"):e.Ou(t+" "+s)}}function vf(t,e,n){if((e=(0,a.m9)(e))instanceof zd)return e._internalPath;if("string"==typeof e)return If(t,e);throw Tf("Field path arguments must be of type string or ",t,!1,void 0,n)}const bf=new RegExp("[~\\*/\\[\\]]");function If(t,e,n){if(e.search(bf)>=0)throw Tf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new zd(...e.split("."))._internalPath}catch(s){throw Tf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Tf(t,e,n,s,r){const i=s&&!s.isEmpty(),o=void 0!==r;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(i||o)&&(c+=" (found",i&&(c+=` in field ${s}`),o&&(c+=` in document ${r}`),c+=")"),new Rs(Os.INVALID_ARGUMENT,a+t+c)}function Ef(t,e){return t.some((t=>t.isEqual(e)))}class Sf{constructor(t,e,n,s,r){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new wd(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Af(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(_f("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Af extends Sf{data(){return super.data()}}function _f(t,e){return"string"==typeof e?If(t,e):e instanceof zd?e._internalPath:e._delegate._internalPath}class Nf{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Cf extends Sf{constructor(t,e,n,s,r,i){super(t,e,n,s,i),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Df(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(_f("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Df extends Cf{data(t={}){return super.data(t)}}class xf{constructor(t,e,n,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Nf(s.hasPendingWrites,s.fromCache),this.query=n}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach((n=>{t.call(e,new Df(this._firestore,this._userDataWriter,n.key,n,new Nf(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Rs(Os.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map((n=>({type:"added",doc:new Df(t._firestore,t._userDataWriter,n.doc.key,n.doc,new Nf(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:e++})))}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter((t=>e||3!==t.type)).map((e=>{const s=new Df(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Nf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let r=-1,i=-1;return 0!==e.type&&(r=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),i=n.indexOf(e.doc.key)),{type:kf(e.type),doc:s,oldIndex:r,newIndex:i}}))}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function kf(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Cs()}}function Of(t,e){return t instanceof Cf&&e instanceof Cf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof xf&&e instanceof xf&&t._firestore===e._firestore&&Ad(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Rf(t){if(di(t)&&0===t.explicitOrderBy.length)throw new Rs(Os.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Lf{}function Mf(t,...e){for(const n of e)t=n._apply(t);return t}class Pf extends Lf{constructor(t,e,n){super(),this.Uu=t,this.qu=e,this.Ku=n,this.type="where"}_apply(t){const e=sf(t.firestore),n=function(t,e,n,s,r,i,o){let a;if(r.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Rs(Os.INVALID_ARGUMENT,`Invalid Query. You can't perform '${i}' queries on documentId().`);if("in"===i||"not-in"===i){Xf(o,i);const e=[];for(const n of o)e.push(Yf(s,t,n));a={arrayValue:{values:e}}}else a=Yf(s,t,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||Xf(o,i),a=mf(n,"where",o,"in"===i||"not-in"===i);const c=Qr.create(r,i,a);return function(t,e){if(e.S()){const n=mi(t);if(null!==n&&!n.isEqual(e.field))throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${n.toString()}' and '${e.field.toString()}'`);const s=fi(t);null!==s&&Jf(0,e.field,s)}const n=function(t,e){for(const n of t.filters)if(e.indexOf(n.op)>=0)return n.op;return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==n)throw n===e.op?new Rs(Os.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Rs(Os.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}(t,c),c}(t._query,0,e,t.firestore._databaseId,this.Uu,this.qu,this.Ku);return new vd(t.firestore,t.converter,function(t,e){const n=t.filters.concat([e]);return new ci(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))}}function Ff(t,e,n){const s=e,r=_f("where",t);return new Pf(r,s,n)}class Vf extends Lf{constructor(t,e){super(),this.Uu=t,this.Gu=e,this.type="orderBy"}_apply(t){const e=function(t,e,n){if(null!==t.startAt)throw new Rs(Os.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Rs(Os.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const s=new ri(e,n);return function(t,e){if(null===fi(t)){const n=mi(t);null!==n&&Jf(0,n,e.field)}}(t,s),s}(t._query,this.Uu,this.Gu);return new vd(t.firestore,t.converter,function(t,e){const n=t.explicitOrderBy.concat([e]);return new ci(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))}}function Uf(t,e="asc"){const n=e,s=_f("orderBy",t);return new Vf(s,n)}class qf extends Lf{constructor(t,e,n){super(),this.type=t,this.ju=e,this.Qu=n}_apply(t){return new vd(t.firestore,t.converter,wi(t._query,this.ju,this.Qu))}}function Bf(t){return md("limit",t),new qf("limit",t,"F")}function jf(t){return md("limitToLast",t),new qf("limitToLast",t,"L")}class Kf extends Lf{constructor(t,e,n){super(),this.type=t,this.Wu=e,this.zu=n}_apply(t){const e=Wf(t,this.type,this.Wu,this.zu);return new vd(t.firestore,t.converter,function(t,e){return new ci(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))}}function $f(...t){return new Kf("startAt",t,!0)}function Gf(...t){return new Kf("startAfter",t,!1)}class zf extends Lf{constructor(t,e,n){super(),this.type=t,this.Wu=e,this.zu=n}_apply(t){const e=Wf(t,this.type,this.Wu,this.zu);return new vd(t.firestore,t.converter,function(t,e){return new ci(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))}}function Hf(...t){return new zf("endBefore",t,!1)}function Qf(...t){return new zf("endAt",t,!0)}function Wf(t,e,n,s){if(n[0]=(0,a.m9)(n[0]),n[0]instanceof Sf)return function(t,e,n,s,r){if(!s)throw new Rs(Os.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${n}().`);const i=[];for(const n of pi(t))if(n.field.isKeyField())i.push(Dr(e,s.key));else{const t=s.data.field(n.field);if(dr(t))throw new Rs(Os.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+n.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===t){const t=n.field.canonicalString();throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${t}' (used as the orderBy) does not exist.`)}i.push(t)}return new si(i,r)}(t._query,t.firestore._databaseId,e,n[0]._document,s);{const r=sf(t.firestore);return function(t,e,n,s,r,i){const o=t.explicitOrderBy;if(r.length>o.length)throw new Rs(Os.INVALID_ARGUMENT,`Too many arguments provided to ${s}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const a=[];for(let i=0;i<r.length;i++){const c=r[i];if(o[i].field.isKeyField()){if("string"!=typeof c)throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${s}(), but got a ${typeof c}`);if(!gi(t)&&-1!==c.indexOf("/"))throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${s}() must be a plain document ID, but '${c}' contains a slash.`);const n=t.path.child(nr.fromString(c));if(!br.isDocumentKey(n))throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${s}() must result in a valid document path, but '${n}' is not because it contains an odd number of segments.`);const r=new br(n);a.push(Dr(e,r))}else{const t=mf(n,s,c);a.push(t)}}return new si(a,i)}(t._query,t.firestore._databaseId,r,e,n,s)}}function Yf(t,e,n){if("string"==typeof(n=(0,a.m9)(n))){if(""===n)throw new Rs(Os.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!gi(e)&&-1!==n.indexOf("/"))throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const s=e.path.child(nr.fromString(n));if(!br.isDocumentKey(s))throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${s}' is not because it has an odd number of segments (${s.length}).`);return Dr(t,new br(s))}if(n instanceof wd)return Dr(t,n._key);throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${dd(n)}.`)}function Xf(t,e){if(!Array.isArray(t)||0===t.length)throw new Rs(Os.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(t.length>10)throw new Rs(Os.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Jf(t,e,n){if(!n.isEqual(e))throw new Rs(Os.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${n.toString()}' instead.`)}class Zf{convertValue(t,e="none"){switch(Tr(t)){case 0:return null;case 1:return t.booleanValue;case 2:return hr(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(lr(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Cs()}}convertObject(t,e){const n={};return Zs(t.fields,((t,s)=>{n[t]=this.convertValue(s,e)})),n}convertGeoPoint(t){return new Yd(hr(t.latitude),hr(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=fr(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(mr(t));default:return null}}convertTimestamp(t){const e=ur(t);return new Ys(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=nr.fromString(t);Ds(ua(n));const s=new pr(n.get(1),n.get(3)),r=new br(n.popFirst(5));return s.isEqual(e)||As(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}function tm(t,e,n){let s;return s=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,s}class em extends Zf{constructor(t){super(),this.firestore=t}convertBytes(t){return new Qd(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new wd(this.firestore,null,e)}}class nm{constructor(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=sf(t)}set(t,e,n){this._verifyNotCommitted();const s=sm(t,this._firestore),r=tm(s.converter,e,n),i=rf(this._dataReader,"WriteBatch.set",s._key,r,null!==s.converter,n);return this._mutations.push(i.toMutation(s._key,ji.none())),this}update(t,e,n,...s){this._verifyNotCommitted();const r=sm(t,this._firestore);let i;return i="string"==typeof(e=(0,a.m9)(e))||e instanceof zd?ff(this._dataReader,"WriteBatch.update",r._key,e,n,s):df(this._dataReader,"WriteBatch.update",r._key,e),this._mutations.push(i.toMutation(r._key,ji.exists(!0))),this}delete(t){this._verifyNotCommitted();const e=sm(t,this._firestore);return this._mutations=this._mutations.concat(new eo(e._key,ji.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Rs(Os.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function sm(t,e){if((t=(0,a.m9)(t)).firestore!==e)throw new Rs(Os.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function rm(t){t=fd(t,wd);const e=fd(t.firestore,xd);return id(Rd(e),t._key).then((n=>wm(e,t,n)))}class im extends Zf{constructor(t){super(),this.firestore=t}convertBytes(t){return new Qd(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new wd(this.firestore,null,e)}}function om(t){t=fd(t,wd);const e=fd(t.firestore,xd),n=Rd(e),s=new im(e);return function(t,e){const n=new Ls;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await function(t,e){const n=ks(t);return n.persistence.runTransaction("read document","readonly",(t=>n.Us.ys(t,e)))}(t,e);s.isFoundDocument()?n.resolve(s):s.isNoDocument()?n.resolve(null):n.reject(new Rs(Os.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(t){const s=$h(t,`Failed to get document '${e} from cache`);n.reject(s)}}(await ed(t),e,n))),n.promise}(n,t._key).then((n=>new Cf(e,s,t._key,n,new Nf(null!==n&&n.hasLocalMutations,!0),t.converter)))}function am(t){t=fd(t,wd);const e=fd(t.firestore,xd);return id(Rd(e),t._key,{source:"server"}).then((n=>wm(e,t,n)))}function cm(t){t=fd(t,vd);const e=fd(t.firestore,xd),n=Rd(e),s=new im(e);return Rf(t._query),od(n,t._query).then((n=>new xf(e,s,t,n)))}function um(t){t=fd(t,vd);const e=fd(t.firestore,xd),n=Rd(e),s=new im(e);return function(t,e){const n=new Ls;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){try{const s=await Du(t,e,!0),r=new cl(e,s.Ks),i=r.Ic(s.documents),o=r.applyChanges(i,!1);n.resolve(o.snapshot)}catch(t){const s=$h(t,`Failed to execute query '${e} against cache`);n.reject(s)}}(await ed(t),e,n))),n.promise}(n,t._query).then((n=>new xf(e,s,t,n)))}function hm(t){t=fd(t,vd);const e=fd(t.firestore,xd),n=Rd(e),s=new im(e);return od(n,t._query,{source:"server"}).then((n=>new xf(e,s,t,n)))}function lm(t,e,n){t=fd(t,wd);const s=fd(t.firestore,xd),r=tm(t.converter,e,n);return ym(s,[rf(sf(s),"setDoc",t._key,r,null!==t.converter,n).toMutation(t._key,ji.none())])}function dm(t,e,n,...s){t=fd(t,wd);const r=fd(t.firestore,xd),i=sf(r);let o;return o="string"==typeof(e=(0,a.m9)(e))||e instanceof zd?ff(i,"updateDoc",t._key,e,n,s):df(i,"updateDoc",t._key,e),ym(r,[o.toMutation(t._key,ji.exists(!0))])}function fm(t){return ym(fd(t.firestore,xd),[new eo(t._key,ji.none())])}function mm(t,e){const n=fd(t.firestore,xd),s=Ed(t),r=tm(t.converter,e);return ym(n,[rf(sf(t.firestore),"addDoc",s._key,r,null!==t.converter,{}).toMutation(s._key,ji.exists(!1))]).then((()=>s))}function gm(t,...e){var n,s,r;t=(0,a.m9)(t);let i={includeMetadataChanges:!1},o=0;"object"!=typeof e[o]||Nd(e[o])||(i=e[o],o++);const c={includeMetadataChanges:i.includeMetadataChanges};if(Nd(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(s=t.error)||void 0===s?void 0:s.bind(t),e[o+2]=null===(r=t.complete)||void 0===r?void 0:r.bind(t)}let u,h,l;if(t instanceof wd)h=fd(t.firestore,xd),l=hi(t._key.path),u={next:n=>{e[o]&&e[o](wm(h,t,n))},error:e[o+1],complete:e[o+2]};else{const n=fd(t,vd);h=fd(n.firestore,xd),l=n._query;const s=new im(h);u={next:t=>{e[o]&&e[o](new xf(h,s,n,t))},error:e[o+1],complete:e[o+2]},Rf(t._query)}return function(t,e,n,s){const r=new Gl(s),i=new el(e,r,n);return t.asyncQueue.enqueueAndForget((async()=>Yh(await rd(t),i))),()=>{r.Jc(),t.asyncQueue.enqueueAndForget((async()=>Xh(await rd(t),i)))}}(Rd(h),l,c,u)}function pm(t,e){return function(t,e){const n=new Gl(e);return t.asyncQueue.enqueueAndForget((async()=>function(t,e){ks(t).Zo.add(e),e.next()}(await rd(t),n))),()=>{n.Jc(),t.asyncQueue.enqueueAndForget((async()=>function(t,e){ks(t).Zo.delete(e)}(await rd(t),n)))}}(Rd(t=fd(t,xd)),Nd(e)?e:{next:e})}function ym(t,e){return function(t,e){const n=new Ls;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const s=Ul(t);try{const t=await function(t,e){const n=ks(t),s=Ys.now(),r=e.reduce(((t,e)=>t.add(e.key)),Io());let i;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>n.Us.Es(t,r).next((r=>{i=r;const o=[];for(const t of e){const e=Hi(t,i.get(t.key));null!=e&&o.push(new Xi(t.key,e,Fr(e.value.mapValue),ji.exists(!0)))}return n.gs.addMutationBatch(t,s,o,e)})))).then((t=>(t.applyToLocalDocumentSet(i),{batchId:t.batchId,changes:i})))}(s.localStore,e);s.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let s=t.$c[t.currentUser.toKey()];s||(s=new co(Hs)),s=s.insert(e,n),t.$c[t.currentUser.toKey()]=s}(s,t.batchId,n),await Nl(s,t.changes),await xh(s.remoteStore)}catch(t){const e=$h(t,"Failed to persist write");n.reject(e)}}(await sd(t),e,n))),n.promise}(Rd(t),e)}function wm(t,e,n){const s=n.docs.get(e._key),r=new im(t);return new Cf(t,r,e._key,s,new Nf(n.hasPendingWrites,n.fromCache),e.converter)}class vm extends class{constructor(t,e){this._firestore=t,this._transaction=e,this._dataReader=sf(t)}get(t){const e=sm(t,this._firestore),n=new em(this._firestore);return this._transaction.lookup([e._key]).then((t=>{if(!t||1!==t.length)return Cs();const s=t[0];if(s.isFoundDocument())return new Sf(this._firestore,n,s.key,s,e.converter);if(s.isNoDocument())return new Sf(this._firestore,n,e._key,null,e.converter);throw Cs()}))}set(t,e,n){const s=sm(t,this._firestore),r=tm(s.converter,e,n),i=rf(this._dataReader,"Transaction.set",s._key,r,null!==s.converter,n);return this._transaction.set(s._key,i),this}update(t,e,n,...s){const r=sm(t,this._firestore);let i;return i="string"==typeof(e=(0,a.m9)(e))||e instanceof zd?ff(this._dataReader,"Transaction.update",r._key,e,n,s):df(this._dataReader,"Transaction.update",r._key,e),this._transaction.update(r._key,i),this}delete(t){const e=sm(t,this._firestore);return this._transaction.delete(e._key),this}}{constructor(t,e){super(t,e),this._firestore=t}get(t){const e=sm(t,this._firestore),n=new im(this._firestore);return super.get(t).then((t=>new Cf(this._firestore,n,e._key,t._document,new Nf(!1,!1),e.converter)))}}function bm(t,e){return function(t,e){const n=new Ls;return t.asyncQueue.enqueueAndForget((async()=>{const s=await function(t){return Zl(t).then((t=>t.datastore))}(t);new Ql(t.asyncQueue,s,e,n).run()})),n.promise}(Rd(t=fd(t,xd)),(n=>e(new vm(t,n))))}function Im(){return new of("deleteField")}function Tm(){return new cf("serverTimestamp")}function Em(...t){return new uf("arrayUnion",t)}function Sm(...t){return new hf("arrayRemove",t)}function Am(t){return new lf("increment",t)}function _m(t){return Rd(t=fd(t,xd)),new nm(t,(e=>ym(t,e)))}function Nm(t,e){Rd(t=fd(t,xd));const n="string"==typeof e?function(t){try{return JSON.parse(t)}catch(t){throw new Rs(Os.INVALID_ARGUMENT,"Failed to parse JSON:"+t.message)}}(e):e,s=[];if(Array.isArray(n.indexes))for(const t of n.indexes){const e=Cm(t,"collectionGroup"),n=[];if(Array.isArray(t.fields))for(const e of t.fields){const t=If("setIndexConfiguration",Cm(e,"fieldPath"));"CONTAINS"===e.arrayConfig?n.push(new qr(t,2)):"ASCENDING"===e.order?n.push(new qr(t,0)):"DESCENDING"===e.order&&n.push(new qr(t,1))}s.push(new Ur(Ur.UNKNOWN_ID,e,n,Br.empty()))}return Promise.resolve()}function Cm(t,e){if("string"!=typeof t[e])throw new Rs(Os.INVALID_ARGUMENT,"Missing string value for: "+e);return t[e]}!function(t,e=!0){!function(t){bs=t}(r.Jn),(0,r.Xd)(new i.wA("firestore",((t,{options:n})=>{const s=t.getProvider("app").getImmediate(),r=new xd(s,new Vs(t.getProvider("auth-internal")),new js(t.getProvider("app-check-internal")));return n=Object.assign({useFetchStreams:e},n),r._setSettings(n),r}),"PUBLIC")),(0,r.KN)(ws,"3.4.5",t),(0,r.KN)(ws,"3.4.5","esm2017")}()},238:(t,e,n)=>{n.d(e,{ZR:()=>i.ZR,Jn:()=>T,l4:()=>h,H9:()=>m,Vr:()=>g,Af:()=>d,Z8:()=>v,lz:()=>f,qX:()=>y,Xd:()=>p,wN:()=>w,P2:()=>_,Mq:()=>S,C6:()=>A,ZF:()=>E,TP:()=>C,KN:()=>N,Ub:()=>D});var s=n(463),r=n(333),i=n(444);class o{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const a="@firebase/app",c="0.7.17",u=new r.Yd("@firebase/app"),h="[DEFAULT]",l={[a]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},d=new Map,f=new Map;function m(t,e){try{t.container.addComponent(e)}catch(n){u.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function g(t,e){t.container.addOrOverwriteComponent(e)}function p(t){const e=t.name;if(f.has(e))return u.debug(`There were multiple attempts to register component ${e}.`),!1;f.set(e,t);for(const e of d.values())m(e,t);return!0}function y(t,e){return t.container.getProvider(e)}function w(t,e,n=h){y(t,e).clearInstance(n)}function v(){f.clear()}const b=new i.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function."});class I{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new s.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw b.create("app-deleted",{appName:this._name})}}const T="9.6.7";function E(t,e={}){"object"!=typeof e&&(e={name:e});const n=Object.assign({name:h,automaticDataCollectionEnabled:!1},e),r=n.name;if("string"!=typeof r||!r)throw b.create("bad-app-name",{appName:String(r)});const o=d.get(r);if(o){if((0,i.vZ)(t,o.options)&&(0,i.vZ)(n,o.config))return o;throw b.create("duplicate-app",{appName:r})}const a=new s.H0(r);for(const t of f.values())a.addComponent(t);const c=new I(t,n,a);return d.set(r,c),c}function S(t=h){const e=d.get(t);if(!e)throw b.create("no-app",{appName:t});return e}function A(){return Array.from(d.values())}async function _(t){const e=t.name;d.has(e)&&(d.delete(e),await Promise.all(t.container.getProviders().map((t=>t.delete()))),t.isDeleted=!0)}function N(t,e,n){var r;let i=null!==(r=l[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const o=i.match(/\s|\//),a=e.match(/\s|\//);if(o||a){const t=[`Unable to register library "${i}" with version "${e}":`];return o&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),o&&a&&t.push("and"),a&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void u.warn(t.join(" "))}p(new s.wA(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}function C(t,e){if(null!==t&&"function"!=typeof t)throw b.create("invalid-log-argument");(0,r.Am)(t,e)}function D(t){(0,r.Ub)(t)}p(new s.wA("platform-logger",(t=>new o(t)),"PRIVATE")),N(a,c,""),N(a,c,"esm2017"),N("fire-js","")},463:(t,e,n)=>{n.d(e,{wA:()=>r,H0:()=>a});var s=n(444);class r{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const i="[DEFAULT]";class o{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new s.BH;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),s=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(s)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:i})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t="[DEFAULT]"){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t="[DEFAULT]"){return this.instances.has(t)}getOptions(t="[DEFAULT]"){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(s);return s}onInit(t,e){var n;const s=this.normalizeInstanceIdentifier(e),r=null!==(n=this.onInitCallbacks.get(s))&&void 0!==n?n:new Set;r.add(t),this.onInitCallbacks.set(s,r);const i=this.instances.get(s);return i&&t(i,s),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const s of n)try{s(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(s=t,s===i?void 0:s),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var s;return n||null}normalizeInstanceIdentifier(t="[DEFAULT]"){return this.component?this.component.multipleInstances?t:i:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new o(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}},333:(t,e,n)=>{n.d(e,{in:()=>r,Yd:()=>u,Ub:()=>h,Am:()=>l});const s=[];var r;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(r||(r={}));const i={debug:r.DEBUG,verbose:r.VERBOSE,info:r.INFO,warn:r.WARN,error:r.ERROR,silent:r.SILENT},o=r.INFO,a={[r.DEBUG]:"log",[r.VERBOSE]:"log",[r.INFO]:"info",[r.WARN]:"warn",[r.ERROR]:"error"},c=(t,e,...n)=>{if(e<t.logLevel)return;const s=(new Date).toISOString(),r=a[e];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[r](`[${s}]  ${t.name}:`,...n)};class u{constructor(t){this.name=t,this._logLevel=o,this._logHandler=c,this._userLogHandler=null,s.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in r))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?i[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,r.DEBUG,...t),this._logHandler(this,r.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,r.VERBOSE,...t),this._logHandler(this,r.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,r.INFO,...t),this._logHandler(this,r.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,r.WARN,...t),this._logHandler(this,r.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,r.ERROR,...t),this._logHandler(this,r.ERROR,...t)}}function h(t){s.forEach((e=>{e.setLogLevel(t)}))}function l(t,e){for(const n of s){let s=null;e&&e.level&&(s=i[e.level]),n.userLogHandler=null===t?null:(e,n,...i)=>{const o=i.map((t=>{if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(t){return null}})).filter((t=>t)).join(" ");n>=(null!=s?s:e.logLevel)&&t({level:r[n].toLowerCase(),message:o,args:i,type:e.name})}}}}},e={};function n(s){var r=e[s];if(void 0!==r)return r.exports;var i=e[s]={exports:{}};return t[s](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var s in e)n.o(e,s)&&!n.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{const t=n(503),e=n(591);(0,t.initializeApp)({apiKey:"AIzaSyAHkeQcGDQEU93OLbpThYRezvSN5yom9Qc",authDomain:"portfolio-ce7c8.firebaseapp.com",projectId:"portfolio-ce7c8",storageBucket:"portfolio-ce7c8.appspot.com",messagingSenderId:"1078891670722",appId:"1:1078891670722:web:8516d8be67cefd66955f5b"});const s=(0,e.getFirestore)();(0,e.collection)(s,"visited")})()})();